<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SLAP | Central de Estudos - Starter 1</title>
    <link rel="icon" type="image/png" href="https://res.cloudinary.com/dqfi22uz0/image/upload/v1749543469/SLAP_FAVICON_AMARELO_coilvj.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #8671d1; --secondary: #F1D24B; }
        body { font-family: 'DM Sans', sans-serif; background-color: #f4f7f9; min-height: 100vh; margin: 0; scroll-behavior: smooth; }
        #main-wrapper { max-width: 1200px; margin: 0 auto; padding: 1rem 1.5rem; position: relative; }
        .bg-primary\/10 { background-color: rgba(134, 113, 209, 0.1); }
        .text-primary { color: #8671d1; }

        /* UI BUTTONS */
        .action-button { background-color: #F1D24B; color: #44403c; padding: 0.75rem 1rem; border-radius: 0.75rem; font-weight: 700; cursor: pointer; width: 100%; transition: all 0.2s; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; }
        .action-button:hover:not(:disabled) { background-color: #eab308; transform: translateY(-2px); }
        .action-button:disabled { background-color: #e5e7eb; color: #9ca3af; cursor: not-allowed; box-shadow: none; }

        .secondary-button { background-color: #44403c; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; }
        .secondary-button:hover { background-color: #292524; transform: translateY(-1px); }

        /* CARDS */
        .level-card { background-color: white; padding: 1.75rem; border-radius: 1.25rem; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border: 2px solid transparent; transition: all 0.2s; display: flex; flex-direction: column; justify-content: space-between; height: 100%; position: relative; min-height: 180px; }
        .level-card:not(.locked):hover { transform: scale(1.02); border-color: #8671d1; }
        .level-card.locked { opacity: 0.6; background-color: #f9fafb; pointer-events: none; }
        
        /* STUDY VIEW CONTAINER */
        .study-container { background: white; border-radius: 1.5rem; padding: 2rem; box-shadow: 0 10px 40px rgba(0,0,0,0.08); margin-bottom: 2rem; }

        .module-tag { display: inline-block; padding: 0.25rem 0.5rem; background-color: #8671d1; color: white; font-size: 0.75rem; font-weight: 700; border-radius: 0.5rem; margin-bottom: 0.5rem; }
        .lock-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(68,64,60,0.9); padding: 1rem; border-radius: 50%; z-index: 10; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

        /* LISTENING */
        .listening-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); gap: 0.5rem; margin-top: 1rem; }
        .number-btn { background: white; border: 2px solid #e2e8f0; border-radius: 0.75rem; padding: 0.5rem; text-align: center; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 55px; }
        .number-btn:hover { border-color: #8671d1; transform: translateY(-2px); }
        .number-btn span.main-text { font-size: 1.1rem; font-weight: 800; }
        .number-btn span.sub-text { font-size: 0.6rem; font-weight: 600; color: #8671d1; text-transform: uppercase; }
        .number-btn span.phonetic-text { font-size: 0.75rem; font-weight: 500; color: #78716c; font-style: italic; }
        .number-btn.playing { border-color: #F1D24B; background-color: #fffbeb; animation: pulse 1s infinite; }

        /* FLASHCARDS */
        .flashcard-container { perspective: 1000px; width: 100%; max-width: 400px; height: 300px; margin: 1rem auto; cursor: pointer; }
        .flashcard { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
        .flashcard.flipped { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back { position: absolute; top: 0; left: 0; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 1.5rem; padding: 1rem; box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .flashcard-front { background-color: #8671d1; color: white; }
        .flashcard-back { background-color: #F1D24B; color: #44403c; transform: rotateY(180deg); }

        /* CHUNKS */
        .chunks-grid { display: grid; grid-template-columns: 1fr 1fr; border: 2px solid #e2e8f0; border-radius: 1rem; overflow: hidden; background: white; text-align: left; }
        .chunks-header { background: #44403c; color: white; padding: 1rem; font-weight: 700; text-transform: uppercase; font-size: 0.8rem; }
        .chunks-cell { padding: 0.75rem; border-bottom: 1px solid #e2e8f0; display: flex; align-items: center; font-weight: 500; font-size: 0.9rem; word-break: break-word; }
        .chunks-cell-en { color: #1e1b4b; background-color: #f8fafc; }
        .chunks-cell-pt { color: #64748b; justify-content: space-between; }
        .translation-hidden { filter: blur(5px); opacity: 0.3; transition: 0.3s; user-select: none; } 
        .translation-visible { filter: blur(0); opacity: 1; user-select: text; }
        @media (max-width: 640px) {
            .chunks-grid { grid-template-columns: 1fr; }
            .chunks-header:last-of-type { display: none; }
            .chunks-header:first-of-type::after { content: " / Tradu√ß√µes"; }
            .chunks-cell { padding: 0.875rem; font-size: 0.95rem; }
            .chunks-cell-en { border-bottom: none; border-right: none; padding-bottom: 0.5rem; }
            .chunks-cell-pt { border-bottom: 2px solid #e2e8f0; padding-top: 0.5rem; }
        }

        /* CROSSWORD */
        .crossword-grid { display: inline-grid; gap: 2px; background: #44403c; padding: 2px; border-radius: 0.5rem; }
        .crossword-cell { width: 36px; height: 36px; background: white; position: relative; display: flex; align-items: center; justify-content: center; }
        .crossword-cell-empty { width: 36px; height: 36px; background: #44403c; }
        .crossword-num { position: absolute; top: 1px; left: 2px; font-size: 9px; color: #64748b; font-weight: 600; }
        .crossword-input { width: 100%; height: 100%; text-align: center; font-size: 18px; font-weight: 700; border: none; outline: none; text-transform: uppercase; background: transparent; }
        .crossword-input:focus { background: #f0e6ff; }
        .crossword-hints { text-align: left; max-width: 280px; }
        @media (max-width: 640px) {
            .crossword-cell, .crossword-cell-empty { width: 32px; height: 32px; }
            .crossword-input { font-size: 16px; }
            .crossword-grid { gap: 1px; padding: 1px; }
        }

        /* SCRAMBLE */
        .scramble-dropzone {
            min-height: 80px; 
            border: 2px dashed #cbd5e1; 
            border-radius: 1rem; 
            padding: 1.5rem; 
            display: flex; 
            flex-wrap: wrap; 
            align-items: center; 
            justify-content: center; 
            gap: 0.75rem; 
            background-color: #f8fafc; 
            margin-bottom: 2rem; 
            font-size: 1.25rem; 
            font-weight: 700; 
            color: #8671d1;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }
        .scramble-word {
            background: white; 
            border: 2px solid #e2e8f0; 
            padding: 0.75rem 1.25rem; 
            border-radius: 0.75rem; 
            cursor: pointer; 
            font-weight: 600; 
            color: #44403c; 
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .scramble-word:hover { border-color: #8671d1; transform: translateY(-2px); box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .scramble-word-selected {
            background: #8671d1; 
            color: white;
            border: 2px solid #8671d1; 
            padding: 0.5rem 1rem; 
            border-radius: 0.5rem; 
            cursor: pointer; 
            font-weight: 600; 
            transition: all 0.2s;
            margin: 0.125rem;
        }
        .scramble-word-selected:hover { background: #7161b1; border-color: #7161b1; }

        /* MISTAKE */
        .mistake-word { display: inline-block; padding: 0.2rem 0.4rem; border-radius: 0.4rem; cursor: pointer; transition: all 0.2s; border-bottom: 2px solid transparent; }
        .mistake-word:hover { background-color: #fee2e2; border-bottom-color: #ef4444; }
        .mistake-word.correct-choice { background: #dcfce7; border-color: #22c55e; }
        .mistake-word.wrong-choice { background: #fee2e2; border-color: #ef4444; text-decoration: line-through; }

        /* DICTATION */
        .dictation-input { font-size: 1.25rem; text-align: center; border: 3px solid #e2e8f0; border-radius: 1rem; width: 220px; padding: 0.5rem; outline: none; transition: 0.2s; }
        .dictation-input:focus { border-color: #8671d1; }
        .dictation-input.correct { border-color: #22c55e; background: #dcfce7; }
        .dictation-input.wrong { border-color: #ef4444; background: #fee2e2; }

        /* GENERAL UI */

        .streak-container { display: flex; justify-content: center; gap: 5px; margin-bottom: 1rem; }
        .streak-bar-wrapper { width: 100%; max-width: 300px; margin: 0 auto; }
        .streak-bar-bg { width: 100%; height: 12px; background: #e2e8f0; border-radius: 6px; overflow: hidden; }
        .streak-bar-fill { height: 100%; background: linear-gradient(90deg, #F1D24B, #f59e0b); border-radius: 6px; transition: width 0.4s ease; }
        .streak-label { font-size: 0.75rem; font-weight: 700; color: #78716c; margin-bottom: 0.25rem; }

        /* QUIZ UI */
        .option-button { background-color: white; border: 2px solid #e2e8f0; color: #44403c; text-align: left; padding: 1rem; border-radius: 0.75rem; width: 100%; transition: all 0.2s; cursor: pointer; display: flex; align-items: center; gap: 1rem; }
        .option-button:hover:not(:disabled) { border-color: #8671d1; background-color: #f8fafc; }
        .option-prefix { width: 2.2rem; height: 2.2rem; background: #f3f0ff; color: #8671d1; font-weight: 800; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; border: 1px solid #e0d7f7; }

        .help-btn { position: absolute; top: 1rem; right: 1.5rem; width: 2.5rem; height: 2.5rem; border-radius: 50%; background: white; border: 2px solid #e2e8f0; color: #8671d1; font-weight: 700; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 50; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 10000; opacity: 0; pointer-events: none; transition: 0.3s; }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-content { background: white; border-radius: 1.5rem; padding: 1.8rem; max-width: 400px; width: 90%; transform: scale(0.9); transition: 0.3s; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); }
        .modal-overlay.active .modal-content { transform: scale(1); }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <!-- MAIN APP CONTENT -->
    <div id="main-wrapper">
        <header class="py-8 border-b border-stone-200 mb-10 text-center relative">
            <button class="help-btn" onclick="document.getElementById('rules-modal').classList.add('active')">?</button>

            <img src="https://res.cloudinary.com/dqfi22uz0/image/upload/v1759294967/SLAP_TIPO_PRETO_2_kismg9.png" alt="SLAP Logo" class="w-32 h-auto mx-auto mb-6">
            <h1 class="text-3xl font-bold text-stone-800 tracking-tight mb-3">Central de Estudos - Starter 1</h1>
            <p class="text-stone-500 font-medium px-4 leading-relaxed max-w-2xl mx-auto">Material did√°tico exclusivo focado em refor√ßar a acur√°cia estrutural e a confian√ßa na comunica√ß√£o.</p>
        </header>

        <div id="dashboard-view" class="w-full">
            <div class="max-w-xl mx-auto mb-6 flex gap-3 items-center">
                <div class="relative flex-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#a8a29e" stroke-width="2" class="absolute left-3 top-1/2 -translate-y-1/2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    <input type="text" id="search-input" placeholder="Pesquisar aula..." class="w-full pl-10 pr-4 py-3 rounded-xl border-2 border-stone-200 focus:border-primary focus:outline-none text-stone-700 font-medium" oninput="filterModules(this.value)">
                </div>
                <a href="#" target="_blank" class="inline-flex items-center gap-2 px-4 py-3 bg-white border border-stone-200 rounded-xl text-xs font-black text-stone-500 hover:text-[#8671d1] hover:border-[#8671d1] shadow-sm transition-all whitespace-nowrap">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                    BAIXAR CP
                </a>
            </div>
            <div id="level-cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-20"></div>
        </div>

        <div id="generator-view" class="hidden w-full">
            <div class="bg-white p-6 rounded-2xl shadow-xl max-w-2xl mx-auto">
                <button class="secondary-button mb-4 flex items-center gap-2" onclick="showDashboard()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m15 18-6-6 6-6"/></svg>
                    Voltar ao Menu
                </button>
                <h2 class="text-xl font-bold text-stone-800 mb-4 text-center" id="current-hw-display"></h2>
                <div id="quiz-streak-bar" class="streak-container"></div>
                <div id="feedback-alert" class="hidden p-3 mb-6 rounded-lg text-white font-semibold text-center"></div>
                <div class="challenge-box mb-6 border-l-4 border-indigo-400 p-6 bg-slate-50">
                    <p id="main-question" class="text-lg font-bold text-slate-800"></p>
                </div>
                <div id="options-container" class="space-y-3"></div>
                <div id="rationale-display" class="hidden mt-6">
                    <div id="rationale-content" class="p-4 bg-green-50 text-green-900 rounded-lg mb-4 text-sm border-l-4 border-green-400"></div>
                    <button class="action-button w-full" onclick="loadNextQuestion()">Pr√≥ximo Exerc√≠cio</button>
                </div>
            </div>
        </div>

        <div id="study-view" class="hidden w-full">
            <div class="study-container max-w-4xl mx-auto text-center">
                 <button class="secondary-button mb-4 flex items-center gap-2" onclick="showDashboard()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m15 18-6-6 6-6"/></svg>
                    Voltar ao Menu
                 </button>
                 <h2 class="text-2xl font-bold text-stone-800 mb-2" id="study-title"></h2>
                 <p class="text-stone-500 mb-4 italic text-sm" id="study-instruction"></p>
                 <div id="streak-bar-container" class="hidden mb-0"></div>
                 <div id="preloading-status" class="text-xs text-primary font-bold mb-1 h-4"></div>
                 <div id="study-content-area" class="py-4"></div>
            </div>
        </div>
    </div>

    <!-- RULES POPUP -->
    <div id="rules-modal" class="modal-overlay" onclick="if(event.target === this) this.classList.remove('active')">
        <div class="modal-content">
            <h3 class="text-xl font-black text-stone-800 mb-5 text-center">Manual de Regras</h3>
            <div class="space-y-5 text-left text-stone-600 text-sm leading-relaxed">
                <div class="flex gap-3"><div class="w-6 h-6 rounded-full bg-[#8671d1] text-white flex items-center justify-center shrink-0 font-bold">1</div><p><strong>Acesso Individual:</strong> N√£o compartilhe sua senha. Monitoramos acessos por IP.</p></div>
                <div class="flex gap-3"><div class="w-6 h-6 rounded-full bg-[#8671d1] text-white flex items-center justify-center shrink-0 font-bold">2</div><p><strong>Frequ√™ncia:</strong> A evolu√ß√£o vem da pr√°tica constante. Tente completar um m√≥dulo de Homework ap√≥s cada aula.</p></div>
                <div class="flex gap-3"><div class="w-6 h-6 rounded-full bg-[#8671d1] text-white flex items-center justify-center shrink-0 font-bold">3</div><p><strong>Prints:</strong> Ao completar um Streak de 5, tire um print e envie para seu teacher.</p></div>
                <div class="flex gap-3"><div class="w-6 h-6 rounded-full bg-[#8671d1] text-white flex items-center justify-center shrink-0 font-bold">4</div><p><strong>Listening:</strong> Use fones de ouvido para captar os detalhes.</p></div>
            </div>
            <button class="action-button w-full mt-8" onclick="document.getElementById('rules-modal').classList.remove('active')">Entendi, vamos l√°!</button>
        </div>
    </div>

    <script>
        const audioCache = new Map();

        let currentStreak = 0;
        let quizStreak = 0;
        const STREAK_GOAL = 5;
        const CROSSWORD_STREAK_GOAL = 2;
        let currentAulaId = 0; 

        // --- APP DATA ---
        const aulaNames = [
            { id: 1, name: "Open House", hasHomework: false },
            { id: 2, name: "Feelings", hasHomework: true, specialMode: 'flashcards' },
            { id: 3, name: "Names & Greetings", hasHomework: true, specialMode: 'chunks' },
            { id: 4, name: "Numbers pt. 1", hasHomework: true, specialMode: 'listening', thirdBtn: 'dictation', items: [
                {n: "1", w: "One"}, {n: "2", w: "Two"}, {n: "3", w: "Three"}, {n: "4", w: "Four"}, {n: "5", w: "Five"},
                {n: "6", w: "Six"}, {n: "7", w: "Seven"}, {n: "8", w: "Eight"}, {n: "9", w: "Nine"}, {n: "10", w: "Ten"},
                {n: "11", w: "Eleven"}, {n: "12", w: "Twelve"}, {n: "13", w: "Thirteen"}, {n: "14", w: "Fourteen"}, {n: "15", w: "Fifteen"},
                {n: "16", w: "Sixteen"}, {n: "17", w: "Seventeen"}, {n: "18", w: "Eighteen"}, {n: "19", w: "Nineteen"}, {n: "20", w: "Twenty"},
                {n: "21", w: "Twenty-one"}, {n: "23", w: "Twenty-three"}, {n: "25", w: "Twenty-five"}, {n: "27", w: "Twenty-seven"}, {n: "29", w: "Twenty-nine"},
                {n: "30", w: "Thirty"}, {n: "32", w: "Thirty-two"}, {n: "34", w: "Thirty-four"}, {n: "36", w: "Thirty-six"}, {n: "38", w: "Thirty-eight"},
                {n: "40", w: "Forty"}, {n: "41", w: "Forty-one"}, {n: "43", w: "Forty-three"}, {n: "45", w: "Forty-five"}, {n: "47", w: "Forty-seven"},
                {n: "50", w: "Fifty"}, {n: "52", w: "Fifty-two"}, {n: "54", w: "Fifty-four"}, {n: "56", w: "Fifty-six"}, {n: "58", w: "Fifty-eight"},
                {n: "60", w: "Sixty"}, {n: "62", w: "Sixty-two"}, {n: "65", w: "Sixty-five"}, {n: "67", w: "Sixty-seven"}, {n: "69", w: "Sixty-nine"},
                {n: "70", w: "Seventy"}, {n: "71", w: "Seventy-one"}, {n: "73", w: "Seventy-three"}, {n: "75", w: "Seventy-five"}, {n: "78", w: "Seventy-eight"},
                {n: "80", w: "Eighty"}, {n: "82", w: "Eighty-two"}, {n: "84", w: "Eighty-four"}, {n: "87", w: "Eighty-seven"}, {n: "89", w: "Eighty-nine"},
                {n: "90", w: "Ninety"}, {n: "91", w: "Ninety-one"}, {n: "93", w: "Ninety-three"}, {n: "96", w: "Ninety-six"}, {n: "99", w: "Ninety-nine"}
            ]},
            { id: 5, name: "Numbers pt. 2", hasHomework: true, specialMode: 'listening', thirdBtn: 'dictation', items: [
                {n: "100", w: "One hundred"}, {n: "150", w: "One hundred and fifty"}, {n: "200", w: "Two hundred"}, {n: "300", w: "Three hundred"}, {n: "325", w: "Three hundred and twenty-five"}, {n: "400", w: "Four hundred"}, {n: "500", w: "Five hundred"}, {n: "505", w: "Five hundred and five"}, {n: "600", w: "Six hundred"}, {n: "700", w: "Seven hundred"}, {n: "800", w: "Eight hundred"}, {n: "900", w: "Nine hundred"}, {n: "1,000", w: "One thousand"}, {n: "1,200", w: "One thousand two hundred"}, {n: "2,000", w: "Two thousand"}, {n: "4,000", w: "Four thousand"}, {n: "5,500", w: "Five thousand five hundred"}, {n: "10,000", w: "Ten thousand"}, {n: "10,500", w: "Ten thousand five hundred"}, {n: "20,000", w: "Twenty thousand"}, {n: "30,000", w: "Thirty thousand"}, {n: "40,000", w: "Forty thousand"}, {n: "45,300", w: "Forty-five thousand three hundred"}, {n: "50,000", w: "Fifty thousand"}, {n: "60,000", w: "Sixty thousand"}, {n: "70,000", w: "Seventy thousand"}, {n: "80,000", w: "Eighty thousand"}, {n: "90,000", w: "Ninety thousand"}
            ]},
            { id: 6, name: "Spelling", hasHomework: true, specialMode: 'listening', thirdBtn: 'dictation', items: [
                {n: "A", w: "ay", p: "/e…™/"}, {n: "B", w: "bee", p: "/biÀê/"}, {n: "C", w: "cee", p: "/siÀê/"}, {n: "D", w: "dee", p: "/diÀê/"},
                {n: "E", w: "ee", p: "/iÀê/"}, {n: "F", w: "ef", p: "/…õf/"}, {n: "G", w: "gee", p: "/d íiÀê/"}, {n: "H", w: "aitch", p: "/e…™t É/"},
                {n: "I", w: "eye", p: "/a…™/"}, {n: "J", w: "jay", p: "/d íe…™/"}, {n: "K", w: "kay", p: "/ke…™/"}, {n: "L", w: "el", p: "/…õl/"},
                {n: "M", w: "em", p: "/…õm/"}, {n: "N", w: "en", p: "/…õn/"}, {n: "O", w: "oh", p: "/o ä/"}, {n: "P", w: "pee", p: "/piÀê/"},
                {n: "Q", w: "cue", p: "/kjuÀê/"}, {n: "R", w: "ar", p: "/…ëÀêr/"}, {n: "S", w: "ess", p: "/…õs/"}, {n: "T", w: "tee", p: "/tiÀê/"},
                {n: "U", w: "you", p: "/juÀê/"}, {n: "V", w: "vee", p: "/viÀê/"}, {n: "W", w: "double you", p: "/Ààd åb…ôljuÀê/"}, {n: "X", w: "ex", p: "/…õks/"},
                {n: "Y", w: "why", p: "/wa…™/"}, {n: "Z", w: "zee", p: "/ziÀê/"}
            ] },
            { id: 7, name: "Ordinal Numbers", hasHomework: true, specialMode: 'listening', thirdBtn: 'dictation', items: [{n:"1st",w:"First"},{n:"2nd",w:"Second"},{n:"3rd",w:"Third"},{n:"4th",w:"Fourth"},{n:"5th",w:"Fifth"},{n:"6th",w:"Sixth"},{n:"7th",w:"Seventh"},{n:"8th",w:"Eighth"},{n:"9th",w:"Ninth"},{n:"10th",w:"Tenth"},{n:"11th",w:"Eleventh"},{n:"12th",w:"Twelfth"},{n:"13th",w:"Thirteenth"},{n:"14th",w:"Fourteenth"},{n:"15th",w:"Fifteenth"},{n:"16th",w:"Sixteenth"},{n:"17th",w:"Seventeenth"},{n:"18th",w:"Eighteenth"},{n:"19th",w:"Nineteenth"},{n:"20th",w:"Twentieth"},{n:"21st",w:"Twenty-first"},{n:"22nd",w:"Twenty-second"},{n:"23rd",w:"Twenty-third"},{n:"24th",w:"Twenty-fourth"},{n:"25th",w:"Twenty-fifth"},{n:"26th",w:"Twenty-sixth"},{n:"27th",w:"Twenty-seventh"},{n:"28th",w:"Twenty-eighth"},{n:"29th",w:"Twenty-ninth"},{n:"30th",w:"Thirtieth"},{n:"31st",w:"Thirty-first"},{n:"32nd",w:"Thirty-second"},{n:"33rd",w:"Thirty-third"},{n:"34th",w:"Thirty-fourth"},{n:"35th",w:"Thirty-fifth"},{n:"40th",w:"Fortieth"},{n:"41st",w:"Forty-first"},{n:"42nd",w:"Forty-second"},{n:"43rd",w:"Forty-third"},{n:"45th",w:"Forty-fifth"},{n:"50th",w:"Fiftieth"},{n:"51st",w:"Fifty-first"},{n:"52nd",w:"Fifty-second"},{n:"53rd",w:"Fifty-third"},{n:"55th",w:"Fifty-fifth"},{n:"58th",w:"Fifty-eighth"},{n:"60th",w:"Sixtieth"},{n:"61st",w:"Sixty-first"},{n:"62nd",w:"Sixty-second"},{n:"63rd",w:"Sixty-third"},{n:"65th",w:"Sixty-fifth"},{n:"70th",w:"Seventieth"},{n:"71st",w:"Seventy-first"},{n:"72nd",w:"Seventy-second"},{n:"73rd",w:"Seventy-third"},{n:"75th",w:"Seventy-fifth"},{n:"77th",w:"Seventy-seventh"},{n:"80th",w:"Eightieth"},{n:"81st",w:"Eighty-first"},{n:"82nd",w:"Eighty-second"},{n:"83rd",w:"Eighty-third"},{n:"85th",w:"Eighty-fifth"},{n:"89th",w:"Eighty-ninth"},{n:"90th",w:"Ninetieth"},{n:"91st",w:"Ninety-first"},{n:"92nd",w:"Ninety-second"},{n:"93rd",w:"Ninety-third"},{n:"95th",w:"Ninety-fifth"},{n:"99th",w:"Ninety-ninth"},{n:"100th",w:"One hundredth"}] },
            { id: 8, name: "Basic Verbs", hasHomework: true, thirdBtn: 'dictation' },
            { id: 9, name: "Basic Adjectives", hasHomework: true, thirdBtn: 'dictation' },
            { id: 10, name: "Demonstrative Pronouns", hasHomework: true, specialMode: 'scramble' },
            { id: 11, name: "Verb to be", hasHomework: true },
            { id: 12, name: "Countries and Nationalities", hasHomework: true, specialMode: 'flashcards' },
            { id: 13, name: "Neighborhood", hasHomework: true },
            { id: 14, name: "Family Members", hasHomework: true },
            { id: 15, name: "Midterm Test", hasHomework: false },
            { id: 16, name: "Can e Can't", hasHomework: true, specialMode: 'scramble' },
            { id: 17, name: "Midterm Test Correction", hasHomework: false },
            { id: 18, name: "Simple Present pt. 1", hasHomework: true, specialMode: 'scramble' },
            { id: 19, name: "Simple Present pt. 2", hasHomework: true, specialMode: 'scramble' },
            { id: 20, name: "Object Pronouns", hasHomework: true, specialMode: 'scramble' },
            { id: 21, name: "Likes and Dislikes", hasHomework: true },
            { id: 22, name: "Free Time Activities", hasHomework: true },
            { id: 23, name: "Months and Holidays", hasHomework: true, specialMode: 'listening', thirdBtn: 'flashcards', items: [{n:"Jan",w:"January"},{n:"Feb",w:"February"},{n:"Mar",w:"March"},{n:"Apr",w:"April"},{n:"May",w:"May"},{n:"Jun",w:"June"},{n:"Jul",w:"July"},{n:"Aug",w:"August"},{n:"Sep",w:"September"},{n:"Oct",w:"October"},{n:"Nov",w:"November"},{n:"Dec",w:"December"}] },
            { id: 24, name: "Possessive Adjectives", hasHomework: true, specialMode: 'scramble' },
            { id: 25, name: "Possessive Pronouns", hasHomework: true, specialMode: 'scramble' },
            { id: 26, name: "Foods and Fruits", hasHomework: true, specialMode: 'flashcards' },
            { id: 27, name: "Presentation", hasHomework: false },
            { id: 28, name: "Hours", hasHomework: true, specialMode: 'flashcards', thirdBtn: 'dictation' },
            { id: 29, name: "Kahoot Review", hasHomework: false },
            { id: 30, name: "Listening Test", hasHomework: false },
            { id: 31, name: "Grammar Test", hasHomework: false },
            { id: 32, name: "GT e LT Review", hasHomework: false },
            { id: 33, name: "OT Review", hasHomework: false },
            { id: 34, name: "Oral Test Day 1", hasHomework: false },
            { id: 35, name: "Oral Test Day 2", hasHomework: false },
            { id: 36, name: "General Feedback", hasHomework: false }
        ];

        const flashcardsData = {
            2: [
                { front: "Feliz", back: "Happy" }, { front: "Triste", back: "Sad" }, { front: "Bravo(a)", back: "Angry" },
                { front: "Cansado(a)", back: "Tired" }, { front: "Animado(a)", back: "Excited" }, { front: "Nervoso(a)", back: "Nervous" },
                { front: "Assustado(a)", back: "Scared" }, { front: "Entediado(a)", back: "Bored" }, { front: "Confuso(a)", back: "Confused" },
                { front: "Orgulhoso(a)", back: "Proud" }, { front: "Preocupado(a)", back: "Worried" }, { front: "Surpreso(a)", back: "Surprised" },
                { front: "Envergonhado(a)", back: "Embarrassed" }, { front: "Frustrado(a)", back: "Frustrated" }, { front: "Aliviado(a)", back: "Relieved" },
                { front: "Solit√°rio(a)", back: "Lonely" }, { front: "Grato(a)", back: "Grateful" }, { front: "Ciumento(a)", back: "Jealous" },
                { front: "Calmo(a)", back: "Calm" }, { front: "Ansioso(a)", back: "Anxious" }
            ],
            12: [
                { front: "üáßüá∑", back: "Brazil / Brazilian" }, { front: "üá∫üá∏", back: "USA / American" },
                { front: "üá¨üáß", back: "England / British" }, { front: "üá´üá∑", back: "France / French" },
                { front: "üá™üá∏", back: "Spain / Spanish" }, { front: "üáÆüáπ", back: "Italy / Italian" },
                { front: "üáØüáµ", back: "Japan / Japanese" }, { front: "üá®üá≥", back: "China / Chinese" },
                { front: "üá©üá™", back: "Germany / German" }, { front: "üáµüáπ", back: "Portugal / Portuguese" }
            ],
            23: [
                { front: "Natal", back: "Christmas" }, { front: "Ano Novo", back: "New Year's Day" }, 
                { front: "P√°scoa", back: "Easter" }, { front: "Dia das M√£es", back: "Mother's Day" }, 
                { front: "Dia dos Pais", back: "Father's Day" }, { front: "Dia das Crian√ßas", back: "Children's Day" },
                { front: "Carnaval", back: "Carnival" }, { front: "Dia de A√ß√£o de Gra√ßas", back: "Thanksgiving" },
                { front: "Dia dos Namorados", back: "Valentine's Day" }, { front: "Halloween", back: "Halloween" }
            ],
            26: [
                { front: "üçé", back: "Apple" }, { front: "üçå", back: "Banana" }, { front: "üçä", back: "Orange" },
                { front: "üçá", back: "Grapes" }, { front: "üçì", back: "Strawberry" }, { front: "üçë", back: "Peach" },
                { front: "üçí", back: "Cherry" }, { front: "üçç", back: "Pineapple" }, { front: "ü•≠", back: "Mango" },
                { front: "üçâ", back: "Watermelon" }, { front: "üçã", back: "Lemon" }, { front: "üçà", back: "Melon" },
                { front: "ü•ù", back: "Kiwi" }, { front: "ü´ê", back: "Blueberry" }, { front: "üçê", back: "Pear" },
                { front: "ü••", back: "Coconut" }, { front: "üçÖ", back: "Tomato" }, { front: "ü•ë", back: "Avocado" },
                { front: "ü´í", back: "Olive" }, { front: "üçè", back: "Green Apple" }, { front: "ü•í", back: "Cucumber" },
                { front: "üçï", back: "Pizza" }, { front: "ü•¶", back: "Broccoli" }, { front: "ü•ï", back: "Carrot" },
                { front: "ü•©", back: "Steak" }, { front: "üçö", back: "Rice" }, { front: "üç¶", back: "Ice cream" },
                { front: "üçû", back: "Bread" }, { front: "üßÄ", back: "Cheese" }, { front: "ü•¨", back: "Lettuce" }
            ],
            28: [
                { front: "08:00", back: "Eight o'clock" },
                { front: "08:30", back: "Eight thirty / Half past eight" },
                { front: "09:15", back: "Nine fifteen / Quarter past nine" },
                { front: "09:45", back: "Nine forty-five / Quarter to ten / Fifteen to ten" },
                { front: "10:20", back: "Ten twenty / Twenty past ten / Forty to eleven" },
                { front: "10:40", back: "Ten forty / Twenty to eleven / Forty past ten" },
                { front: "11:05", back: "Eleven oh five / Five past eleven" },
                { front: "11:55", back: "Eleven fifty-five / Five to twelve" },
                { front: "12:00", back: "Twelve o'clock / Noon / Midday" },
                { front: "00:00", back: "Twelve o'clock / Midnight" },
                { front: "03:30", back: "Three thirty / Half past three" },
                { front: "03:20", back: "Three twenty / Twenty past three / Forty to four" },
                { front: "04:10", back: "Four ten / Ten past four / Fifty to five" },
                { front: "05:25", back: "Five twenty-five / Twenty-five past five / Thirty-five to six" },
                { front: "06:35", back: "Six thirty-five / Thirty-five past six / Twenty-five to seven" },
                { front: "06:45", back: "Six forty-five / Quarter to seven / Fifteen to seven" },
                { front: "07:00", back: "Seven o'clock" },
                { front: "07:50", back: "Seven fifty / Ten to eight / Fifty past seven" },
                { front: "02:15", back: "Two fifteen / Quarter past two / Fifteen past two" },
                { front: "01:30", back: "One thirty / Half past one" }
            ]
        };

        const chunksData = {
            // Asking About Names (module 3)
            3: [
                { en: "What's your name?", pt: "Qual √© o seu nome?" }, 
                { en: "What's your first name?", pt: "Qual √© o seu primeiro nome?" }, 
                { en: "What's your middle name?", pt: "Qual √© o seu nome do meio?" }, 
                { en: "What's your nickname?", pt: "Qual √© o seu apelido?" }, 
                { en: "What's your last name?", pt: "Qual √© o seu sobrenome?" },
                { en: "My name is...", pt: "Meu nome √©..." },
                { en: "Nice to meet you!", pt: "Prazer em conhec√™-lo!" },
                { en: "Where are you from?", pt: "De onde voc√™ √©?" },
                { en: "How old are you?", pt: "Quantos anos voc√™ tem?" },
                { en: "I'm from Brazil.", pt: "Eu sou do Brasil." }
            ]
        };

        const gamesData = {
            // Demonstrative Pronouns (module 10)
            10: [
                { full: "this is my car", words: ["this", "is", "my", "car"] },
                { full: "that is your house", words: ["that", "is", "your", "house"] },
                { full: "these are my books", words: ["these", "are", "my", "books"] },
                { full: "those are her shoes", words: ["those", "are", "her", "shoes"] },
                { full: "this is a good idea", words: ["this", "is", "a", "good", "idea"] }
            ],
            // Can e Can't (module 16)
            16: [
                { full: "I can dance", words: ["I", "can", "dance"] },
                { full: "she can speak English", words: ["she", "can", "speak", "English"] },
                { full: "they can't swim", words: ["they", "can't", "swim"] },
                { full: "we can play soccer", words: ["we", "can", "play", "soccer"] },
                { full: "he can't drive a car", words: ["he", "can't", "drive", "a", "car"] }
            ],
            // Simple Present pt. 1 (module 18)
            18: [
                { full: "I drink water every day", words: ["I", "drink", "water", "every", "day"] },
                { full: "she works at a hospital", words: ["she", "works", "at", "a", "hospital"] },
                { full: "they study English", words: ["they", "study", "English"] },
                { full: "he plays soccer on weekends", words: ["he", "plays", "soccer", "on", "weekends"] },
                { full: "we eat breakfast together", words: ["we", "eat", "breakfast", "together"] }
            ],
            // Simple Present pt. 2 - negativas e interrogativas (module 19)
            19: [
                { full: "I don't like coffee", words: ["I", "don't", "like", "coffee"] },
                { full: "she doesn't work here", words: ["she", "doesn't", "work", "here"] },
                { full: "they don't speak French", words: ["they", "don't", "speak", "French"] },
                { full: "he doesn't have a car", words: ["he", "doesn't", "have", "a", "car"] },
                { full: "we don't eat meat", words: ["we", "don't", "eat", "meat"] },
                { full: "do you like pizza", words: ["do", "you", "like", "pizza"] },
                { full: "does she live here", words: ["does", "she", "live", "here"] },
                { full: "do they study English", words: ["do", "they", "study", "English"] },
                { full: "does he play guitar", words: ["does", "he", "play", "guitar"] },
                { full: "do we need help", words: ["do", "we", "need", "help"] }
            ],
            // Object Pronouns (module 20)
            20: [
                { full: "help me please", words: ["help", "me", "please"] },
                { full: "I love you", words: ["I", "love", "you"] },
                { full: "call him now", words: ["call", "him", "now"] },
                { full: "give her the book", words: ["give", "her", "the", "book"] },
                { full: "tell us the story", words: ["tell", "us", "the", "story"] }
            ],
            // Possessive Adjectives (module 24)
            24: [
                { full: "my book is new", words: ["my", "book", "is", "new"] },
                { full: "your car is fast", words: ["your", "car", "is", "fast"] },
                { full: "her dress is beautiful", words: ["her", "dress", "is", "beautiful"] },
                { full: "his name is John", words: ["his", "name", "is", "John"] },
                { full: "our house is big", words: ["our", "house", "is", "big"] }
            ],
            // Possessive Pronouns (module 25)
            25: [
                { full: "this pen is mine", words: ["this", "pen", "is", "mine"] },
                { full: "that book is yours", words: ["that", "book", "is", "yours"] },
                { full: "the car is hers", words: ["the", "car", "is", "hers"] },
                { full: "this phone is his", words: ["this", "phone", "is", "his"] },
                { full: "the house is ours", words: ["the", "house", "is", "ours"] }
            ],
            // Dictation data
            4: { dictation: ["one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten"] },
            5: { dictation: ["eleven", "twelve", "thirteen", "fourteen", "fifteen", "sixteen", "seventeen", "eighteen", "nineteen", "twenty"] },
            6: { dictation: ["CAR", "DOG", "CAT", "BUS", "SUN", "HAT", "PEN", "RED", "BOX", "CUP", "BOOK", "TREE", "FISH", "BIRD", "HAND", "STAR", "MOON", "BALL", "CAKE", "MILK"], isSpelling: true },
            7: { dictation: ["first", "second", "third", "fourth", "fifth", "sixth", "seventh", "eighth", "ninth", "tenth"] },
            8: { dictation: ["run", "walk", "eat", "drink", "sleep", "work", "play", "read", "write", "speak"] },
            9: { dictation: ["happy", "sad", "big", "small", "hot", "cold", "fast", "slow", "good", "bad"] },
            28: { dictation: ["08:00", "12:30", "03:15", "06:45", "09:00", "10:30", "02:00", "07:15", "11:45", "04:30"] }
        };

        // --- REAL HOMEWORK QUESTIONS (10 PER MODULE) ---
        const quizData = {
            2: [ // AULA 01: FEELINGS + VERB TO BE
                {q: "Complete a frase com a op√ß√£o correta: After a long day, I am ____.", options: [{text:"happy", isCorrect:false}, {text:"tired", isCorrect:true}, {text:"excited", isCorrect:false}, {text:"relaxed", isCorrect:false}], rationale: "Ap√≥s um longo dia, voc√™ fica cansado (tired)."},
                {q: "Escolha a frase mais natural em ingl√™s:", options: [{text:"I am feel sad", isCorrect:false}, {text:"I feel sad", isCorrect:true}, {text:"I feeling sad", isCorrect:false}, {text:"I am sad feel", isCorrect:false}], rationale: "'I feel sad' √© a forma correta."},
                {q: "Escolha o significado correto: 'She is angry.'", options: [{text:"Ela est√° cansada", isCorrect:false}, {text:"Ela est√° feliz", isCorrect:false}, {text:"Ela est√° brava", isCorrect:true}, {text:"Ela est√° animada", isCorrect:false}], rationale: "Angry = brava/irritada."},
                {q: "Complete a frase de acordo com a situa√ß√£o: When I don't sleep well, I feel ____.", options: [{text:"tired", isCorrect:true}, {text:"excited", isCorrect:false}, {text:"relaxed", isCorrect:false}, {text:"happy", isCorrect:false}], rationale: "Sem dormir bem, ficamos cansados (tired)."},
                {q: "Escolha o oposto de happy:", options: [{text:"angry", isCorrect:false}, {text:"sad", isCorrect:true}, {text:"tired", isCorrect:false}, {text:"scared", isCorrect:false}], rationale: "O oposto de feliz √© triste (sad)."},
                {q: "Complete a frase com o verbo correto: 'I ____ scared of dogs.'", options: [{text:"is", isCorrect:false}, {text:"are", isCorrect:false}, {text:"am", isCorrect:true}, {text:"be", isCorrect:false}], rationale: "'I' exige o verbo 'am'."},
                {q: "Qual op√ß√£o N√ÉO √© um sentimento?", options: [{text:"nervous", isCorrect:false}, {text:"tired", isCorrect:false}, {text:"smile", isCorrect:true}, {text:"angry", isCorrect:false}], rationale: "Smile (sorriso) √© uma a√ß√£o, n√£o um sentimento."},
                {q: "Escolha a ordem mais natural das palavras:", options: [{text:"I am now angry", isCorrect:false}, {text:"I angry am now", isCorrect:false}, {text:"I now am angry", isCorrect:false}, {text:"I am angry now", isCorrect:true}], rationale: "A ordem padr√£o √© Sujeito + Verbo + Adjetivo + Tempo."},
                {q: "Depois de uma boa not√≠cia, voc√™ normalmente se sente:", options: [{text:"tired", isCorrect:false}, {text:"happy", isCorrect:true}, {text:"angry", isCorrect:false}, {text:"scared", isCorrect:false}], rationale: "Boas not√≠cias trazem felicidade (happy)."},
                {q: "Depois de uma discuss√£o ruim, voc√™ normalmente se sente:", options: [{text:"happy", isCorrect:false}, {text:"relaxed", isCorrect:false}, {text:"angry", isCorrect:true}, {text:"excited", isCorrect:false}], rationale: "Discuss√µes ruins causam raiva (angry)."}
            ],
            3: [ // AULA 02: NAMES & GREETINGS
                {q: "Voc√™ est√° saindo da aula. O que voc√™ diz?", options: [{text:"Hi!", isCorrect:false}, {text:"Good morning!", isCorrect:false}, {text:"Have a good night", isCorrect:true}, {text:"What's up?", isCorrect:false}], rationale: "Ao sair, desejamos boa noite."},
                {q: "Complete a frase: '____ name is Daniela.'", options: [{text:"I", isCorrect:false}, {text:"My", isCorrect:true}, {text:"He", isCorrect:false}, {text:"You", isCorrect:false}], rationale: "My (meu/minha) √© o possessivo correto."},
                {q: "Escolha a frase correta:", options: [{text:"My name Daniela", isCorrect:false}, {text:"My name is Daniela", isCorrect:true}, {text:"My is name Daniela", isCorrect:false}, {text:"Name is my Daniela", isCorrect:false}], rationale: "A estrutura √© My name + is + Nome."},
                {q: "Voc√™ conhece seu professor pela primeira vez. O que voc√™ diz?", options: [{text:"Bye", isCorrect:false}, {text:"Hello, nice to meet you", isCorrect:true}, {text:"See you later", isCorrect:false}, {text:"Good night", isCorrect:false}], rationale: "Cumprimento padr√£o para o primeiro encontro."},
                {q: "Escolha a pergunta correta:", options: [{text:"What your name is?", isCorrect:false}, {text:"What is name you?", isCorrect:false}, {text:"What is your name?", isCorrect:true}, {text:"Your name what is?", isCorrect:false}], rationale: "Ordem correta: What is + your name?"},
                {q: "Complete a express√£o: 'Nice to ____ you.'", options: [{text:"be", isCorrect:false}, {text:"say", isCorrect:false}, {text:"meet", isCorrect:true}, {text:"talk", isCorrect:false}], rationale: "Nice to meet you = Prazer em conhec√™-lo."},
                {q: "'Hi, I'm Paulo' significa:", options: [{text:"Oi, eu sou Paulo", isCorrect:true}, {text:"Oi, qual √© seu nome?", isCorrect:false}, {text:"Tchau, Paulo", isCorrect:false}, {text:"Prazer, Paulo", isCorrect:false}], rationale: "Tradu√ß√£o direta de apresenta√ß√£o."},
                {q: "Qual cumprimento √© mais informal?", options: [{text:"Good evening", isCorrect:false}, {text:"Hello", isCorrect:false}, {text:"Hi", isCorrect:true}, {text:"Good afternoon", isCorrect:false}], rationale: "Hi √© o mais informal."},
                {q: "Pergunta: What's your name?", options: [{text:"Hi!", isCorrect:false}, {text:"My name is Laura", isCorrect:true}, {text:"Nice to meet you", isCorrect:false}, {text:"Goodbye", isCorrect:false}], rationale: "Resposta direta √† pergunta."},
                {q: "Quando normalmente dizemos 'Goodbye'?", options: [{text:"Quando chegamos", isCorrect:false}, {text:"Quando nos apresentamos", isCorrect:false}, {text:"Quando vamos embora", isCorrect:true}, {text:"Quando encontramos algu√©m", isCorrect:false}], rationale: "Goodbye √© despedida."}
            ],
            4: [ // AULA 03: NUMBERS
                {q: "Escolha o n√∫mero correto: 'Eight'", options: [{text:"6", isCorrect:false}, {text:"7", isCorrect:false}, {text:"8", isCorrect:true}, {text:"9", isCorrect:false}], rationale: "Eight = 8."},
                {q: "Complete a frase: 'I have ____ cousins.'", options: [{text:"two", isCorrect:true}, {text:"second", isCorrect:false}, {text:"twice", isCorrect:false}, {text:"double", isCorrect:false}], rationale: "Usa-se n√∫mero cardinal para quantidade."},
                {q: "O que vem depois de nine?", options: [{text:"eight", isCorrect:false}, {text:"ten", isCorrect:true}, {text:"eleven", isCorrect:false}, {text:"twelve", isCorrect:false}], rationale: "9, 10 (Ten)."},
                {q: "Complete a frase: 'I am ____ years old.'", options: [{text:"twenty", isCorrect:true}, {text:"twentieth", isCorrect:false}, {text:"twenties", isCorrect:false}, {text:"twentys", isCorrect:false}], rationale: "Idade usa n√∫meros cardinais."},
                {q: "Escolha a frase correta:", options: [{text:"I have three brother", isCorrect:false}, {text:"I have three brothers", isCorrect:true}, {text:"I have brother three", isCorrect:false}, {text:"I have brothers three", isCorrect:false}], rationale: "Plural no substantivo ap√≥s o n√∫mero."},
                {q: "Complete a frase: '____ students are in the SLAP class.' (10)", options: [{text:"tenth", isCorrect:false}, {text:"ten", isCorrect:true}, {text:"teen", isCorrect:false}, {text:"tens", isCorrect:false}], rationale: "Quantidade 10 = Ten."},
                {q: "Four plus five is:", options: [{text:"eight", isCorrect:false}, {text:"nine", isCorrect:true}, {text:"ten", isCorrect:false}, {text:"eleven", isCorrect:false}], rationale: "4 + 5 = 9 (Nine)."},
                {q: "Escolha a frase mais natural em ingl√™s:", options: [{text:"I have 30 years", isCorrect:false}, {text:"I am 30 years", isCorrect:false}, {text:"I am 30 years old", isCorrect:true}, {text:"I have 30 old", isCorrect:false}], rationale: "Em ingl√™s, 'somos' a idade (I am), n√£o 'temos'."},
                {q: "Escolha a grafia correta:", options: [{text:"for", isCorrect:false}, {text:"fore", isCorrect:false}, {text:"four", isCorrect:true}, {text:"fower", isCorrect:false}], rationale: "Quatro = Four."},
                {q: "Escolha a frase correta:", options: [{text:"I have two car", isCorrect:false}, {text:"I have two cars", isCorrect:true}, {text:"I have cars two", isCorrect:false}, {text:"I have two car's", isCorrect:false}], rationale: "N√∫mero + Substantivo Plural."}
            ],
            5: [ // AULA 04: NUMBERS (CONTEXTO REAL)
                {q: "Como normalmente falamos um n√∫mero de telefone em ingl√™s?", options: [{text:"In big numbers", isCorrect:false}, {text:"As one long number", isCorrect:false}, {text:"Digit by digit", isCorrect:true}, {text:"Using ordinal numbers", isCorrect:false}], rationale: "Telefones s√£o ditos d√≠gito a d√≠gito."},
                {q: "Escolha a forma mais natural de dizer 358:", options: [{text:"Three five eight", isCorrect:false}, {text:"Three hundred fifty-eight", isCorrect:true}, {text:"Thirty five eight", isCorrect:false}, {text:"Three hundred eight", isCorrect:false}], rationale: "Centenas + dezenas."},
                {q: "Como normalmente dizemos o ano 2015 de forma formal?", options: [{text:"Two thousand and fifteen", isCorrect:true}, {text:"Twenty fifteen", isCorrect:false}, {text:"Two zero one five", isCorrect:false}, {text:"Two thousand five", isCorrect:false}], rationale: "Forma formal usa 'two thousand and...'."},
                {q: "Escolha a forma mais natural de dizer $12.99:", options: [{text:"Twelve ninety-nine", isCorrect:true}, {text:"Twelve dollars ninety-nine", isCorrect:false}, {text:"Twelve dollars and ninety-nine cents", isCorrect:false}, {text:"Ninety-nine dollars twelve", isCorrect:false}], rationale: "Forma curta comum para pre√ßos."},
                {q: "Complete a frase: 'My house number is ____.' (230)", options: [{text:"Two three zero", isCorrect:true}, {text:"Two hundred thirty zero", isCorrect:false}, {text:"Twenty three zero", isCorrect:false}, {text:"Two hundred three", isCorrect:false}], rationale: "Endere√ßos costumam ser d√≠gito a d√≠gito."},
                {q: "Complete a frase: 'My phone number starts with ____.' (9)", options: [{text:"nine", isCorrect:true}, {text:"ninth", isCorrect:false}, {text:"nineteen", isCorrect:false}, {text:"ninety", isCorrect:false}], rationale: "D√≠gito 9 = Nine."},
                {q: "Que n√∫mero vem depois de thirty-nine?", options: [{text:"thirty-ten", isCorrect:false}, {text:"forty", isCorrect:true}, {text:"fourteen", isCorrect:false}, {text:"forty-one", isCorrect:false}], rationale: "39 -> 40 (Forty)."},
                {q: "Escolha a frase correta:", options: [{text:"The price is 20 dollars and 50", isCorrect:false}, {text:"The price is twenty dollars fifty", isCorrect:false}, {text:"The price is twenty dollars and fifty cents", isCorrect:true}, {text:"The price is twenty fifty", isCorrect:false}], rationale: "Forma completa e correta de pre√ßo."},
                {q: "Como normalmente falamos n√∫meros de apartamento?", options: [{text:"Using ordinal numbers", isCorrect:false}, {text:"Digit by digit", isCorrect:true}, {text:"Using letters", isCorrect:false}, {text:"Using plural numbers", isCorrect:false}], rationale: "Como telefones e endere√ßos."},
                {q: "Escolha a grafia correta:", options: [{text:"Fourty", isCorrect:false}, {text:"Forty", isCorrect:true}, {text:"Fourti", isCorrect:false}, {text:"Fourtee", isCorrect:false}], rationale: "Quarenta se escreve Forty (sem o 'u')."}
            ],
            6: [ // AULA 05: SPELLING & PERSONAL INFORMATION
                {q: "Algu√©m pergunta: 'How do you spell your last name?' O que voc√™ responde?", options: [{text:"I am Silva", isCorrect:false}, {text:"Silva", isCorrect:false}, {text:"S-I-L-V-A", isCorrect:true}, {text:"My name is Silva", isCorrect:false}], rationale: "Soletrar = dizer letra por letra."},
                {q: "Escolha a grafia correta do nome: 'Maria'", options: [{text:"M-E-R-I-A", isCorrect:false}, {text:"M-A-R-I-A", isCorrect:true}, {text:"M-A-R-E-A", isCorrect:false}, {text:"M-E-R-E-A", isCorrect:false}], rationale: "A soletra√ß√£o correta."},
                {q: "Como dizemos o s√≠mbolo @ em ingl√™s?", options: [{text:"at", isCorrect:true}, {text:"on", isCorrect:false}, {text:"in", isCorrect:false}, {text:"to", isCorrect:false}], rationale: "@ = at."},
                {q: "Complete a frase corretamente: 'My email is anna ____ hotmail.com'", options: [{text:"on", isCorrect:false}, {text:"at", isCorrect:true}, {text:"in", isCorrect:false}, {text:"to", isCorrect:false}], rationale: "Usa-se 'at' para o @."},
                {q: "Escolha a frase correta:", options: [{text:"Can you spell your name?", isCorrect:true}, {text:"Can you spell me your name?", isCorrect:false}, {text:"You spell your name?", isCorrect:false}, {text:"Spell you your name?", isCorrect:false}], rationale: "Pergunta correta para pedir soletra√ß√£o."},
                {q: "Como abreviamos Television?", options: [{text:"Tee-vee", isCorrect:false}, {text:"T-V", isCorrect:true}, {text:"Ti-vi", isCorrect:false}, {text:"Tee-vi", isCorrect:false}], rationale: "TV s√£o as letras T e V."},
                {q: "Complete a frase: 'My name is Jacob. It has ____ letters.'", options: [{text:"five", isCorrect:true}, {text:"fifth", isCorrect:false}, {text:"fiveth", isCorrect:false}, {text:"fifteenth", isCorrect:false}], rationale: "J-A-C-O-B = 5 letras."},
                {q: "Quando soletramos informa√ß√µes, normalmente:", options: [{text:"falamos r√°pido", isCorrect:false}, {text:"usamos n√∫meros ordinais", isCorrect:false}, {text:"dizemos cada letra claramente", isCorrect:true}, {text:"traduzimos a palavra", isCorrect:false}], rationale: "Clareza √© essencial ao soletrar."},
                {q: "Escolha a abrevia√ß√£o correta de 'Speaking Like a Pro':", options: [{text:"SPARK", isCorrect:false}, {text:"SELIAPR", isCorrect:false}, {text:"SLP", isCorrect:false}, {text:"SLAP", isCorrect:true}], rationale: "SLAP = Speaking Like A Pro."},
                {q: "Qual pergunta gera a resposta 'M-A-R-I-A'?", options: [{text:"Can you spell your name for me?", isCorrect:true}, {text:"Can you spell your last name for me?", isCorrect:false}, {text:"How are you?", isCorrect:false}, {text:"Can you spell your middle name for me?", isCorrect:false}], rationale: "A resposta √© a soletra√ß√£o do primeiro nome."}
            ],
            7: [ // AULA 06: ORDINAL NUMBERS
                {q: "Escolha o n√∫mero ordinal de 1:", options: [{text:"one", isCorrect:false}, {text:"first", isCorrect:true}, {text:"once", isCorrect:false}, {text:"oneth", isCorrect:false}], rationale: "1¬∫ = first."},
                {q: "Qual √© o ordinal de 2?", options: [{text:"two", isCorrect:false}, {text:"second", isCorrect:true}, {text:"twoth", isCorrect:false}, {text:"twelve", isCorrect:false}], rationale: "2¬∫ = second."},
                {q: "Complete a frase: 'I live on the ____ floor.' (3)", options: [{text:"three", isCorrect:false}, {text:"third", isCorrect:true}, {text:"thirteen", isCorrect:false}, {text:"thirty", isCorrect:false}], rationale: "3¬∫ andar = third floor."},
                {q: "Complete a frase: 'My birthday is on the ____ of May.' (5)", options: [{text:"five", isCorrect:false}, {text:"fifth", isCorrect:true}, {text:"fifteen", isCorrect:false}, {text:"fifty", isCorrect:false}], rationale: "5¬∫ = fifth."},
                {q: "Qual √© o ordinal de 4?", options: [{text:"four", isCorrect:false}, {text:"fourth", isCorrect:true}, {text:"forty", isCorrect:false}, {text:"fortieth", isCorrect:false}], rationale: "4¬∫ = fourth."},
                {q: "Escolha a frase correta:", options: [{text:"I am on the two floor", isCorrect:false}, {text:"I am on the second floor", isCorrect:true}, {text:"I am in the two floor", isCorrect:false}, {text:"I am in second floor", isCorrect:false}], rationale: "Usamos ordinal + on the."},
                {q: "Complete a frase: 'This is my ____ day at SLAP.' (1)", options: [{text:"one", isCorrect:false}, {text:"first", isCorrect:true}, {text:"once", isCorrect:false}, {text:"oneth", isCorrect:false}], rationale: "1¬∫ = first."},
                {q: "Qual √© o ordinal de 6?", options: [{text:"six", isCorrect:false}, {text:"sixth", isCorrect:true}, {text:"sixt", isCorrect:false}, {text:"sixteen", isCorrect:false}], rationale: "6¬∫ = sixth."},
                {q: "Complete a frase: 'The meeting is on the ____ of June.' (2)", options: [{text:"two", isCorrect:false}, {text:"second", isCorrect:true}, {text:"twelve", isCorrect:false}, {text:"twenty", isCorrect:false}], rationale: "2¬∫ = second."},
                {q: "Quando usamos n√∫meros ordinais?", options: [{text:"Para falar de quantidade", isCorrect:false}, {text:"Para falar de ordem", isCorrect:true}, {text:"Para falar de cor", isCorrect:false}, {text:"Para falar de pre√ßo", isCorrect:false}], rationale: "Ordinais indicam posi√ß√£o/ordem."}
            ],
            8: [ // AULA 07: BASIC VERBS (SIMPLE PRESENT)
                {q: "Complete a frase: 'I ____ breakfast in the morning.'", options: [{text:"eats", isCorrect:false}, {text:"eat", isCorrect:true}, {text:"eating", isCorrect:false}, {text:"ate", isCorrect:false}], rationale: "Com 'I' usamos o verbo na forma base."},
                {q: "Complete a frase: 'She ____ water every day.'", options: [{text:"drink", isCorrect:false}, {text:"drinks", isCorrect:true}, {text:"drinking", isCorrect:false}, {text:"drank", isCorrect:false}], rationale: "Com 'she' adicionamos -s ao verbo."},
                {q: "Complete a frase: 'They ____ soccer on weekends.'", options: [{text:"plays", isCorrect:false}, {text:"play", isCorrect:true}, {text:"playing", isCorrect:false}, {text:"played", isCorrect:false}], rationale: "Com 'they' usamos o verbo na forma base."},
                {q: "Escolha a frase correta:", options: [{text:"He read books", isCorrect:false}, {text:"He reads books", isCorrect:true}, {text:"He reading books", isCorrect:false}, {text:"He read books every day", isCorrect:false}], rationale: "Com 'he' adicionamos -s ao verbo."},
                {q: "Complete a frase: 'We ____ English at SLAP.'", options: [{text:"speaks", isCorrect:false}, {text:"speak", isCorrect:true}, {text:"speaking", isCorrect:false}, {text:"spoke", isCorrect:false}], rationale: "Com 'we' usamos o verbo na forma base."},
                {q: "Complete a frase: 'She ____ every morning.'", options: [{text:"run", isCorrect:false}, {text:"runs", isCorrect:true}, {text:"running", isCorrect:false}, {text:"ran", isCorrect:false}], rationale: "Com 'she' adicionamos -s ao verbo."},
                {q: "Escolha a frase correta:", options: [{text:"I write emails", isCorrect:true}, {text:"I writes emails", isCorrect:false}, {text:"I writing emails", isCorrect:false}, {text:"I wrote emails every day", isCorrect:false}], rationale: "Com 'I' usamos o verbo na forma base."},
                {q: "Complete a frase: 'He ____ his homework at night.'", options: [{text:"do", isCorrect:false}, {text:"does", isCorrect:true}, {text:"doing", isCorrect:false}, {text:"did", isCorrect:false}], rationale: "Com 'he' o verbo 'do' vira 'does'."},
                {q: "Complete a frase: 'She ____ a book before bed.'", options: [{text:"read", isCorrect:false}, {text:"reads", isCorrect:true}, {text:"reading", isCorrect:false}, {text:"readed", isCorrect:false}], rationale: "Com 'she' adicionamos -s ao verbo."},
                {q: "Escolha a frase correta:", options: [{text:"They drink coffee", isCorrect:true}, {text:"They drinks coffee", isCorrect:false}, {text:"They drinking coffee", isCorrect:false}, {text:"They drank coffee every day", isCorrect:false}], rationale: "Com 'they' usamos o verbo na forma base."}
            ],
            9: [ // AULA 08: BASIC ADJECTIVES
                {q: "Escolha o oposto de big:", options: [{text:"tall", isCorrect:false}, {text:"small", isCorrect:true}, {text:"old", isCorrect:false}, {text:"good", isCorrect:false}], rationale: "Big (grande) x Small (pequeno)."},
                {q: "Escolha a frase correta:", options: [{text:"The house is big", isCorrect:true}, {text:"The house big is", isCorrect:false}, {text:"Big the house is", isCorrect:false}, {text:"House is the big", isCorrect:false}], rationale: "Ordem: Sujeito + is + adjetivo."},
                {q: "Escolha o oposto de tall:", options: [{text:"big", isCorrect:false}, {text:"old", isCorrect:false}, {text:"short", isCorrect:true}, {text:"small", isCorrect:false}], rationale: "Tall (alto) x Short (baixo)."},
                {q: "Complete a frase: 'The car is ____.' (not good)", options: [{text:"big", isCorrect:false}, {text:"bad", isCorrect:true}, {text:"old", isCorrect:false}, {text:"tall", isCorrect:false}], rationale: "Good (bom) x Bad (ruim)."},
                {q: "Complete a frase: 'He is ____.' (not old)", options: [{text:"old", isCorrect:false}, {text:"bad", isCorrect:false}, {text:"young", isCorrect:true}, {text:"short", isCorrect:false}], rationale: "Old (velho) x Young (jovem)."},
                {q: "Escolha o oposto de young:", options: [{text:"tall", isCorrect:false}, {text:"small", isCorrect:false}, {text:"old", isCorrect:true}, {text:"big", isCorrect:false}], rationale: "Young (jovem) x Old (velho)."},
                {q: "Escolha a frase correta:", options: [{text:"The dog is small", isCorrect:true}, {text:"The dog small is", isCorrect:false}, {text:"Small is the dog", isCorrect:false}, {text:"Dog is small the", isCorrect:false}], rationale: "Ordem: Sujeito + is + adjetivo."},
                {q: "Complete a frase: 'The building is ____.' (not short)", options: [{text:"tall", isCorrect:true}, {text:"small", isCorrect:false}, {text:"young", isCorrect:false}, {text:"bad", isCorrect:false}], rationale: "Short (baixo) x Tall (alto)."},
                {q: "Escolha o oposto de good:", options: [{text:"big", isCorrect:false}, {text:"old", isCorrect:false}, {text:"bad", isCorrect:true}, {text:"small", isCorrect:false}], rationale: "Good (bom) x Bad (ruim)."},
                {q: "Qual op√ß√£o √© um adjetivo?", options: [{text:"run", isCorrect:false}, {text:"eat", isCorrect:false}, {text:"old", isCorrect:true}, {text:"speak", isCorrect:false}], rationale: "Old √© adjetivo, os outros s√£o verbos."}
            ],
            10: [ // AULA 09: DEMONSTRATIVE PRONOUNS
                {q: "Complete a frase: '____ is my phone.' (perto, singular)", options: [{text:"that", isCorrect:false}, {text:"these", isCorrect:false}, {text:"this", isCorrect:true}, {text:"those", isCorrect:false}], rationale: "This = perto + singular."},
                {q: "Complete a frase: '____ are my keys.' (perto, plural)", options: [{text:"this", isCorrect:false}, {text:"that", isCorrect:false}, {text:"those", isCorrect:false}, {text:"these", isCorrect:true}], rationale: "These = perto + plural."},
                {q: "Complete a frase: '____ is my house over there.' (longe, singular)", options: [{text:"this", isCorrect:false}, {text:"these", isCorrect:false}, {text:"that", isCorrect:true}, {text:"those", isCorrect:false}], rationale: "That = longe + singular."},
                {q: "Complete a frase: '____ are those people.' (longe, plural)", options: [{text:"this", isCorrect:false}, {text:"that", isCorrect:false}, {text:"these", isCorrect:false}, {text:"those", isCorrect:true}], rationale: "Those = longe + plural."},
                {q: "Escolha a frase correta:", options: [{text:"This are my books", isCorrect:false}, {text:"These is my books", isCorrect:false}, {text:"These are my books", isCorrect:true}, {text:"Those is my books", isCorrect:false}], rationale: "These (plural) + are."},
                {q: "Complete a frase: '____ pen here is blue.' (perto)", options: [{text:"that", isCorrect:false}, {text:"those", isCorrect:false}, {text:"these", isCorrect:false}, {text:"this", isCorrect:true}], rationale: "This = perto + singular."},
                {q: "Complete a frase: '____ cars over there are expensive.'", options: [{text:"this", isCorrect:false}, {text:"that", isCorrect:false}, {text:"these", isCorrect:false}, {text:"those", isCorrect:true}], rationale: "Those = longe + plural."},
                {q: "Qual op√ß√£o √© plural?", options: [{text:"this", isCorrect:false}, {text:"that", isCorrect:false}, {text:"these", isCorrect:true}, {text:"thises", isCorrect:false}], rationale: "These √© a forma plural de this."},
                {q: "Escolha a frase correta:", options: [{text:"That are my shoes", isCorrect:false}, {text:"Those are my shoes", isCorrect:true}, {text:"Those is my shoes", isCorrect:false}, {text:"That is my shoes", isCorrect:false}], rationale: "Those (plural) + are."},
                {q: "Quando usamos this?", options: [{text:"Para algo longe e plural", isCorrect:false}, {text:"Para algo perto e singular", isCorrect:true}, {text:"Para algo longe e singular", isCorrect:false}, {text:"Para algo perto e plural", isCorrect:false}], rationale: "This = perto + singular."}
            ],
            11: [ // AULA 10: VERB TO BE
                {q: "Complete a frase: 'I ____ tired.'", options: [{text:"is", isCorrect:false}, {text:"are", isCorrect:false}, {text:"am", isCorrect:true}, {text:"be", isCorrect:false}], rationale: "I + am."},
                {q: "Complete a frase: 'She ____ a teacher.'", options: [{text:"am", isCorrect:false}, {text:"are", isCorrect:false}, {text:"is", isCorrect:true}, {text:"be", isCorrect:false}], rationale: "She + is."},
                {q: "Complete a frase: 'They ____ at home.'", options: [{text:"is", isCorrect:false}, {text:"am", isCorrect:false}, {text:"be", isCorrect:false}, {text:"are", isCorrect:true}], rationale: "They + are."},
                {q: "Escolha a frase correta:", options: [{text:"He are happy", isCorrect:false}, {text:"He am happy", isCorrect:false}, {text:"He is happy", isCorrect:true}, {text:"He be happy", isCorrect:false}], rationale: "He + is."},
                {q: "Complete a frase: 'We ____ students.'", options: [{text:"is", isCorrect:false}, {text:"am", isCorrect:false}, {text:"are", isCorrect:true}, {text:"be", isCorrect:false}], rationale: "We + are."},
                {q: "Escolha a frase correta:", options: [{text:"I is Brazilian", isCorrect:false}, {text:"I are Brazilian", isCorrect:false}, {text:"I am Brazilian", isCorrect:true}, {text:"I be Brazilian", isCorrect:false}], rationale: "I + am."},
                {q: "Complete a pergunta: '____ you married?'", options: [{text:"am", isCorrect:false}, {text:"is", isCorrect:false}, {text:"are", isCorrect:true}, {text:"be", isCorrect:false}], rationale: "You + are."},
                {q: "Escolha a resposta correta: ‚Äî Are they friends?", options: [{text:"Yes, they is", isCorrect:false}, {text:"Yes, they are", isCorrect:true}, {text:"Yes, they am", isCorrect:false}, {text:"Yes, they be", isCorrect:false}], rationale: "They + are."},
                {q: "Escolha a forma negativa correta: 'She ____ happy.'", options: [{text:"isn't", isCorrect:true}, {text:"aren't", isCorrect:false}, {text:"am not", isCorrect:false}, {text:"don't", isCorrect:false}], rationale: "She + isn't (is not)."},
                {q: "Escolha a frase correta:", options: [{text:"We is ready", isCorrect:false}, {text:"We am ready", isCorrect:false}, {text:"We are ready", isCorrect:true}, {text:"We be ready", isCorrect:false}], rationale: "We + are."}
            ]
        };

        // Fallback generator for other modules to ensure 10 questions exist
        function getQuizDataForModule(id) {
            if (quizData[id]) return quizData[id];

            // Generic fallback questions based on module name
            const modName = aulaNames.find(a => a.id === id).name;
            const generic = [];
            for(let i=0; i<10; i++) {
                generic.push({
                    q: `Qual a op√ß√£o correta?`,
                    options: [
                        {text: "Op√ß√£o Correta", isCorrect: true},
                        {text: "Op√ß√£o Errada 1", isCorrect: false},
                        {text: "Op√ß√£o Errada 2", isCorrect: false},
                        {text: "Op√ß√£o Errada 3", isCorrect: false}
                    ],
                    rationale: "Esta √© uma pergunta de treino gerada para completar o exerc√≠cio."
                });
            }
            return generic;
        }

        let currentQuestion = null;
        let questionsPool = [];
        let answerSubmitted = false;
        let currentFlashcardIdx = 0;
        let currentShuffledCards = [];
        let currentShuffledData = []; 
        let currentIdx = 0; 
        let scrambleResult = [];

        // Web Speech API - funciona em qualquer navegador moderno, sem precisar de API key
        function speakText(text) {
            return new Promise((resolve) => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    // Evita que "I" seja lido como "capital I"
                    let processedText = text;
                    if (text === "I") {
                        processedText = "i";
                    }
                    const utterance = new SpeechSynthesisUtterance(processedText);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.9;
                    utterance.pitch = 1;
                    
                    // Tenta encontrar uma voz em ingl√™s
                    const voices = window.speechSynthesis.getVoices();
                    const englishVoice = voices.find(v => v.lang.startsWith('en')) || voices[0];
                    if (englishVoice) utterance.voice = englishVoice;
                    
                    utterance.onend = () => resolve();
                    utterance.onerror = () => resolve();
                    window.speechSynthesis.speak(utterance);
                } else {
                    resolve();
                }
            });
        }
        
        // Carrega vozes quando dispon√≠veis
        if ('speechSynthesis' in window) {
            window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();
        }

        async function fetchTTSAudio(text) {
            // Retorna um objeto compat√≠vel com a interface esperada
            return {
                play: () => speakText(text),
                pause: () => window.speechSynthesis.cancel()
            };
        }

        window.showDashboard = function() {
            document.getElementById('dashboard-view').classList.remove('hidden');
            document.getElementById('generator-view').classList.add('hidden');
            document.getElementById('study-view').classList.add('hidden');
        };

        window.scrollToModule = function(id) {
            const el = document.getElementById(`module-${id}`);
            if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        window.filterModules = function(query) {
            const cards = document.querySelectorAll('#level-cards-container > div');
            const normalizedQuery = query.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
            cards.forEach(card => {
                const title = card.querySelector('.font-bold')?.textContent || '';
                const normalizedTitle = title.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
                if (normalizedTitle.includes(normalizedQuery) || normalizedQuery === '') {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function renderDashboard() {
            const container = document.getElementById('level-cards-container');
            container.innerHTML = aulaNames.map(aula => {
                let studyLabel = '';
                if (aula.specialMode === 'flashcards') studyLabel = 'FLASHCARDS';
                else if (aula.specialMode === 'listening') studyLabel = 'LISTENING';
                else if (aula.specialMode === 'chunks') studyLabel = 'CHUNKS';
                else if (aula.specialMode === 'mistake') studyLabel = 'DETETIVE';
                else if (aula.specialMode === 'scramble') studyLabel = 'SCRAMBLE';

                const sBtn = studyLabel ? `<button class="secondary-button text-xs" onclick="openStudy(${aula.id})">${studyLabel}</button>` : '';
                const tBtn = (aula.id === 23) ? `<button class="secondary-button text-xs" onclick="openFlashcards(23)">FLASHCARDS</button>` : '';
                const dBtn = (aula.thirdBtn === 'dictation') ? `<button class="secondary-button text-xs" onclick="openDictation(${aula.id})">DICTATION</button>` : '';
                const hBtn = ([6, 23, 26].includes(aula.id)) ? `<button class="secondary-button text-xs" onclick="openHangman(${aula.id})">HANGMAN</button>` : '';
                const cBtn = ([12, 14].includes(aula.id)) ? `<button class="secondary-button text-xs" onclick="openCrossword(${aula.id})">CROSSWORD</button>` : '';

                return `
                <div class="level-card relative ${!aula.hasHomework ? 'locked' : ''}" id="module-${aula.id}">
                    ${!aula.hasHomework ? `
                        <div class="lock-overlay">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                        </div>
                    ` : `<img src="https://res.cloudinary.com/dqfi22uz0/image/upload/v1760657894/SLAP_ICON_PRETO_2_2_tv8bmp.png" alt="Logo" class="absolute top-4 right-4 w-8 h-8 opacity-10">`}
                    <div>
                        <span class="module-tag">STARTER 1 - HW AULA ${String(aula.id).padStart(2, '0')}</span>
                        <h3 class="text-xl font-bold text-stone-800 mb-2 mt-2">${aula.name}</h3>
                        <p class="text-stone-500 text-sm mb-6">${aula.hasHomework ? 'Pratique as estruturas aprendidas em aula.' : 'Sem homework dispon√≠vel.'}</p>
                    </div>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-1">
                        ${sBtn} ${tBtn} ${dBtn} ${hBtn} ${cBtn}
                        <button class="action-button text-xs uppercase text-center" ${!aula.hasHomework ? 'disabled' : `onclick="openPractice(${aula.id})"`}>HOMEWORK</button>
                    </div>
                </div>`
            }).join('');
        }

        window.openPractice = function(id) {
            currentAulaId = id; 
            const aula = aulaNames.find(a => a.id === id);
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('generator-view').classList.remove('hidden');
            document.getElementById('current-hw-display').textContent = "Homework: " + aulaNames.find(a => a.id===id).name;
            quizStreak = 0; renderQuizStreak(); loadNextQuestion();
        };

        window.loadNextQuestion = function() {
            if (quizStreak >= STREAK_GOAL) {
                document.getElementById('main-question').innerHTML = `<div class="text-center py-4"><div class="text-6xl mb-4">üì∏</div><h2 class="text-2xl font-bold">Miss√£o Cumprida!</h2><p class="text-stone-500">Tire um print para o seu Teacher!</p></div>`;
                document.getElementById('options-container').innerHTML = `<button class="action-button" onclick="showDashboard()">Voltar</button>`;
                document.getElementById('rationale-display').classList.add('hidden');
                document.getElementById('feedback-alert').classList.add('hidden');
                return;
            }

            if (questionsPool.length === 0) {
                 questionsPool = shuffle([...getQuizDataForModule(currentAulaId)]); 
            }

            currentQuestion = questionsPool.pop();

            document.getElementById('main-question').textContent = currentQuestion.q;
            document.getElementById('rationale-display').classList.add('hidden');
            document.getElementById('feedback-alert').classList.add('hidden');
            answerSubmitted = false;

            const container = document.getElementById('options-container');
            container.innerHTML = currentQuestion.options.map((opt, i) => 
                `<button class="option-button w-full border-2 border-slate-200 p-4 rounded-xl font-bold text-left hover:border-indigo-400 transition-all flex items-center" onclick="submitAnswer(${idxToBool(opt.isCorrect)}, ${i}, '${(currentQuestion.rationale || "").replace(/'/g, "\\'")}')">
                    <span class="w-8 h-8 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center font-bold mr-3 flex-shrink-0 text-sm border border-indigo-100">${String.fromCharCode(65+i)}</span>
                    <span>${opt.text}</span>
                </button>`
            ).join('');
        };

        function idxToBool(val) { return val ? 'true' : 'false'; } 

        window.submitAnswer = function(correct, idx, rationale) {
            if (answerSubmitted) return;
            answerSubmitted = true;
            const alert = document.getElementById('feedback-alert');

            if (correct) {
                alert.textContent = "Muito bem!";
                alert.className = `p-3 mb-6 rounded-lg text-green-900 font-semibold text-center bg-green-100 border border-green-300`;
                quizStreak++;
            } else {
                alert.textContent = "Que pena! O streak reiniciou.";
                alert.className = `p-3 mb-6 rounded-lg text-red-900 font-semibold text-center bg-red-100 border border-red-300`;
                quizStreak = 0;
            }
            renderQuizStreak();

            document.getElementById('rationale-content').textContent = rationale;
            document.getElementById('rationale-display').classList.remove('hidden');
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.disabled = true;
                if (i === idx) {
                   if(correct) btn.classList.add('bg-green-50', 'border-green-400');
                   else btn.classList.add('bg-red-50', 'border-red-400');
                }
            });
        };

        function renderQuizStreak() {
            const progress = Math.min(quizStreak, STREAK_GOAL);
            const percentage = (progress / STREAK_GOAL) * 100;
            const isComplete = quizStreak >= STREAK_GOAL;
            document.getElementById('quiz-streak-bar').innerHTML = `
                <div class="streak-bar-wrapper">
                    <div class="streak-label text-center">
                        ${isComplete ? 'üéâ Streak completo! Tire um print!' : `Complete ${STREAK_GOAL} acertos seguidos: ${progress}/${STREAK_GOAL}`}
                    </div>
                    <div class="streak-bar-bg">
                        <div class="streak-bar-fill" style="width: ${percentage}%"></div>
                    </div>
                </div>
            `;
        }

        window.openStudy = function(id) {
            const aula = aulaNames.find(a => a.id === id);
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('study-view').classList.remove('hidden');
            const titleArea = document.getElementById('study-title');
            const instrArea = document.getElementById('study-instruction');
            const contentArea = document.getElementById('study-content-area');
            const statusArea = document.getElementById('preloading-status');

            titleArea.textContent = aula.name;
            statusArea.textContent = "";
            currentIdx = 0;
            currentStreak = 0; // Reset streak
            renderStreakBar(); // Initial render

            if (aula.specialMode === 'flashcards') {
                instrArea.textContent = "Toque na carta para ver a tradu√ß√£o.";
                currentFlashcardIdx = 0; 
                currentShuffledCards = shuffle([...flashcardsData[id]]); 
                renderFlashcards();
            } else if (aula.specialMode === 'listening') {
                instrArea.textContent = "Toque no item para ouvir.";
                renderListeningBoard(aula.items);
            } else if (aula.specialMode === 'chunks') {
                titleArea.textContent = "CHUNKS OF LANGUAGE";
                instrArea.textContent = "Clique no olho para revelar.";
                renderChunksGrid(chunksData[id]);
            } else if (aula.specialMode === 'mistake') {
                instrArea.textContent = "Clique na palavra que cont√©m o erro.";
                currentShuffledData = shuffle([...gamesData[id]]);
                renderMistake();
            } else if (aula.specialMode === 'scramble') {
                instrArea.textContent = "Ordene as palavras para formar a frase.";
                currentShuffledData = shuffle([...gamesData[id]]);
                renderScramble();
            }
        };

        window.openFlashcards = function(id) {
            const aula = aulaNames.find(a => a.id === id);
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('study-view').classList.remove('hidden');
            document.getElementById('study-title').textContent = "Flashcards: Holidays";
            currentFlashcardIdx = 0; currentShuffledCards = shuffle([...flashcardsData[id]]); renderFlashcards();
        }

        let isSpellingMode = false;
        window.openDictation = function(id) {
             const aula = aulaNames.find(a => a.id === id);
             isSpellingMode = gamesData[id].isSpelling || false;
             document.getElementById('dashboard-view').classList.add('hidden');
             document.getElementById('study-view').classList.remove('hidden');
             document.getElementById('study-title').textContent = "Dictation Mode";
             document.getElementById('study-instruction').textContent = isSpellingMode 
                 ? "Ou√ßa as letras e escreva a palavra soletrada."
                 : "Ou√ßa o √°udio e escreva o que ouvir (n√∫meros ou extenso).";
             currentShuffledData = shuffle([...gamesData[id].dictation]);
             currentIdx = 0;
             currentStreak = 0; // Reset Streak
             renderStreakBar(); // Initial render
             renderDictation();
        }

        // HANGMAN GAME
        const hangmanWordLists = {
            6: [ // Spelling - 10 palavras
                {word: "CAR", hint: "Ve√≠culo com 4 rodas"},
                {word: "DOG", hint: "Melhor amigo do homem"},
                {word: "CAT", hint: "Animal que mia"},
                {word: "BUS", hint: "Transporte p√∫blico"},
                {word: "SUN", hint: "Estrela que ilumina o dia"},
                {word: "HAT", hint: "Acess√≥rio para a cabe√ßa"},
                {word: "PEN", hint: "Usamos para escrever"},
                {word: "RED", hint: "Cor do cora√ß√£o"},
                {word: "BOX", hint: "Caixa em ingl√™s"},
                {word: "CUP", hint: "Usamos para beber caf√©"}
            ],
            23: [ // Months and Holidays - 10 palavras
                {word: "JANUARY", hint: "Primeiro m√™s do ano"},
                {word: "FEBRUARY", hint: "M√™s do carnaval"},
                {word: "MARCH", hint: "Terceiro m√™s do ano"},
                {word: "APRIL", hint: "M√™s da P√°scoa"},
                {word: "MAY", hint: "M√™s das m√£es"},
                {word: "JUNE", hint: "M√™s das festas juninas"},
                {word: "JULY", hint: "M√™s das f√©rias de inverno"},
                {word: "AUGUST", hint: "M√™s dos pais"},
                {word: "CHRISTMAS", hint: "Feriado em 25 de dezembro"},
                {word: "EASTER", hint: "Feriado do coelhinho"}
            ],
            26: [ // Foods and Fruits - 10 palavras
                {word: "APPLE", hint: "Fruta vermelha ou verde"},
                {word: "BANANA", hint: "Fruta amarela e comprida"},
                {word: "ORANGE", hint: "Fruta c√≠trica laranja"},
                {word: "GRAPE", hint: "Fruta pequena usada para vinho"},
                {word: "LEMON", hint: "Fruta azeda e amarela"},
                {word: "BREAD", hint: "Alimento feito de farinha"},
                {word: "CHEESE", hint: "Derivado do leite"},
                {word: "RICE", hint: "Gr√£o branco do almo√ßo"},
                {word: "PIZZA", hint: "Comida italiana redonda"},
                {word: "JUICE", hint: "Bebida de frutas"}
            ]
        };
        let currentHangmanList = [];
        let hangmanWord = "";
        let hangmanHint = "";
        let hangmanGuessed = [];
        let hangmanWrong = 0;
        const hangmanMaxWrong = 6;

        window.openHangman = function(moduleId) {
            currentHangmanList = hangmanWordLists[moduleId] || hangmanWordLists[6];
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('study-view').classList.remove('hidden');
            document.getElementById('study-title').textContent = "Hangman";
            document.getElementById('study-instruction').textContent = "Adivinhe a palavra letra por letra!";
            currentStreak = 0;
            renderStreakBar();
            startNewHangman();
        }

        function startNewHangman() {
            const item = currentHangmanList[Math.floor(Math.random() * currentHangmanList.length)];
            hangmanWord = item.word;
            hangmanHint = item.hint;
            hangmanGuessed = [];
            hangmanWrong = 0;
            renderHangman();
        }

        function renderHangman() {
            const area = document.getElementById('study-content-area');
            renderStreakBar();

            if (currentStreak >= STREAK_GOAL) {
                area.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-10">
                        <div class="text-6xl mb-4">üèÜ</div>
                        <h2 class="text-3xl font-bold text-stone-800 mb-2">Miss√£o Cumprida!</h2>
                        <p class="text-stone-500 mb-8">Voc√™ acertou ${STREAK_GOAL} palavras seguidas no Hangman!</p>
                        <button class="action-button px-8" onclick="showDashboard()">Voltar</button>
                        <button class="secondary-button mt-4" onclick="currentStreak=0; startNewHangman()">Jogar Novamente</button>
                    </div>`;
                return;
            }

            const wordDisplay = hangmanWord.split('').map(letter => 
                hangmanGuessed.includes(letter) ? letter : '_'
            ).join(' ');
            
            const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
            const keyboard = alphabet.map(letter => {
                const used = hangmanGuessed.includes(letter);
                const isWrong = used && !hangmanWord.includes(letter);
                const isCorrect = used && hangmanWord.includes(letter);
                return `<button 
                    class="w-9 h-9 m-0.5 rounded-lg font-bold text-sm transition ${used ? (isCorrect ? 'bg-green-500 text-white' : 'bg-red-400 text-white opacity-50') : 'bg-white border-2 border-stone-200 hover:border-primary hover:bg-primary/5'}"
                    ${used ? 'disabled' : `onclick="guessLetter('${letter}')"`}
                >${letter}</button>`;
            }).join('');

            area.innerHTML = `
                <div class="flex flex-col items-center gap-6">
                    <svg width="200" height="200" viewBox="0 0 200 200" class="bg-white rounded-xl p-4">
                        <line x1="40" y1="180" x2="160" y2="180" stroke="#44403c" stroke-width="4"/>
                        <line x1="60" y1="180" x2="60" y2="20" stroke="#44403c" stroke-width="4"/>
                        <line x1="60" y1="20" x2="120" y2="20" stroke="#44403c" stroke-width="4"/>
                        <line x1="120" y1="20" x2="120" y2="40" stroke="#44403c" stroke-width="4"/>
                        ${hangmanWrong >= 1 ? '<circle cx="120" cy="55" r="15" stroke="#8671d1" stroke-width="3" fill="none"/>' : ''}
                        ${hangmanWrong >= 2 ? '<line x1="120" y1="70" x2="120" y2="110" stroke="#8671d1" stroke-width="3"/>' : ''}
                        ${hangmanWrong >= 3 ? '<line x1="120" y1="80" x2="100" y2="100" stroke="#8671d1" stroke-width="3"/>' : ''}
                        ${hangmanWrong >= 4 ? '<line x1="120" y1="80" x2="140" y2="100" stroke="#8671d1" stroke-width="3"/>' : ''}
                        ${hangmanWrong >= 5 ? '<line x1="120" y1="110" x2="100" y2="140" stroke="#8671d1" stroke-width="3"/>' : ''}
                        ${hangmanWrong >= 6 ? '<line x1="120" y1="110" x2="140" y2="140" stroke="#8671d1" stroke-width="3"/>' : ''}
                    </svg>
                    <div class="text-4xl font-bold tracking-widest text-stone-800">${wordDisplay}</div>
                    <div class="bg-amber-100 text-amber-800 px-4 py-2 rounded-lg text-sm font-medium">üí° Dica: ${hangmanHint}</div>
                    <div class="text-sm text-stone-500">Erros: ${hangmanWrong}/${hangmanMaxWrong}</div>
                    <div class="flex flex-wrap justify-center max-w-xs">${keyboard}</div>
                    <div id="hangman-result"></div>
                </div>
            `;
        }

        window.guessLetter = function(letter) {
            if (hangmanGuessed.includes(letter)) return;
            hangmanGuessed.push(letter);
            
            // Ler a letra em voz alta
            speakText(letter.toLowerCase());

            if (!hangmanWord.includes(letter)) {
                hangmanWrong++;
            }

            renderHangman();

            const allRevealed = hangmanWord.split('').every(l => hangmanGuessed.includes(l));
            const resultDiv = document.getElementById('hangman-result');

            if (allRevealed) {
                currentStreak++;
                renderStreakBar();
                resultDiv.innerHTML = `<div class="text-green-600 font-bold text-lg mb-2">Parab√©ns! Voc√™ acertou!</div>
                    <button class="action-button" onclick="startNewHangman()">Pr√≥xima Palavra</button>`;
            } else if (hangmanWrong >= hangmanMaxWrong) {
                currentStreak = 0;
                renderStreakBar();
                resultDiv.innerHTML = `<div class="text-red-600 font-bold text-lg mb-2">Game Over! A palavra era: ${hangmanWord}</div>
                    <button class="action-button" onclick="startNewHangman()">Tentar Novamente</button>`;
            }
        }

        // CROSSWORD GAME
        const crosswordData = {
            12: [ // Countries - 5 puzzles
                { words: [
                    {word: "CHINA", hint: "Pa√≠s mais populoso", row: 0, col: 0, dir: "across"},
                    {word: "CUBA", hint: "Ilha do Caribe", row: 0, col: 0, dir: "down"},
                    {word: "BRAZIL", hint: "Pa√≠s do carnaval", row: 2, col: 0, dir: "across"},
                    {word: "IRAN", hint: "Pa√≠s do Oriente M√©dio", row: 1, col: 2, dir: "down"}
                ]},
                { words: [
                    {word: "PERU", hint: "Pa√≠s do Machu Picchu", row: 0, col: 0, dir: "across"},
                    {word: "PORTUGAL", hint: "Pa√≠s de Lisboa", row: 0, col: 0, dir: "down"},
                    {word: "RUSSIA", hint: "Maior pa√≠s do mundo", row: 2, col: 1, dir: "across"}
                ]},
                { words: [
                    {word: "JAPAN", hint: "Pa√≠s do sushi", row: 0, col: 0, dir: "across"},
                    {word: "JAMAICA", hint: "Ilha do reggae", row: 0, col: 0, dir: "down"},
                    {word: "MEXICO", hint: "Pa√≠s das tacos", row: 2, col: 1, dir: "across"}
                ]},
                { words: [
                    {word: "EGYPT", hint: "Pa√≠s das pir√¢mides", row: 0, col: 0, dir: "across"},
                    {word: "ENGLAND", hint: "Pa√≠s da rainha", row: 0, col: 0, dir: "down"},
                    {word: "GERMANY", hint: "Pa√≠s da cerveja", row: 2, col: 1, dir: "across"}
                ]},
                { words: [
                    {word: "INDIA", hint: "Pa√≠s do curry", row: 0, col: 0, dir: "across"},
                    {word: "ITALY", hint: "Pa√≠s da pizza", row: 0, col: 0, dir: "down"},
                    {word: "SPAIN", hint: "Pa√≠s do flamenco", row: 2, col: 2, dir: "across"}
                ]}
            ],
            14: [ // Family Members - 5 puzzles
                { words: [
                    {word: "SON", hint: "Filho em ingl√™s", row: 0, col: 0, dir: "across"},
                    {word: "SISTER", hint: "Irm√£ em ingl√™s", row: 0, col: 0, dir: "down"},
                    {word: "UNCLE", hint: "Tio em ingl√™s", row: 2, col: 1, dir: "across"},
                    {word: "AUNT", hint: "Tia em ingl√™s", row: 2, col: 1, dir: "down"}
                ]},
                { words: [
                    {word: "DAD", hint: "Pai informal", row: 0, col: 0, dir: "across"},
                    {word: "DAUGHTER", hint: "Filha em ingl√™s", row: 0, col: 0, dir: "down"},
                    {word: "GRANDMA", hint: "Av√≥ em ingl√™s", row: 2, col: 1, dir: "across"}
                ]},
                { words: [
                    {word: "MOM", hint: "M√£e informal", row: 0, col: 0, dir: "across"},
                    {word: "MOTHER", hint: "M√£e formal", row: 0, col: 0, dir: "down"},
                    {word: "HUSBAND", hint: "Marido em ingl√™s", row: 2, col: 2, dir: "across"}
                ]},
                { words: [
                    {word: "WIFE", hint: "Esposa em ingl√™s", row: 0, col: 0, dir: "across"},
                    {word: "WOMAN", hint: "Mulher em ingl√™s", row: 0, col: 0, dir: "down"},
                    {word: "NEPHEW", hint: "Sobrinho em ingl√™s", row: 2, col: 1, dir: "across"}
                ]},
                { words: [
                    {word: "BABY", hint: "Beb√™ em ingl√™s", row: 0, col: 0, dir: "across"},
                    {word: "BROTHER", hint: "Irm√£o em ingl√™s", row: 0, col: 0, dir: "down"},
                    {word: "COUSIN", hint: "Primo em ingl√™s", row: 2, col: 2, dir: "across"}
                ]}
            ]
        };
        let currentCrosswordList = [];
        let currentCrosswordIdx = 0;
        let currentCrossword = null;
        let crosswordStreak = 0;

        window.openCrossword = function(moduleId) {
            currentCrosswordList = crosswordData[moduleId] || [];
            currentCrosswordIdx = Math.floor(Math.random() * currentCrosswordList.length);
            currentCrossword = currentCrosswordList[currentCrosswordIdx];
            crosswordStreak = 0;
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('study-view').classList.remove('hidden');
            document.getElementById('study-title').textContent = "Crossword";
            document.getElementById('study-instruction').textContent = "Preencha as palavras cruzadas!";
            startNewCrossword();
        }

        function startNewCrossword() {
            currentCrosswordIdx = Math.floor(Math.random() * currentCrosswordList.length);
            currentCrossword = currentCrosswordList[currentCrosswordIdx];
            crosswordAnswers = {};
            renderCrosswordStreakBar();
            renderCrossword();
        }

        function renderCrosswordStreakBar() {
            const container = document.getElementById('streak-bar-container');
            container.classList.remove('hidden');
            const progress = Math.min(crosswordStreak, CROSSWORD_STREAK_GOAL);
            const percentage = (progress / CROSSWORD_STREAK_GOAL) * 100;
            const isComplete = crosswordStreak >= CROSSWORD_STREAK_GOAL;
            container.innerHTML = `
                <div class="streak-bar-bg">
                    <div class="streak-bar-fill ${isComplete ? 'complete' : ''}" style="width: ${percentage}%"></div>
                </div>
                <p class="text-sm text-stone-500 mt-2 text-center">
                    ${isComplete ? 'üéâ Streak completo! Tire um print!' : `Complete ${CROSSWORD_STREAK_GOAL} puzzles seguidos: ${progress}/${CROSSWORD_STREAK_GOAL}`}
                </p>`;
        }

        function renderCrossword() {
            const area = document.getElementById('study-content-area');
            const words = currentCrossword.words;
            
            // Calculate grid size
            let maxRow = 0, maxCol = 0;
            words.forEach(w => {
                if (w.dir === 'across') {
                    maxRow = Math.max(maxRow, w.row);
                    maxCol = Math.max(maxCol, w.col + w.word.length - 1);
                } else {
                    maxRow = Math.max(maxRow, w.row + w.word.length - 1);
                    maxCol = Math.max(maxCol, w.col);
                }
            });
            
            // Create grid
            const grid = Array(maxRow + 1).fill(null).map(() => Array(maxCol + 1).fill(null));
            const cellNumbers = Array(maxRow + 1).fill(null).map(() => Array(maxCol + 1).fill(''));
            
            words.forEach((w, idx) => {
                for (let i = 0; i < w.word.length; i++) {
                    const r = w.dir === 'down' ? w.row + i : w.row;
                    const c = w.dir === 'across' ? w.col + i : w.col;
                    grid[r][c] = {letter: w.word[i], wordIdx: idx, pos: i};
                    if (i === 0) cellNumbers[r][c] = idx + 1;
                }
            });
            
            // Render grid
            let gridHtml = `<div class="crossword-grid" style="grid-template-columns: repeat(${maxCol + 1}, 1fr)">`;
            for (let r = 0; r <= maxRow; r++) {
                for (let c = 0; c <= maxCol; c++) {
                    if (grid[r][c]) {
                        const num = cellNumbers[r][c];
                        gridHtml += `<div class="crossword-cell">
                            ${num ? `<span class="crossword-num">${num}</span>` : ''}
                            <input type="text" maxlength="1" class="crossword-input" data-row="${r}" data-col="${c}" data-letter="${grid[r][c].letter}" onkeyup="checkCrosswordCell(this, event)">
                        </div>`;
                    } else {
                        gridHtml += '<div class="crossword-cell-empty"></div>';
                    }
                }
            }
            gridHtml += '</div>';
            
            // Render hints
            let hintsHtml = '<div class="crossword-hints"><div class="mb-4"><h4 class="font-bold text-stone-700 mb-2">Horizontal (‚Üí)</h4>';
            words.filter(w => w.dir === 'across').forEach((w, i) => {
                const num = words.indexOf(w) + 1;
                hintsHtml += `<p class="text-sm text-stone-600 mb-1"><span class="font-bold">${num}.</span> ${w.hint}</p>`;
            });
            hintsHtml += '</div><div><h4 class="font-bold text-stone-700 mb-2">Vertical (‚Üì)</h4>';
            words.filter(w => w.dir === 'down').forEach((w, i) => {
                const num = words.indexOf(w) + 1;
                hintsHtml += `<p class="text-sm text-stone-600 mb-1"><span class="font-bold">${num}.</span> ${w.hint}</p>`;
            });
            hintsHtml += '</div></div>';
            
            area.innerHTML = `
                <div class="flex flex-col lg:flex-row gap-6 items-start justify-center">
                    ${gridHtml}
                    ${hintsHtml}
                </div>
                <div class="flex gap-4 mt-6 justify-center">
                    <button class="action-button" onclick="checkCrossword()">Verificar</button>
                </div>
                <div id="crossword-result" class="mt-4 text-center"></div>
            `;
        }

        window.checkCrosswordCell = function(input, event) {
            input.value = input.value.toUpperCase();
            if (event.key.length === 1 && event.key.match(/[a-zA-Z]/)) {
                const inputs = document.querySelectorAll('.crossword-input');
                const idx = Array.from(inputs).indexOf(input);
                if (idx < inputs.length - 1) inputs[idx + 1].focus();
            }
        }

        window.checkCrossword = function() {
            const inputs = document.querySelectorAll('.crossword-input');
            let allCorrect = true;
            inputs.forEach(inp => {
                const correct = inp.dataset.letter.toUpperCase();
                const val = inp.value.toUpperCase();
                if (val === correct) {
                    inp.classList.remove('bg-red-100');
                    inp.classList.add('bg-green-100');
                } else {
                    inp.classList.remove('bg-green-100');
                    inp.classList.add('bg-red-100');
                    allCorrect = false;
                }
            });
            const resultDiv = document.getElementById('crossword-result');
            if (allCorrect) {
                crosswordStreak++;
                renderCrosswordStreakBar();
                if (crosswordStreak >= CROSSWORD_STREAK_GOAL) {
                    document.getElementById('study-content-area').innerHTML = `
                        <div class="flex flex-col items-center justify-center py-10">
                            <div class="text-6xl mb-4">üèÜ</div>
                            <h2 class="text-3xl font-bold text-stone-800 mb-2">Miss√£o Cumprida!</h2>
                            <p class="text-stone-500 mb-8">Voc√™ completou ${CROSSWORD_STREAK_GOAL} crosswords seguidos!</p>
                            <button class="action-button px-8" onclick="showDashboard()">Voltar</button>
                            <button class="secondary-button mt-4" onclick="crosswordStreak=0; startNewCrossword()">Jogar Novamente</button>
                        </div>`;
                } else {
                    resultDiv.innerHTML = `<div class="text-green-600 font-bold text-lg mb-4">üéâ Parab√©ns! Crossword completo!</div>
                        <button class="action-button" onclick="startNewCrossword()">Pr√≥ximo Crossword</button>`;
                }
            } else {
                resultDiv.innerHTML = '<div class="text-amber-600 font-medium">Algumas letras est√£o incorretas. Tente novamente!</div>';
            }
        }

        window.toggleChunk = function(index) {
            const text = document.getElementById(`chunk-pt-${index}`);
            text.classList.toggle('translation-hidden');
            text.classList.toggle('translation-visible');
        }

        function renderStreakBar() {
            const container = document.getElementById('streak-bar-container');
            const title = document.getElementById('study-title').textContent;
            if (title.includes("Dictation") || title.includes("Scramble") || title.includes("Hangman") || document.getElementById('study-instruction').textContent.includes("Ordene")) {
                container.classList.remove('hidden');
                const progress = Math.min(currentStreak, STREAK_GOAL);
                const percentage = (progress / STREAK_GOAL) * 100;
                const isComplete = currentStreak >= STREAK_GOAL;
                container.innerHTML = `
                    <div class="streak-bar-wrapper">
                        <div class="streak-label text-center">
                            ${isComplete ? 'üéâ Streak completo! Tire um print!' : `Complete ${STREAK_GOAL} acertos seguidos: ${progress}/${STREAK_GOAL}`}
                        </div>
                        <div class="streak-bar-bg">
                            <div class="streak-bar-fill" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            } else {
                container.classList.add('hidden');
            }
        }

        function renderChunksGrid(data) {
            const area = document.getElementById('study-content-area');
            area.innerHTML = `<div class="chunks-grid shadow-lg">
                <div class="chunks-header">Chunks</div>
                <div class="chunks-header">Tradu√ß√µes</div>
                ${data.map((item, index) => `
                <div class="chunks-cell chunks-cell-en">
                    <button onclick="speakText('${item.en.replace(/'/g, "\\'")}')" class="p-1 mr-2 rounded-full hover:bg-primary/10 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#8671d1" stroke-width="2"><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
                    </button>
                    <span>${item.en}</span>
                </div>
                <div class="chunks-cell chunks-cell-pt"><span id="chunk-pt-${index}" class="translation-hidden">${item.pt}</span>
                    <button onclick="toggleChunk(${index})" class="p-1 ml-2"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button>
                </div>`).join('')}</div>`;
        }

        async function renderListeningBoard(items) {
            const area = document.getElementById('study-content-area');
            area.innerHTML = `<div class="listening-grid"></div>`;
            const grid = area.querySelector('.listening-grid');
            items.forEach((item, i) => {
                const btn = document.createElement('button');
                btn.className = 'number-btn';
                const phonetic = item.p ? `<span class="phonetic-text">${item.p}</span>` : '';
                btn.innerHTML = `<span class="main-text">${item.n || item}</span>${phonetic}<span class="sub-text">${item.w || ''}</span>`;
                btn.onclick = async () => {
                    if (btn.classList.contains('playing')) return;
                    btn.classList.add('playing');
                    const audio = await fetchTTSAudio(item.w || item);
                    if (audio) { 
                        await audio.play(); 
                        btn.classList.remove('playing');
                    } else {
                        btn.classList.remove('playing');
                    }
                };
                grid.appendChild(btn);
            });
        }

        function renderFlashcards() {
            const area = document.getElementById('study-content-area');
            const update = () => {
                const card = currentShuffledCards[currentFlashcardIdx];
                const isText = /[a-zA-Z0-9]/.test(card.front); 
                const frontSize = isText ? 'text-4xl' : 'text-9xl';
                area.innerHTML = `
                    <div class="flashcard-container" onclick="flipAndSpeak(this, '${card.back.replace(/'/g, "\\'")}')">
                        <div class="flashcard"><div class="flashcard-front"><span class="text-xs absolute top-8 opacity-50 font-bold tracking-widest">PORTUGUESE</span><span class="${frontSize} font-bold mt-4">${card.front}</span></div>
                        <div class="flashcard-back"><span class="text-xs absolute top-8 opacity-50 font-bold tracking-widest">ENGLISH</span><span class="text-3xl font-bold mt-4">${card.back}</span>
                        <button class="mt-4 p-2 rounded-full bg-primary/20 hover:bg-primary/30 transition" onclick="event.stopPropagation(); speakText('${card.back.replace(/'/g, "\\'")}')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#8671d1" stroke-width="2"><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>
                        </button></div></div>
                    </div>
                    <div class="flex items-center justify-between max-w-xs mx-auto mt-4">
                        <button class="secondary-button p-3 rounded-full" onclick="changeFC(-1)"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m15 18-6-6 6-6"/></svg></button>
                        <span class="font-bold text-stone-400">${currentFlashcardIdx + 1} / ${currentShuffledCards.length}</span>
                        <button class="secondary-button p-3 rounded-full" onclick="changeFC(1)"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg></button>
                    </div>`;
            };
            window.changeFC = (dir) => { currentFlashcardIdx = (currentFlashcardIdx + dir + currentShuffledCards.length) % currentShuffledCards.length; update(); };
            window.flipAndSpeak = (el, text) => {
                const flashcard = el.querySelector('.flashcard');
                const wasFlipped = flashcard.classList.contains('flipped');
                flashcard.classList.toggle('flipped');
                if (!wasFlipped) { speakText(text); }
            };
            update();
        }

        function renderMistake() {
            const area = document.getElementById('study-content-area');
            renderStreakBar();

            if (currentStreak >= STREAK_GOAL) {
                 area.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-10">
                        <div class="text-6xl mb-4">üì∏</div>
                        <h2 class="text-3xl font-bold text-stone-800 mb-2">Miss√£o Cumprida!</h2>
                        <p class="text-stone-500 mb-8">Tire um print e envie para o seu teacher!</p>
                        <button class="action-button px-8" onclick="showDashboard()">Voltar</button>
                        <button class="secondary-button mt-4" onclick="currentStreak=0; currentShuffledData=shuffle([...currentShuffledData]); renderMistake()">Reiniciar</button>
                    </div>`;
                return;
            }

            const item = currentShuffledData[currentIdx];
            const words = item.sentence.split(' ');
            area.innerHTML = `
                <div class="text-2xl font-bold mb-8 leading-loose">
                    ${words.map(w => `<span class="mistake-word" onclick="checkMistakeClick(this, '${w}', '${item.wrong}', '${item.correct}', '${item.rationale}')">${w}</span>`).join(' ')}
                </div>
                <div id="mistake-fb" class="hidden p-4 rounded-xl mb-4 text-left"></div>
                <button class="action-button w-full hidden" id="mistake-next" onclick="window.nextRound(renderMistake)">Pr√≥xima Frase</button>
            `;
        }

        window.checkMistakeClick = function(el, w, wrong, correct, rationale) {
            const clean = w.replace(/[.,]/g, "");
            const fb = document.getElementById('mistake-fb');
            if (clean === wrong) {
                el.classList.add('correct-choice');
                fb.innerHTML = `<p class="font-bold text-green-800">Correct! O erro era "${wrong}". O certo √© "${correct}".</p><p class="text-sm text-green-700 mt-2">${rationale}</p>`;
                fb.className = "p-4 rounded-xl bg-green-100 block mb-4";
                document.getElementById('mistake-next').classList.remove('hidden');
                document.querySelectorAll('.mistake-word').forEach(m => m.onclick = null);
                currentStreak++;
            } else {
                el.classList.add('wrong-choice');
                currentStreak = 0; // Reset on error
            }
            renderStreakBar();
        };

        function renderScramble() {
            const area = document.getElementById('study-content-area');
            renderStreakBar();

            if (currentStreak >= STREAK_GOAL) {
                area.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-10">
                        <div class="text-6xl mb-4">üèÜ</div>
                        <h2 class="text-3xl font-bold text-stone-800 mb-2">Miss√£o Cumprida!</h2>
                        <p class="text-stone-500 mb-8">Tire um print e envie para o seu teacher para mostrar que voc√™ arrasou!</p>
                        <button class="action-button px-8" onclick="showDashboard()">Voltar ao Menu</button>
                        <button class="secondary-button mt-4" onclick="currentStreak=0; currentIdx=0; currentShuffledData=shuffle([...currentShuffledData]); renderScramble()">Jogar Novamente</button>
                    </div>
                `;
                return;
            }

            const item = currentShuffledData[currentIdx % currentShuffledData.length];
            const totalSentences = currentShuffledData.length;
            const currentSentence = (currentIdx % totalSentences) + 1;
            scrambleResult = [];
            const shuffled = shuffle([...item.words]);
            area.innerHTML = `
                <div class="text-center mb-4">
                    <span class="inline-block bg-primary/10 text-primary px-4 py-2 rounded-full font-bold text-sm">
                        Frase ${currentSentence} / ${totalSentences}
                    </span>
                </div>
                <div id="scramble-fb" class="hidden p-4 rounded-xl mb-6 text-center font-bold"></div>
                <div class="scramble-dropzone mb-6 flex flex-wrap justify-center gap-2 min-h-[60px]" id="scramble-res"><span class="text-stone-400">Clique nas palavras para formar a frase...</span></div>
                <div class="flex flex-wrap justify-center gap-3 mb-6" id="scramble-words">
                    ${shuffled.map((w, i) => `<button class="scramble-word" data-idx="${i}" onclick="pickWord(this, '${w.replace(/'/g, "&#39;")}', '${item.full.replace(/'/g, "&#39;")}')">${w}</button>`).join('')}
                </div>
                <button class="action-button w-full hidden" id="scramble-next" onclick="window.nextRound(renderScramble)">Pr√≥xima Frase</button>
            `;
        }

        window.pickWord = function(btn, w, full) {
            speakText(w);
            const idx = btn.getAttribute('data-idx');
            scrambleResult.push({ word: w, idx: idx });
            btn.style.visibility = 'hidden';
            updateScrambleResult(full);
        };

        window.unpickWord = function(idx, full) {
            scrambleResult = scrambleResult.filter(item => item.idx !== idx);
            const btn = document.querySelector(`#scramble-words button[data-idx="${idx}"]`);
            if (btn) btn.style.visibility = 'visible';
            updateScrambleResult(full);
        };

        function updateScrambleResult(full) {
            const resArea = document.getElementById('scramble-res');
            if (scrambleResult.length === 0) {
                resArea.innerHTML = '<span class="text-stone-400">Clique nas palavras para formar a frase...</span>';
                return;
            }
            resArea.innerHTML = scrambleResult.map(item => 
                `<button class="scramble-word-selected" onclick="unpickWord('${item.idx}', '${full.replace(/'/g, "&#39;")}')">${item.word}</button>`
            ).join('');
            
            if (scrambleResult.length === full.split(' ').length) {
                const fb = document.getElementById('scramble-fb');
                const resultText = scrambleResult.map(i => i.word).join(' ');
                if (resultText.toLowerCase() === full.toLowerCase()) { 
                    currentStreak++; 
                    renderStreakBar(); 
                    fb.innerHTML = `<span class="text-sm">Perfect! Frase correta.</span>`;
                    fb.className = "p-4 rounded-xl bg-green-100 text-green-800 block mb-4";
                    document.getElementById('scramble-next').classList.remove('hidden');
                    resArea.querySelectorAll('button').forEach(b => b.onclick = null);
                } else { 
                    currentStreak = 0; 
                    renderStreakBar(); 
                    fb.innerHTML = `Errou! Tente de novo. <button class="text-xs opacity-70 underline ml-2" onclick="renderScramble()">reset</button>`;
                    fb.className = "p-4 rounded-xl bg-red-100 text-red-800 block mb-4";
                }
            }
        };

        function renderDictation() {
            const area = document.getElementById('study-content-area');
            renderStreakBar();

            if (currentStreak >= STREAK_GOAL) {
                 area.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-10">
                        <div class="text-6xl mb-4">üèÜ</div>
                        <h2 class="text-3xl font-bold text-stone-800 mb-2">Excelente!</h2>
                        <p class="text-stone-500 mb-8">Voc√™ completou o streak de 5 ditados.</p>
                        <button class="action-button px-8" onclick="showDashboard()">Voltar</button>
                        <button class="secondary-button mt-4" onclick="currentStreak=0; currentIdx=0; currentShuffledData=shuffle([...currentShuffledData]); renderDictation()">Reiniciar</button>
                    </div>
                `;
                return;
            }

            const item = currentShuffledData[currentIdx % currentShuffledData.length];
            const totalItems = currentShuffledData.length;
            const currentItem = (currentIdx % totalItems) + 1;
            area.innerHTML = `
                <div class="flex flex-col items-center gap-4">
                    <div class="text-center">
                        <span class="inline-block bg-primary/10 text-primary px-4 py-2 rounded-full font-bold text-sm">
                            Palavra ${currentItem} / ${totalItems}
                        </span>
                    </div>
                    <p class="text-stone-500 text-sm mb-2">Clique no bot√£o para ouvir e digite o que voc√™ ouviu</p>
                    <button id="dict-play" class="w-24 h-24 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-full flex items-center justify-center hover:from-indigo-200 hover:to-purple-200 transition-all shadow-lg transform hover:scale-105" onclick="playDictation('${item}')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#8671d1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path><path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path></svg>
                    </button>
                    <input type="text" id="dict-input" class="dictation-input" placeholder="Digite aqui..." autocomplete="off" onkeypress="if(event.key==='Enter')checkDictation('${item}')">
                    <button class="action-button max-w-xs" onclick="checkDictation('${item}')">Verificar</button>
                    <div id="dict-fb" class="hidden p-4 rounded-xl font-bold text-lg"></div>
                    <button class="secondary-button hidden" id="dict-next" onclick="window.nextRound(renderDictation)">Pr√≥xima Palavra</button>
                </div>
            `;
        }

        window.playDictation = async function(text) {
             const btn = document.getElementById('dict-play');
             btn.classList.add('animate-pulse');
             
             if (isSpellingMode) {
                 // Soletrar a palavra letra por letra
                 const letters = text.split('');
                 for (let i = 0; i < letters.length; i++) {
                     await speakText(letters[i].toLowerCase());
                     if (i < letters.length - 1) {
                         await new Promise(resolve => setTimeout(resolve, 400));
                     }
                 }
                 btn.classList.remove('animate-pulse');
             } else {
                 const audio = await fetchTTSAudio(text);
                 if (audio) { 
                     await audio.play(); 
                     btn.classList.remove('animate-pulse'); 
                 } else {
                     btn.classList.remove('animate-pulse'); 
                 }
             }
        }

        // Number mappings for dictation (extenso <-> numeral)
        const numberMap = {
            'one': '1', 'two': '2', 'three': '3', 'four': '4', 'five': '5',
            'six': '6', 'seven': '7', 'eight': '8', 'nine': '9', 'ten': '10',
            'eleven': '11', 'twelve': '12', 'thirteen': '13', 'fourteen': '14', 'fifteen': '15',
            'sixteen': '16', 'seventeen': '17', 'eighteen': '18', 'nineteen': '19', 'twenty': '20',
            'first': '1st', 'second': '2nd', 'third': '3rd', 'fourth': '4th', 'fifth': '5th',
            'sixth': '6th', 'seventh': '7th', 'eighth': '8th', 'ninth': '9th', 'tenth': '10th'
        };
        const reverseNumberMap = Object.fromEntries(Object.entries(numberMap).map(([k, v]) => [v, k]));

        function normalizeAnswer(val, correct) {
            val = val.toLowerCase().trim();
            correct = correct.toLowerCase().trim();
            if (val === correct) return true;
            // Check if user typed number instead of word
            if (numberMap[correct] && val === numberMap[correct]) return true;
            // Check if user typed word instead of number
            if (reverseNumberMap[correct] && val === reverseNumberMap[correct]) return true;
            // For letters (A, B, C...) accept lowercase
            if (correct.length === 1 && val === correct) return true;
            return false;
        }

        window.checkDictation = function(correct) {
            const input = document.getElementById('dict-input');
            const verifyBtn = document.querySelector('#study-content-area .action-button');
            
            // Prevent multiple clicks
            if (verifyBtn.disabled) return;
            verifyBtn.disabled = true;
            verifyBtn.classList.add('opacity-50', 'cursor-not-allowed');
            input.disabled = true;
            
            const val = input.value.toLowerCase().trim();
            const fb = document.getElementById('dict-fb');

            if (normalizeAnswer(val, correct)) {
                input.classList.add('correct');
                fb.textContent = "Correto!";
                fb.className = "p-3 rounded-lg font-bold text-lg mt-2 bg-green-100 text-green-700 block";
                document.getElementById('dict-next').classList.remove('hidden');
                currentStreak++;
            } else {
                input.classList.add('wrong');
                fb.innerHTML = `Incorreto! Tente outra. <button class="text-xs opacity-70 underline ml-2" onclick="currentIdx++; renderDictation()">pr√≥xima</button>`;
                fb.className = "p-3 rounded-lg font-bold text-lg mt-2 bg-red-100 text-red-700 block";
                currentStreak = 0; 
                // Don't show next button - streak must restart
            }
            renderStreakBar();
        }

        window.nextRound = function(cb) {
            currentIdx = (currentIdx + 1) % currentShuffledData.length;
            cb();
        };

        function shuffle(a) { for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; } return a; }
        function scrollToModule(id) { document.getElementById(`module-${id}`).scrollIntoView({ behavior: 'smooth', block: 'center' }); }
        window.scrollToModule = scrollToModule;

        window.onload = function() { 
            // Bypass login for now as requested
            document.getElementById('main-wrapper').classList.remove('hidden'); 
            renderDashboard(); 
        };
    </script>
</body>
</html>
