<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SLAP | Central de Estudos - Starter 1</title>
    <link rel="icon" type="image/png" href="https://res.cloudinary.com/dqfi22uz0/image/upload/v1749543469/SLAP_FAVICON_AMARELO_coilvj.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #8671d1; --secondary: #F1D24B; }
        body { font-family: 'DM Sans', sans-serif; background-color: #f4f7f9; min-height: 100vh; margin: 0; scroll-behavior: smooth; }
        #main-wrapper { max-width: 1200px; margin: 0 auto; padding: 1rem 1.5rem; position: relative; }
        .bg-primary\/10 { background-color: rgba(134, 113, 209, 0.1); }
        .text-primary { color: #8671d1; }

        /* UI BUTTONS */
        .action-button { background-color: #F1D24B; color: #44403c; padding: 0.75rem 1rem; border-radius: 0.75rem; font-weight: 700; cursor: pointer; width: 100%; transition: all 0.2s; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .action-button:hover:not(:disabled) { background-color: #eab308; transform: translateY(-2px); }
        .action-button:disabled { background-color: #e5e7eb; color: #9ca3af; cursor: not-allowed; box-shadow: none; }

        .secondary-button { background-color: #44403c; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; }
        .secondary-button:hover { background-color: #292524; transform: translateY(-1px); }

        /* CARDS */
        .level-card { background-color: white; padding: 1.75rem; border-radius: 1.25rem; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border: 2px solid transparent; transition: all 0.2s; display: flex; flex-direction: column; justify-content: space-between; height: 100%; position: relative; min-height: 180px; }
        .level-card:not(.locked):hover { transform: scale(1.02); border-color: #8671d1; }
        .level-card.locked { opacity: 0.6; background-color: #f9fafb; pointer-events: none; }
        
        /* STUDY VIEW CONTAINER */
        .study-container { background: white; border-radius: 1.5rem; padding: 2rem; box-shadow: 0 10px 40px rgba(0,0,0,0.08); margin-bottom: 2rem; }

        .module-tag { display: inline-block; padding: 0.25rem 0.5rem; background-color: #8671d1; color: white; font-size: 0.75rem; font-weight: 700; border-radius: 0.5rem; margin-bottom: 0.5rem; }
        .lock-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(68,64,60,0.9); padding: 1rem; border-radius: 50%; z-index: 10; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

        /* LISTENING */
        .listening-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .number-btn { background: white; border: 2px solid #e2e8f0; border-radius: 1rem; padding: 1rem; text-align: center; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80px; }
        .number-btn:hover { border-color: #8671d1; transform: translateY(-2px); }
        .number-btn span.main-text { font-size: 1.5rem; font-weight: 800; }
        .number-btn span.sub-text { font-size: 0.7rem; font-weight: 600; color: #8671d1; text-transform: uppercase; }
        .number-btn.playing { border-color: #F1D24B; background-color: #fffbeb; animation: pulse 1s infinite; }

        /* FLASHCARDS */
        .flashcard-container { perspective: 1000px; width: 100%; max-width: 400px; height: 300px; margin: 1rem auto; cursor: pointer; }
        .flashcard { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
        .flashcard.flipped { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back { position: absolute; top: 0; left: 0; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 1.5rem; padding: 1rem; box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .flashcard-front { background-color: #8671d1; color: white; }
        .flashcard-back { background-color: #F1D24B; color: #44403c; transform: rotateY(180deg); }

        /* CHUNKS */
        .chunks-grid { display: grid; grid-template-columns: 1fr 1fr; border: 2px solid #e2e8f0; border-radius: 1rem; overflow: hidden; background: white; text-align: left; }
        .chunks-header { background: #44403c; color: white; padding: 1rem; font-weight: 700; text-transform: uppercase; font-size: 0.8rem; }
        .chunks-cell { padding: 1rem; border-bottom: 1px solid #e2e8f0; display: flex; align-items: center; font-weight: 500; }
        .chunks-cell-en { color: #1e1b4b; background-color: #f8fafc; }
        .chunks-cell-pt { color: #64748b; justify-content: space-between; }
        .translation-hidden { filter: blur(5px); opacity: 0.3; transition: 0.3s; user-select: none; } 
        .translation-visible { filter: blur(0); opacity: 1; user-select: text; }

        /* SCRAMBLE */
        .scramble-dropzone {
            min-height: 80px; 
            border: 2px dashed #cbd5e1; 
            border-radius: 1rem; 
            padding: 1.5rem; 
            display: flex; 
            flex-wrap: wrap; 
            align-items: center; 
            justify-content: center; 
            gap: 0.75rem; 
            background-color: #f8fafc; 
            margin-bottom: 2rem; 
            font-size: 1.25rem; 
            font-weight: 700; 
            color: #8671d1;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }
        .scramble-word {
            background: white; 
            border: 2px solid #e2e8f0; 
            padding: 0.75rem 1.25rem; 
            border-radius: 0.75rem; 
            cursor: pointer; 
            font-weight: 600; 
            color: #44403c; 
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .scramble-word:hover { border-color: #8671d1; transform: translateY(-2px); box-shadow: 0 4px 6px rgba(0,0,0,0.1); }

        /* MISTAKE */
        .mistake-word { display: inline-block; padding: 0.2rem 0.4rem; border-radius: 0.4rem; cursor: pointer; transition: all 0.2s; border-bottom: 2px solid transparent; }
        .mistake-word:hover { background-color: #fee2e2; border-bottom-color: #ef4444; }
        .mistake-word.correct-choice { background: #dcfce7; border-color: #22c55e; }
        .mistake-word.wrong-choice { background: #fee2e2; border-color: #ef4444; text-decoration: line-through; }

        /* DICTATION */
        .dictation-input { font-size: 2rem; text-align: center; border: 3px solid #e2e8f0; border-radius: 1rem; width: 220px; padding: 0.5rem; outline: none; transition: 0.2s; }
        .dictation-input:focus { border-color: #8671d1; }
        .dictation-input.correct { border-color: #22c55e; background: #dcfce7; }
        .dictation-input.wrong { border-color: #ef4444; background: #fee2e2; }

        /* GENERAL UI */
        #hm-shortcuts-container { display: flex; flex-wrap: wrap; gap: 0.4rem; justify-content: center; margin-bottom: 2rem; max-width: 850px; margin-left: auto; margin-right: auto; padding: 0 1rem; }
        .hm-box { width: 54px; height: 34px; display: flex; align-items: center; justify-content: center; border-radius: 0.4rem; font-size: 0.65rem; font-weight: 800; transition: all 0.2s; cursor: pointer; border: 1px solid #e2e8f0; background: white; }
        .hm-box-active { color: #8671d1; border-color: #8671d1; }
        .hm-box-active:hover { background: #f3f0ff; transform: translateY(-2px); }
        .hm-box-locked { background: #f1f5f9; color: #cbd5e1; cursor: not-allowed; border-color: #e2e8f0; }

        .streak-container { display: flex; justify-content: center; gap: 5px; margin-bottom: 1rem; }
        .streak-dot { width: 12px; height: 12px; border-radius: 50%; background: #e2e8f0; transition: all 0.3s ease; }
        .streak-dot.active { background: #F1D24B; transform: scale(1.2); }

        /* QUIZ UI */
        .option-button { background-color: white; border: 2px solid #e2e8f0; color: #44403c; text-align: left; padding: 1rem; border-radius: 0.75rem; width: 100%; transition: all 0.2s; cursor: pointer; display: flex; align-items: center; gap: 1rem; }
        .option-button:hover:not(:disabled) { border-color: #8671d1; background-color: #f8fafc; }
        .option-prefix { width: 2.2rem; height: 2.2rem; background: #f3f0ff; color: #8671d1; font-weight: 800; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; border: 1px solid #e0d7f7; }

        .help-btn { position: absolute; top: 1rem; right: 1.5rem; width: 2.5rem; height: 2.5rem; border-radius: 50%; background: white; border: 2px solid #e2e8f0; color: #8671d1; font-weight: 700; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 50; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 10000; opacity: 0; pointer-events: none; transition: 0.3s; }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-content { background: white; border-radius: 1.5rem; padding: 1.8rem; max-width: 400px; width: 90%; transform: scale(0.9); transition: 0.3s; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); }
        .modal-overlay.active .modal-content { transform: scale(1); }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <!-- MAIN APP CONTENT -->
    <div id="main-wrapper">
        <header class="py-8 border-b border-stone-200 mb-10 text-center relative">
            <button class="help-btn" onclick="document.getElementById('rules-modal').classList.add('active')">?</button>

            <img src="https://res.cloudinary.com/dqfi22uz0/image/upload/v1759294967/SLAP_TIPO_PRETO_2_kismg9.png" alt="SLAP Logo" class="w-32 h-auto mx-auto mb-6">
            <h1 class="text-3xl font-bold text-stone-800 tracking-tight mb-3">Central de Estudos - Starter 1</h1>
            <p class="text-stone-500 font-medium px-4 leading-relaxed max-w-2xl mx-auto">Material did√°tico exclusivo focado em refor√ßar a acur√°cia estrutural e a confian√ßa na comunica√ß√£o.</p>

            <div class="mt-6 flex justify-center">
                <a href="#" target="_blank" class="inline-flex items-center gap-2 px-5 py-2.5 bg-white border border-stone-200 rounded-full text-xs font-black text-stone-500 hover:text-[#8671d1] hover:border-[#8671d1] shadow-sm transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                    BAIXAR CONTE√öDO PROGRAM√ÅTICO
                </a>
            </div>
        </header>

        <div id="dashboard-view" class="w-full">
            <div id="hm-shortcuts-container"></div>
            <div id="level-cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-20"></div>
        </div>

        <div id="generator-view" class="hidden w-full">
            <button class="secondary-button mb-4" onclick="showDashboard()">Voltar</button>
            <div class="bg-white p-6 rounded-2xl shadow-xl max-w-2xl mx-auto">
                <h2 class="text-xl font-bold text-stone-800 mb-4 text-center" id="current-hw-display"></h2>
                <div id="quiz-streak-bar" class="streak-container"></div>
                <div id="feedback-alert" class="hidden p-3 mb-6 rounded-lg text-white font-semibold text-center"></div>
                <div class="challenge-box mb-6 border-l-4 border-indigo-400 p-6 bg-slate-50">
                    <p id="main-question" class="text-lg font-bold text-slate-800"></p>
                </div>
                <div id="options-container" class="space-y-3"></div>
                <div id="rationale-display" class="hidden mt-6">
                    <div id="rationale-content" class="p-4 bg-green-50 text-green-900 rounded-lg mb-4 text-sm border-l-4 border-green-400"></div>
                    <button class="action-button w-full" onclick="loadNextQuestion()">Pr√≥ximo Exerc√≠cio</button>
                </div>
            </div>
        </div>

        <div id="study-view" class="hidden w-full">
             <button class="secondary-button mb-6 flex items-center gap-2" onclick="showDashboard()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m15 18-6-6 6-6"/></svg>
                Voltar ao Menu
             </button>
            <div class="study-container max-w-4xl mx-auto text-center">
                 <h2 class="text-2xl font-bold text-stone-800 mb-2" id="study-title"></h2>
                 <p class="text-stone-500 mb-4 italic text-sm" id="study-instruction"></p>
                 <div id="streak-bar-container" class="hidden mb-6"></div>
                 <div id="preloading-status" class="text-xs text-primary font-bold mb-4 h-4"></div>
                 <div id="study-content-area" class="py-4"></div>
            </div>
        </div>
    </div>

    <!-- RULES POPUP -->
    <div id="rules-modal" class="modal-overlay" onclick="if(event.target === this) this.classList.remove('active')">
        <div class="modal-content">
            <h3 class="text-xl font-black text-stone-800 mb-5 text-center">Manual de Regras</h3>
            <div class="space-y-5 text-left text-stone-600 text-sm leading-relaxed">
                <div class="flex gap-3"><div class="w-6 h-6 rounded-full bg-[#8671d1] text-white flex items-center justify-center shrink-0 font-bold">1</div><p><strong>Acesso Individual:</strong> N√£o compartilhe sua senha. Monitoramos acessos por IP.</p></div>
                <div class="flex gap-3"><div class="w-6 h-6 rounded-full bg-[#8671d1] text-white flex items-center justify-center shrink-0 font-bold">2</div><p><strong>Frequ√™ncia:</strong> A evolu√ß√£o vem da pr√°tica constante. Tente completar um m√≥dulo de Homework ap√≥s cada aula.</p></div>
                <div class="flex gap-3"><div class="w-6 h-6 rounded-full bg-[#8671d1] text-white flex items-center justify-center shrink-0 font-bold">3</div><p><strong>Prints:</strong> Ao completar um Streak de 5, tire um print e envie para seu teacher.</p></div>
                <div class="flex gap-3"><div class="w-6 h-6 rounded-full bg-[#8671d1] text-white flex items-center justify-center shrink-0 font-bold">4</div><p><strong>Listening:</strong> Use fones de ouvido para captar os detalhes.</p></div>
            </div>
            <button class="action-button w-full mt-8" onclick="document.getElementById('rules-modal').classList.remove('active')">Entendi, vamos l√°!</button>
        </div>
    </div>

    <script>
        const audioCache = new Map();

        let currentStreak = 0;
        let quizStreak = 0;
        const STREAK_GOAL = 5;
        let currentAulaId = 0; 

        // --- APP DATA ---
        const aulaNames = [
            { id: 1, name: "Open House", hasHomework: false },
            { id: 2, name: "Feelings", hasHomework: true, specialMode: 'flashcards' },
            { id: 3, name: "Names & Greetings", hasHomework: true, specialMode: 'chunks' },
            { id: 4, name: "Numbers pt. 1", hasHomework: true, specialMode: 'listening', thirdBtn: 'dictation', items: [
                {n: "1", w: "One"}, {n: "2", w: "Two"}, {n: "3", w: "Three"}, {n: "4", w: "Four"}, {n: "5", w: "Five"},
                {n: "6", w: "Six"}, {n: "7", w: "Seven"}, {n: "8", w: "Eight"}, {n: "9", w: "Nine"}, {n: "10", w: "Ten"},
                {n: "11", w: "Eleven"}, {n: "12", w: "Twelve"}, {n: "13", w: "Thirteen"}, {n: "14", w: "Fourteen"}, {n: "15", w: "Fifteen"},
                {n: "16", w: "Sixteen"}, {n: "17", w: "Seventeen"}, {n: "18", w: "Eighteen"}, {n: "19", w: "Nineteen"}, {n: "20", w: "Twenty"},
                {n: "22", w: "Twenty-two"}, {n: "30", w: "Thirty"}, {n: "35", w: "Thirty-five"}, {n: "40", w: "Forty"}, {n: "48", w: "Forty-eight"},
                {n: "50", w: "Fifty"}, {n: "51", w: "Fifty-one"}, {n: "60", w: "Sixty"}, {n: "64", w: "Sixty-four"}, {n: "70", w: "Seventy"},
                {n: "77", w: "Seventy-seven"}, {n: "80", w: "Eighty"}, {n: "86", w: "Eighty-six"}, {n: "90", w: "Ninety"}, {n: "99", w: "Ninety-nine"}
            ]},
            { id: 5, name: "Numbers pt. 2", hasHomework: true, specialMode: 'listening', thirdBtn: 'dictation', items: [
                {n: "100", w: "One hundred"}, {n: "150", w: "One hundred and fifty"}, {n: "200", w: "Two hundred"}, {n: "300", w: "Three hundred"}, {n: "325", w: "Three hundred and twenty-five"}, {n: "400", w: "Four hundred"}, {n: "500", w: "Five hundred"}, {n: "505", w: "Five hundred and five"}, {n: "600", w: "Six hundred"}, {n: "700", w: "Seven hundred"}, {n: "800", w: "Eight hundred"}, {n: "900", w: "Nine hundred"}, {n: "1,000", w: "One thousand"}, {n: "1,200", w: "One thousand two hundred"}, {n: "2,000", w: "Two thousand"}, {n: "4,000", w: "Four thousand"}, {n: "5,500", w: "Five thousand five hundred"}, {n: "10,000", w: "Ten thousand"}, {n: "10,500", w: "Ten thousand five hundred"}, {n: "20,000", w: "Twenty thousand"}, {n: "30,000", w: "Thirty thousand"}, {n: "40,000", w: "Forty thousand"}, {n: "45,300", w: "Forty-five thousand three hundred"}, {n: "50,000", w: "Fifty thousand"}, {n: "60,000", w: "Sixty thousand"}, {n: "70,000", w: "Seventy thousand"}, {n: "80,000", w: "Eighty thousand"}, {n: "90,000", w: "Ninety thousand"}
            ]},
            { id: 6, name: "Spelling", hasHomework: true, specialMode: 'listening', thirdBtn: 'dictation', items: ["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"].map(l => ({n: l, w: l, p: `/${l.toLowerCase()}/`})) },
            { id: 7, name: "Ordinal Numbers", hasHomework: true, specialMode: 'listening', thirdBtn: 'dictation', items: [{n:"1st",w:"First"},{n:"2nd",w:"Second"},{n:"3rd",w:"Third"},{n:"4th",w:"Fourth"},{n:"5th",w:"Fifth"},{n:"6th",w:"Sixth"},{n:"7th",w:"Seventh"},{n:"8th",w:"Eighth"},{n:"9th",w:"Ninth"},{n:"10th",w:"Tenth"},{n:"11th",w:"Eleventh"},{n:"12th",w:"Twelfth"},{n:"13th",w:"Thirteenth"},{n:"14th",w:"Fourteenth"},{n:"15th",w:"Fifteenth"},{n:"20th",w:"Twentieth"},{n:"21st",w:"Twenty-first"},{n:"22nd",w:"Twenty-second"},{n:"30th",w:"Thirtieth"},{n:"31st",w:"Thirty-first"},{n:"40th",w:"Fortieth"},{n:"45th",w:"Forty-fifth"},{n:"50th",w:"Fiftieth"},{n:"58th",w:"Fifty-eighth"},{n:"60th",w:"Sixtieth"},{n:"63rd",w:"Sixty-third"},{n:"70th",w:"Seventieth"},{n:"77th",w:"Seventy-seventh"},{n:"80th",w:"Eightieth"},{n:"89th",w:"Eighty-ninth"},{n:"90th",w:"Ninetieth"}] },
            { id: 8, name: "Basic Verbs", hasHomework: true, thirdBtn: 'dictation' },
            { id: 9, name: "Basic Adjectives", hasHomework: true, thirdBtn: 'dictation' },
            { id: 10, name: "Demonstrative Pronouns", hasHomework: true, specialMode: 'scramble' },
            { id: 11, name: "Verb to be", hasHomework: true },
            { id: 12, name: "Countries and Nationalities", hasHomework: true, specialMode: 'flashcards' },
            { id: 13, name: "Neighborhood", hasHomework: true },
            { id: 14, name: "Family Members", hasHomework: true },
            { id: 15, name: "Midterm Test", hasHomework: false },
            { id: 16, name: "Can e Can't", hasHomework: true, specialMode: 'scramble' },
            { id: 17, name: "Midterm Test Correction", hasHomework: false },
            { id: 18, name: "Simple Present pt. 1", hasHomework: true, specialMode: 'scramble' },
            { id: 19, name: "Simple Present pt. 2", hasHomework: true },
            { id: 20, name: "Object Pronouns", hasHomework: true, specialMode: 'scramble' },
            { id: 21, name: "Likes and Dislikes", hasHomework: true },
            { id: 22, name: "Free Time Activities", hasHomework: true },
            { id: 23, name: "Months and Holidays", hasHomework: true, specialMode: 'listening', thirdBtn: 'flashcards', items: [{n:"Jan",w:"January"},{n:"Feb",w:"February"},{n:"Mar",w:"March"},{n:"Apr",w:"April"},{n:"May",w:"May"},{n:"Jun",w:"June"},{n:"Jul",w:"July"},{n:"Aug",w:"August"},{n:"Sep",w:"September"},{n:"Oct",w:"October"},{n:"Nov",w:"November"},{n:"Dec",w:"December"}] },
            { id: 24, name: "Possessive Adjectives", hasHomework: true, specialMode: 'scramble' },
            { id: 25, name: "Possessive Pronouns", hasHomework: true, specialMode: 'scramble' },
            { id: 26, name: "Foods and Fruits", hasHomework: true, specialMode: 'flashcards' },
            { id: 27, name: "Presentation", hasHomework: false },
            { id: 28, name: "Hours", hasHomework: true, specialMode: 'flashcards', thirdBtn: 'dictation' },
            { id: 29, name: "Kahoot Review", hasHomework: false },
            { id: 30, name: "Listening Test", hasHomework: false },
            { id: 31, name: "Grammar Test", hasHomework: false },
            { id: 32, name: "GT e LT Review", hasHomework: false },
            { id: 33, name: "OT Review", hasHomework: false },
            { id: 34, name: "Oral Test Day 1", hasHomework: false },
            { id: 35, name: "Oral Test Day 2", hasHomework: false },
            { id: 36, name: "General Feedback", hasHomework: false }
        ];

        const flashcardsData = {
            2: [
                { front: "Feliz", back: "Happy" }, { front: "Triste", back: "Sad" }, { front: "Bravo(a)", back: "Angry" },
                { front: "Cansado(a)", back: "Tired" }, { front: "Animado(a)", back: "Excited" }, { front: "Nervoso(a)", back: "Nervous" },
                { front: "Assustado(a)", back: "Scared" }, { front: "Entediado(a)", back: "Bored" }, { front: "Confuso(a)", back: "Confused" },
                { front: "Orgulhoso(a)", back: "Proud" }
            ],
            12: [
                { front: "üáßüá∑", back: "Brazil / Brazilian" }, { front: "üá∫üá∏", back: "USA / American" },
                { front: "üá¨üáß", back: "England / British" }, { front: "üá´üá∑", back: "France / French" },
                { front: "üá™üá∏", back: "Spain / Spanish" }, { front: "üáÆüáπ", back: "Italy / Italian" },
                { front: "üáØüáµ", back: "Japan / Japanese" }, { front: "üá®üá≥", back: "China / Chinese" },
                { front: "üá©üá™", back: "Germany / German" }, { front: "üáµüáπ", back: "Portugal / Portuguese" }
            ],
            23: [
                { front: "Natal", back: "Christmas" }, { front: "Ano Novo", back: "New Year's Day" }, 
                { front: "P√°scoa", back: "Easter" }, { front: "Dia das M√£es", back: "Mother's Day" }, 
                { front: "Dia dos Pais", back: "Father's Day" }, { front: "Dia das Crian√ßas", back: "Children's Day" },
                { front: "Carnaval", back: "Carnival" }, { front: "Dia de A√ß√£o de Gra√ßas", back: "Thanksgiving" },
                { front: "Dia dos Namorados", back: "Valentine's Day" }, { front: "Halloween", back: "Halloween" }
            ],
            26: [
                { front: "üçé", back: "Apple" }, { front: "üçå", back: "Banana" }, { front: "üçï", back: "Pizza" }, 
                { front: "ü•¶", back: "Broccoli" }, { front: "ü•ï", back: "Carrot" }, { front: "ü•©", back: "Steak" }, 
                { front: "üçö", back: "Rice" }, { front: "üç¶", back: "Ice cream" }, { front: "üçû", back: "Bread" },
                { front: "üßÄ", back: "Cheese" }
            ],
            28: [
                { front: "08:00", back: "Eight o'clock" }, { front: "08:30", back: "Half past eight" },
                { front: "09:15", back: "Nine fifteen / Quarter past nine" }, { front: "10:45", back: "Ten forty-five / Quarter to eleven" },
                { front: "12:00", back: "Twelve o'clock / Noon" }, { front: "00:00", back: "Midnight" },
                { front: "03:30", back: "Three thirty / Half past three" }, { front: "06:45", back: "Six forty-five / Quarter to seven" },
                { front: "11:15", back: "Eleven fifteen" }, { front: "07:00", back: "Seven o'clock" }
            ]
        };

        const chunksData = {
            // Asking About Names (module 3)
            3: [
                { en: "What's your name?", pt: "Qual √© o seu nome?" }, 
                { en: "What's your first name?", pt: "Qual √© o seu primeiro nome?" }, 
                { en: "What's your middle name?", pt: "Qual √© o seu nome do meio?" }, 
                { en: "What's your nickname?", pt: "Qual √© o seu apelido?" }, 
                { en: "What's your last name?", pt: "Qual √© o seu sobrenome?" },
                { en: "My name is...", pt: "Meu nome √©..." },
                { en: "Nice to meet you!", pt: "Prazer em conhec√™-lo!" },
                { en: "Where are you from?", pt: "De onde voc√™ √©?" },
                { en: "How old are you?", pt: "Quantos anos voc√™ tem?" },
                { en: "I'm from Brazil.", pt: "Eu sou do Brasil." }
            ]
        };

        const gamesData = {
            // Demonstrative Pronouns (module 10)
            10: [
                { full: "this is my car", words: ["this", "is", "my", "car"] },
                { full: "that is your house", words: ["that", "is", "your", "house"] },
                { full: "these are my books", words: ["these", "are", "my", "books"] },
                { full: "those are her shoes", words: ["those", "are", "her", "shoes"] },
                { full: "this is a good idea", words: ["this", "is", "a", "good", "idea"] }
            ],
            // Can e Can't (module 16)
            16: [
                { full: "I can dance", words: ["I", "can", "dance"] },
                { full: "she can speak English", words: ["she", "can", "speak", "English"] },
                { full: "they can't swim", words: ["they", "can't", "swim"] },
                { full: "we can play soccer", words: ["we", "can", "play", "soccer"] },
                { full: "he can't drive a car", words: ["he", "can't", "drive", "a", "car"] }
            ],
            // Simple Present pt. 1 (module 18)
            18: [
                { full: "I drink water every day", words: ["I", "drink", "water", "every", "day"] },
                { full: "she works at a hospital", words: ["she", "works", "at", "a", "hospital"] },
                { full: "they study English", words: ["they", "study", "English"] },
                { full: "he plays soccer on weekends", words: ["he", "plays", "soccer", "on", "weekends"] },
                { full: "we eat breakfast together", words: ["we", "eat", "breakfast", "together"] }
            ],
            // Object Pronouns (module 20)
            20: [
                { full: "help me please", words: ["help", "me", "please"] },
                { full: "I love you", words: ["I", "love", "you"] },
                { full: "call him now", words: ["call", "him", "now"] },
                { full: "give her the book", words: ["give", "her", "the", "book"] },
                { full: "tell us the story", words: ["tell", "us", "the", "story"] }
            ],
            // Possessive Adjectives (module 24)
            24: [
                { full: "my book is new", words: ["my", "book", "is", "new"] },
                { full: "your car is fast", words: ["your", "car", "is", "fast"] },
                { full: "her dress is beautiful", words: ["her", "dress", "is", "beautiful"] },
                { full: "his name is John", words: ["his", "name", "is", "John"] },
                { full: "our house is big", words: ["our", "house", "is", "big"] }
            ],
            // Possessive Pronouns (module 25)
            25: [
                { full: "this pen is mine", words: ["this", "pen", "is", "mine"] },
                { full: "that book is yours", words: ["that", "book", "is", "yours"] },
                { full: "the car is hers", words: ["the", "car", "is", "hers"] },
                { full: "this phone is his", words: ["this", "phone", "is", "his"] },
                { full: "the house is ours", words: ["the", "house", "is", "ours"] }
            ],
            // Dictation data
            4: { dictation: ["one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten"] },
            5: { dictation: ["eleven", "twelve", "thirteen", "fourteen", "fifteen", "sixteen", "seventeen", "eighteen", "nineteen", "twenty"] },
            6: { dictation: ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J"] },
            7: { dictation: ["first", "second", "third", "fourth", "fifth", "sixth", "seventh", "eighth", "ninth", "tenth"] },
            8: { dictation: ["run", "walk", "eat", "drink", "sleep", "work", "play", "read", "write", "speak"] },
            9: { dictation: ["happy", "sad", "big", "small", "hot", "cold", "fast", "slow", "good", "bad"] },
            28: { dictation: ["08:00", "12:30", "03:15", "06:45", "09:00", "10:30", "02:00", "07:15", "11:45", "04:30"] }
        };

        // --- REAL HOMEWORK QUESTIONS (10 PER MODULE) ---
        const quizData = {
            2: [ // AULA 01: FEELINGS
                {q: "Complete the sentence: 'I am ____ because I didn‚Äôt sleep well.'", options: [{text:"tired", isCorrect:true}, {text:"happy", isCorrect:false}, {text:"angry", isCorrect:false}, {text:"excited", isCorrect:false}], rationale: "N√£o dormir bem causa cansa√ßo (tired)."},
                {q: "Which sentence is grammatically correct?", options: [{text:"I feel sad", isCorrect:true}, {text:"I am feel sad", isCorrect:false}, {text:"I feeling sad", isCorrect:false}, {text:"I am sad feel", isCorrect:false}], rationale: "'I feel sad' ou 'I am sad' s√£o as formas corretas."},
                {q: "Choose the best option: 'She is angry' means:", options: [{text:"Ela est√° brava", isCorrect:true}, {text:"Ela est√° cansada", isCorrect:false}, {text:"Ela est√° feliz", isCorrect:false}, {text:"Ela est√° animada", isCorrect:false}], rationale: "Angry significa brava/irritada."},
                {q: "You lost your wallet. How do you feel?", options: [{text:"Angry", isCorrect:true}, {text:"Happy", isCorrect:false}, {text:"Relaxed", isCorrect:false}, {text:"Excited", isCorrect:false}], rationale: "Perder a carteira geralmente causa raiva ou frustra√ß√£o."},
                {q: "What is the opposite of happy?", options: [{text:"Sad", isCorrect:true}, {text:"Angry", isCorrect:false}, {text:"Tired", isCorrect:false}, {text:"Scared", isCorrect:false}], rationale: "O oposto de feliz √© triste (sad)."},
                {q: "Complete: 'They ____ scared of flying.'", options: [{text:"are", isCorrect:true}, {text:"is", isCorrect:false}, {text:"am", isCorrect:false}, {text:"be", isCorrect:false}], rationale: "'They' (eles) exige o verbo 'are'."},
                {q: "Which option is NOT a feeling?", options: [{text:"Smile", isCorrect:true}, {text:"Nervous", isCorrect:false}, {text:"Tired", isCorrect:false}, {text:"Angry", isCorrect:false}], rationale: "Smile (sorriso) √© uma a√ß√£o/express√£o, n√£o um sentimento."},
                {q: "Choose the correct word order:", options: [{text:"I am angry now", isCorrect:true}, {text:"I am now angry", isCorrect:false}, {text:"I angry am now", isCorrect:false}, {text:"I now am angry", isCorrect:false}], rationale: "A ordem padr√£o √© Sujeito + Verbo + Adjetivo + Tempo."},
                {q: "Why is she smiling?", options: [{text:"Because she is happy", isCorrect:true}, {text:"Because she is tired", isCorrect:false}, {text:"Because she is angry", isCorrect:false}, {text:"Because she is scared", isCorrect:false}], rationale: "Sorr√≠mos quando estamos felizes."},
                {q: "Choose the correct meaning of scared:", options: [{text:"Assustado", isCorrect:true}, {text:"Cansado", isCorrect:false}, {text:"Feliz", isCorrect:false}, {text:"Nervoso", isCorrect:false}], rationale: "Scared significa assustado."}
            ],
            3: [ // AULA 02: NAMES & GREETINGS
                {q: "Choose the most appropriate greeting for a formal situation:", options: [{text:"Hello", isCorrect:true}, {text:"Hi!", isCorrect:false}, {text:"Hey!", isCorrect:false}, {text:"What‚Äôs up?", isCorrect:false}], rationale: "Hello √© o mais formal e neutro."},
                {q: "Complete the sentence: '____ name is Daniela.'", options: [{text:"My", isCorrect:true}, {text:"I", isCorrect:false}, {text:"Me", isCorrect:false}, {text:"Mine", isCorrect:false}], rationale: "My (meu) √© o adjetivo possessivo correto."},
                {q: "Which sentence is correct?", options: [{text:"My name is Daniela", isCorrect:true}, {text:"My name Daniela", isCorrect:false}, {text:"My is name Daniela", isCorrect:false}, {text:"Name is my Daniela", isCorrect:false}], rationale: "A estrutura √© My name + is + Nome."},
                {q: "You meet someone for the first time at work. What do you say?", options: [{text:"Hello, nice to meet you", isCorrect:true}, {text:"Bye", isCorrect:false}, {text:"See you later", isCorrect:false}, {text:"Good night", isCorrect:false}], rationale: "Cumprimento padr√£o para o primeiro encontro."},
                {q: "Choose the correct question:", options: [{text:"What is your name?", isCorrect:true}, {text:"What your name is?", isCorrect:false}, {text:"What is name you?", isCorrect:false}, {text:"Your name what is?", isCorrect:false}], rationale: "Ordem correta: Wh-word + is + sujeito?"},
                {q: "Complete the expression: 'Nice to ____ you.'", options: [{text:"meet", isCorrect:true}, {text:"see", isCorrect:false}, {text:"say", isCorrect:false}, {text:"talk", isCorrect:false}], rationale: "Nice to meet you = Prazer em conhec√™-lo."},
                {q: "‚ÄúHi, I‚Äôm Paulo‚Äù means:", options: [{text:"Oi, eu sou Paulo", isCorrect:true}, {text:"Oi, qual √© seu nome?", isCorrect:false}, {text:"Tchau, Paulo", isCorrect:false}, {text:"Prazer, Paulo", isCorrect:false}], rationale: "Tradu√ß√£o direta de apresenta√ß√£o."},
                {q: "Which greeting is more informal?", options: [{text:"Hi", isCorrect:true}, {text:"Good evening", isCorrect:false}, {text:"Hello", isCorrect:false}, {text:"Good afternoon", isCorrect:false}], rationale: "Hi √© informal."},
                {q: "Choose the best answer: ‚Äî What‚Äôs your name?", options: [{text:"My name is Laura", isCorrect:true}, {text:"Hi!", isCorrect:false}, {text:"Nice to meet you", isCorrect:false}, {text:"Goodbye", isCorrect:false}], rationale: "Resposta direta √† pergunta."},
                {q: "When do we usually say ‚ÄúGoodbye‚Äù?", options: [{text:"When we leave", isCorrect:true}, {text:"When we arrive", isCorrect:false}, {text:"When we introduce ourselves", isCorrect:false}, {text:"When we meet someone", isCorrect:false}], rationale: "Goodbye √© despedida."}
            ],
            4: [ // AULA 03: NUMBERS PT. 1
                {q: "Choose the correct number: 'Eight'", options: [{text:"8", isCorrect:true}, {text:"6", isCorrect:false}, {text:"7", isCorrect:false}, {text:"9", isCorrect:false}], rationale: "Eight = 8."},
                {q: "Complete: 'I have ____ cousins.'", options: [{text:"two", isCorrect:true}, {text:"second", isCorrect:false}, {text:"twice", isCorrect:false}, {text:"double", isCorrect:false}], rationale: "Usa-se n√∫mero cardinal para quantidade."},
                {q: "What comes after nine?", options: [{text:"Ten", isCorrect:true}, {text:"Eight", isCorrect:false}, {text:"Eleven", isCorrect:false}, {text:"Twelve", isCorrect:false}], rationale: "9, 10 (Ten)."},
                {q: "Choose the correct option: 'I am ____ years old.'", options: [{text:"twenty", isCorrect:true}, {text:"twentieth", isCorrect:false}, {text:"twenties", isCorrect:false}, {text:"twentys", isCorrect:false}], rationale: "Idade usa n√∫meros cardinais."},
                {q: "Which sentence is correct?", options: [{text:"I have three brothers", isCorrect:true}, {text:"I have three brother", isCorrect:false}, {text:"I have brother three", isCorrect:false}, {text:"I have brothers three", isCorrect:false}], rationale: "Plural no substantivo ap√≥s o n√∫mero."},
                {q: "Choose the correct word: '____ people are in the class.' (10)", options: [{text:"Ten", isCorrect:true}, {text:"Tenth", isCorrect:false}, {text:"Teen", isCorrect:false}, {text:"Tens", isCorrect:false}], rationale: "Quantidade 10 = Ten."},
                {q: "What number is this? 5 + 4", options: [{text:"Nine", isCorrect:true}, {text:"Eight", isCorrect:false}, {text:"Ten", isCorrect:false}, {text:"Eleven", isCorrect:false}], rationale: "5 mais 4 √© 9 (Nine)."},
                {q: "Choose the natural sentence in English:", options: [{text:"I am 30 years old", isCorrect:true}, {text:"I have 30 years", isCorrect:false}, {text:"I am 30 years", isCorrect:false}, {text:"I have 30 old", isCorrect:false}], rationale: "Em ingl√™s, 'somos' a idade (I am), n√£o 'temos'."},
                {q: "Choose the correct spelling:", options: [{text:"Four", isCorrect:true}, {text:"For", isCorrect:false}, {text:"Fore", isCorrect:false}, {text:"Fower", isCorrect:false}], rationale: "Quatro = Four."},
                {q: "Which sentence uses numbers correctly?", options: [{text:"I have two cars", isCorrect:true}, {text:"I have two car", isCorrect:false}, {text:"I have cars two", isCorrect:false}, {text:"I have two car‚Äôs", isCorrect:false}], rationale: "N√∫mero + Substantivo Plural."}
            ],
            5: [ // AULA 04: NUMBERS PT. 2
                {q: "How do we usually say a phone number?", options: [{text:"Digit by digit", isCorrect:true}, {text:"In big numbers", isCorrect:false}, {text:"As one long number", isCorrect:false}, {text:"Using ordinal numbers", isCorrect:false}], rationale: "Telefones s√£o ditos d√≠gito a d√≠gito."},
                {q: "Choose the correct way to say 358:", options: [{text:"Three hundred fifty-eight", isCorrect:true}, {text:"Three five eight", isCorrect:false}, {text:"Thirty five eight", isCorrect:false}, {text:"Three hundred and eight", isCorrect:false}], rationale: "Centenas + dezenas."},
                {q: "How do we usually say the year 2015?", options: [{text:"Twenty fifteen", isCorrect:true}, {text:"Two thousand and fifteen", isCorrect:false}, {text:"Two zero one five", isCorrect:false}, {text:"Two thousand five", isCorrect:false}], rationale: "Anos geralmente s√£o divididos em dois (20-15)."},
                {q: "Choose the most natural way to say $12.99:", options: [{text:"Twelve ninety-nine", isCorrect:true}, {text:"Twelve dollars ninety-nine", isCorrect:false}, {text:"Twelve dollars and ninety-nine cents", isCorrect:false}, {text:"Ninety-nine dollars twelve", isCorrect:false}], rationale: "Forma curta comum para pre√ßos."},
                {q: "Complete: 'My house number is ____.' (404)", options: [{text:"Four zero four", isCorrect:true}, {text:"Four hundred four", isCorrect:false}, {text:"Forty four", isCorrect:false}, {text:"Four hundred and zero four", isCorrect:false}], rationale: "Endere√ßos tamb√©m costumam ser d√≠gito a d√≠gito."},
                {q: "Choose the correct option: 'My phone number starts with ____.' (9)", options: [{text:"Nine", isCorrect:true}, {text:"Ninety", isCorrect:false}, {text:"Ninth", isCorrect:false}, {text:"Nineteen", isCorrect:false}], rationale: "D√≠gito 9 = Nine."},
                {q: "What number comes after thirty-nine?", options: [{text:"Forty", isCorrect:true}, {text:"Thirty-ten", isCorrect:false}, {text:"Fourteen", isCorrect:false}, {text:"Forty-one", isCorrect:false}], rationale: "39 -> 40 (Forty)."},
                {q: "Choose the correct sentence:", options: [{text:"The price is twenty dollars and fifty cents", isCorrect:true}, {text:"The price is 20 dollars and 50", isCorrect:false}, {text:"The price is twenty dollars fifty", isCorrect:false}, {text:"The price is twenty fifty", isCorrect:false}], rationale: "Forma completa e correta de pre√ßo."},
                {q: "How do we usually say apartment numbers?", options: [{text:"Digit by digit", isCorrect:true}, {text:"Using ordinal numbers", isCorrect:false}, {text:"Using letters", isCorrect:false}, {text:"Using plural numbers", isCorrect:false}], rationale: "Como telefones e endere√ßos."},
                {q: "Choose the correct spelling:", options: [{text:"Forty", isCorrect:true}, {text:"Fourty", isCorrect:false}, {text:"Fourtid", isCorrect:false}, {text:"Fourtee", isCorrect:false}], rationale: "Quarenta se escreve Forty (sem o 'u' de Four)."}
            ],
            6: [ // AULA 05: SPELLING
                {q: "Someone asks: 'How do you spell your last name?' You answer:", options: [{text:"S-I-L-V-A", isCorrect:true}, {text:"I am Silva", isCorrect:false}, {text:"Silva", isCorrect:false}, {text:"My name is Silva", isCorrect:false}], rationale: "Soletrar = dizer letra por letra."},
                {q: "Choose the correct spelling: 'Maria'", options: [{text:"M-A-R-I-A", isCorrect:true}, {text:"M-E-R-I-A", isCorrect:false}, {text:"M-A-R-E-A", isCorrect:false}, {text:"M-E-R-E-A", isCorrect:false}], rationale: "A soletra√ß√£o correta."},
                {q: "How do you say @ in English?", options: [{text:"At", isCorrect:true}, {text:"On", isCorrect:false}, {text:"In", isCorrect:false}, {text:"To", isCorrect:false}], rationale: "@ = At."},
                {q: "Complete: 'My email is anna ____ hotmail.com'", options: [{text:"at", isCorrect:true}, {text:"on", isCorrect:false}, {text:"in", isCorrect:false}, {text:"to", isCorrect:false}], rationale: "Usa-se 'at' para o @."},
                {q: "Which sentence is correct?", options: [{text:"Can you spell your name?", isCorrect:true}, {text:"Can you spell me your name?", isCorrect:false}, {text:"You spell your name?", isCorrect:false}, {text:"Spell you your name?", isCorrect:false}], rationale: "Pergunta correta de habilidade."},
                {q: "How do you abbreviate Television?", options: [{text:"T-V", isCorrect:true}, {text:"Tee-vee", isCorrect:false}, {text:"Ti-vi", isCorrect:false}, {text:"Tee-vi", isCorrect:false}], rationale: "TV s√£o as letras T e V."},
                {q: "Choose the correct option: 'My name is Jacob. It has ____ letters.'", options: [{text:"five", isCorrect:true}, {text:"fifth", isCorrect:false}, {text:"fiveth", isCorrect:false}, {text:"fifteenth", isCorrect:false}], rationale: "J-A-C-O-B = 5 letras."},
                {q: "When spelling information, we usually:", options: [{text:"Say each letter clearly", isCorrect:true}, {text:"Speak fast", isCorrect:false}, {text:"Use ordinal numbers", isCorrect:false}, {text:"Translate the word", isCorrect:false}], rationale: "Clareza √© essencial ao soletrar."},
                {q: "Choose the correct spelling: 'Google'", options: [{text:"G-O-O-G-L-E", isCorrect:true}, {text:"G-O-G-L-E", isCorrect:false}, {text:"G-U-G-L-E", isCorrect:false}, {text:"G-O-O-G-E-L", isCorrect:false}], rationale: "Soletra√ß√£o correta da marca."},
                {q: "What do we say after spelling a word?", options: [{text:"That‚Äôs correct", isCorrect:true}, {text:"Thank you", isCorrect:false}, {text:"How are you?", isCorrect:false}, {text:"Goodbye", isCorrect:false}], rationale: "Confirmamos que est√° correto."}
            ]
        };

        // Fallback generator for other modules to ensure 10 questions exist
        function getQuizDataForModule(id) {
            if (quizData[id]) return quizData[id];

            // Generic fallback questions based on module name
            const modName = aulaNames.find(a => a.id === id).name;
            const generic = [];
            for(let i=0; i<10; i++) {
                generic.push({
                    q: `Qual a op√ß√£o correta?`,
                    options: [
                        {text: "Op√ß√£o Correta", isCorrect: true},
                        {text: "Op√ß√£o Errada 1", isCorrect: false},
                        {text: "Op√ß√£o Errada 2", isCorrect: false},
                        {text: "Op√ß√£o Errada 3", isCorrect: false}
                    ],
                    rationale: "Esta √© uma pergunta de treino gerada para completar o exerc√≠cio."
                });
            }
            return generic;
        }

        let currentQuestion = null;
        let questionsPool = [];
        let answerSubmitted = false;
        let currentFlashcardIdx = 0;
        let currentShuffledCards = [];
        let currentShuffledData = []; 
        let currentIdx = 0; 
        let scrambleResult = [];

        // Web Speech API - funciona em qualquer navegador moderno, sem precisar de API key
        function speakText(text) {
            return new Promise((resolve) => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.9;
                    utterance.pitch = 1;
                    
                    // Tenta encontrar uma voz em ingl√™s
                    const voices = window.speechSynthesis.getVoices();
                    const englishVoice = voices.find(v => v.lang.startsWith('en')) || voices[0];
                    if (englishVoice) utterance.voice = englishVoice;
                    
                    utterance.onend = () => resolve();
                    utterance.onerror = () => resolve();
                    window.speechSynthesis.speak(utterance);
                } else {
                    resolve();
                }
            });
        }
        
        // Carrega vozes quando dispon√≠veis
        if ('speechSynthesis' in window) {
            window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();
        }

        async function fetchTTSAudio(text) {
            // Retorna um objeto compat√≠vel com a interface esperada
            return {
                play: () => speakText(text),
                pause: () => window.speechSynthesis.cancel()
            };
        }

        window.showDashboard = function() {
            document.getElementById('dashboard-view').classList.remove('hidden');
            document.getElementById('hm-shortcuts-container').classList.remove('hidden');
            document.getElementById('generator-view').classList.add('hidden');
            document.getElementById('study-view').classList.add('hidden');
        };

        window.scrollToModule = function(id) {
            const el = document.getElementById(`module-${id}`);
            if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function renderDashboard() {
            const shortcuts = document.getElementById('hm-shortcuts-container');
            shortcuts.innerHTML = aulaNames.map(aula => {
                const label = `HM ${String(aula.id).padStart(2, '0')}`;
                return aula.hasHomework 
                    ? `<div class="hm-box hm-box-active" onclick="scrollToModule(${aula.id})">${label}</div>`
                    : `<div class="hm-box hm-box-locked"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></div>`;
            }).join('');

            const container = document.getElementById('level-cards-container');
            container.innerHTML = aulaNames.map(aula => {
                let studyLabel = '';
                if (aula.specialMode === 'flashcards') studyLabel = 'FLASHCARDS';
                else if (aula.specialMode === 'listening') studyLabel = 'LISTENING';
                else if (aula.specialMode === 'chunks') studyLabel = 'CHUNKS';
                else if (aula.specialMode === 'mistake') studyLabel = 'DETETIVE';
                else if (aula.specialMode === 'scramble') studyLabel = 'SCRAMBLE';

                const sBtn = studyLabel ? `<button class="secondary-button flex-1 text-xs" onclick="openStudy(${aula.id})">${studyLabel}</button>` : '';
                const tBtn = (aula.id === 23) ? `<button class="secondary-button flex-1 text-xs" onclick="openFlashcards(23)">FLASHCARDS</button>` : '';
                const dBtn = (aula.thirdBtn === 'dictation') ? `<button class="secondary-button flex-1 text-xs" onclick="openDictation(${aula.id})">DICTATION</button>` : '';

                return `
                <div class="level-card relative ${!aula.hasHomework ? 'locked' : ''}" id="module-${aula.id}">
                    ${!aula.hasHomework ? `
                        <div class="lock-overlay">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                        </div>
                    ` : `<img src="https://res.cloudinary.com/dqfi22uz0/image/upload/v1760657894/SLAP_ICON_PRETO_2_2_tv8bmp.png" alt="Logo" class="absolute top-4 right-4 w-8 h-8 opacity-10">`}
                    <div>
                        <span class="module-tag">STARTER 1 - HW AULA ${String(aula.id).padStart(2, '0')}</span>
                        <h3 class="text-xl font-bold text-stone-800 mb-2 mt-2">${aula.name}</h3>
                        <p class="text-stone-500 text-sm mb-6">${aula.hasHomework ? 'Pratique as estruturas aprendidas em aula.' : 'Sem homework dispon√≠vel.'}</p>
                    </div>
                    <div class="flex flex-nowrap gap-2">
                        ${sBtn} ${tBtn} ${dBtn}
                        <button class="action-button flex-1 text-xs uppercase" ${!aula.hasHomework ? 'disabled' : `onclick="openPractice(${aula.id})"`}>HOMEWORK</button>
                    </div>
                </div>`
            }).join('');
        }

        window.openPractice = function(id) {
            currentAulaId = id; 
            const aula = aulaNames.find(a => a.id === id);
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('hm-shortcuts-container').classList.add('hidden'); 
            document.getElementById('generator-view').classList.remove('hidden');
            document.getElementById('current-hw-display').textContent = "Homework: " + aulaNames.find(a => a.id===id).name;
            quizStreak = 0; renderQuizStreak(); loadNextQuestion();
        };

        window.loadNextQuestion = function() {
            if (quizStreak >= STREAK_GOAL) {
                document.getElementById('main-question').innerHTML = `<div class="text-center py-4"><div class="text-6xl mb-4">üì∏</div><h2 class="text-2xl font-bold">Miss√£o Cumprida!</h2><p class="text-stone-500">Tire um print para o seu Teacher!</p></div>`;
                document.getElementById('options-container').innerHTML = `<button class="action-button" onclick="showDashboard()">Voltar</button>`;
                document.getElementById('rationale-display').classList.add('hidden');
                document.getElementById('feedback-alert').classList.add('hidden');
                return;
            }

            if (questionsPool.length === 0) {
                 questionsPool = shuffle([...getQuizDataForModule(currentAulaId)]); 
            }

            currentQuestion = questionsPool.pop();

            document.getElementById('main-question').textContent = currentQuestion.q;
            document.getElementById('rationale-display').classList.add('hidden');
            document.getElementById('feedback-alert').classList.add('hidden');
            answerSubmitted = false;

            const container = document.getElementById('options-container');
            container.innerHTML = currentQuestion.options.map((opt, i) => 
                `<button class="option-button w-full border-2 border-slate-200 p-4 rounded-xl font-bold text-left hover:border-indigo-400 transition-all flex items-center" onclick="submitAnswer(${idxToBool(opt.isCorrect)}, ${i}, '${(currentQuestion.rationale || "").replace(/'/g, "\\'")}')">
                    <span class="w-8 h-8 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center font-bold mr-3 flex-shrink-0 text-sm border border-indigo-100">${String.fromCharCode(65+i)}</span>
                    <span>${opt.text}</span>
                </button>`
            ).join('');
        };

        function idxToBool(val) { return val ? 'true' : 'false'; } 

        window.submitAnswer = function(correct, idx, rationale) {
            if (answerSubmitted) return;
            answerSubmitted = true;
            const alert = document.getElementById('feedback-alert');

            if (correct) {
                alert.textContent = "Muito bem!";
                alert.className = `p-3 mb-6 rounded-lg text-green-900 font-semibold text-center bg-green-100 border border-green-300`;
                quizStreak++;
            } else {
                alert.textContent = "Que pena! O streak reiniciou.";
                alert.className = `p-3 mb-6 rounded-lg text-red-900 font-semibold text-center bg-red-100 border border-red-300`;
                quizStreak = 0;
            }
            renderQuizStreak();

            document.getElementById('rationale-content').textContent = rationale;
            document.getElementById('rationale-display').classList.remove('hidden');
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.disabled = true;
                if (i === idx) {
                   if(correct) btn.classList.add('bg-green-50', 'border-green-400');
                   else btn.classList.add('bg-red-50', 'border-red-400');
                }
            });
        };

        function renderQuizStreak() {
            let dots = '';
            for(let i=0; i<STREAK_GOAL; i++) dots += `<div class="streak-dot ${i < quizStreak ? 'active' : ''}"></div>`;
            document.getElementById('quiz-streak-bar').innerHTML = dots;
        }

        window.openStudy = function(id) {
            const aula = aulaNames.find(a => a.id === id);
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('hm-shortcuts-container').classList.add('hidden'); // HIDE SHORTCUTS
            document.getElementById('study-view').classList.remove('hidden');
            const titleArea = document.getElementById('study-title');
            const instrArea = document.getElementById('study-instruction');
            const contentArea = document.getElementById('study-content-area');
            const statusArea = document.getElementById('preloading-status');

            titleArea.textContent = aula.name;
            statusArea.textContent = "";
            currentIdx = 0;
            currentStreak = 0; // Reset streak
            renderStreakBar(); // Initial render

            if (aula.specialMode === 'flashcards') {
                instrArea.textContent = "Toque na carta para ver a tradu√ß√£o.";
                currentFlashcardIdx = 0; 
                currentShuffledCards = shuffle([...flashcardsData[id]]); 
                renderFlashcards();
            } else if (aula.specialMode === 'listening') {
                instrArea.textContent = "Toque no item para ouvir.";
                renderListeningBoard(aula.items);
            } else if (aula.specialMode === 'chunks') {
                titleArea.textContent = "CHUNKS OF LANGUAGE";
                instrArea.textContent = "Clique no olho para revelar.";
                renderChunksGrid(chunksData[id]);
            } else if (aula.specialMode === 'mistake') {
                instrArea.textContent = "Clique na palavra que cont√©m o erro.";
                currentShuffledData = shuffle([...gamesData[id]]);
                renderMistake();
            } else if (aula.specialMode === 'scramble') {
                instrArea.textContent = "Ordene as palavras para formar a frase.";
                currentShuffledData = shuffle([...gamesData[id]]);
                renderScramble();
            }
        };

        window.openFlashcards = function(id) {
            const aula = aulaNames.find(a => a.id === id);
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('hm-shortcuts-container').classList.add('hidden'); // HIDE SHORTCUTS
            document.getElementById('study-view').classList.remove('hidden');
            document.getElementById('study-title').textContent = "Flashcards: Holidays";
            currentFlashcardIdx = 0; currentShuffledCards = shuffle([...flashcardsData[id]]); renderFlashcards();
        }

        window.openDictation = function(id) {
             const aula = aulaNames.find(a => a.id === id);
             document.getElementById('dashboard-view').classList.add('hidden');
             document.getElementById('hm-shortcuts-container').classList.add('hidden');
             document.getElementById('study-view').classList.remove('hidden');
             document.getElementById('study-title').textContent = "Dictation Mode";
             document.getElementById('study-instruction').textContent = "Ou√ßa o √°udio e escreva o que ouvir (n√∫meros ou extenso).";
             currentShuffledData = shuffle([...gamesData[id].dictation]);
             currentIdx = 0;
             currentStreak = 0; // Reset Streak
             renderStreakBar(); // Initial render
             renderDictation();
        }

        window.toggleChunk = function(index) {
            const text = document.getElementById(`chunk-pt-${index}`);
            text.classList.toggle('translation-hidden');
            text.classList.toggle('translation-visible');
        }

        function renderStreakBar() {
            const container = document.getElementById('streak-bar-container');
            if (document.getElementById('study-title').textContent.includes("Dictation") || document.getElementById('study-title').textContent.includes("Scramble") || document.getElementById('study-instruction').textContent.includes("Ordene")) {
                container.classList.remove('hidden');
                let dots = '';
                for(let i=0; i<STREAK_GOAL; i++) {
                    const activeClass = i < currentStreak ? 'active' : '';
                    dots += `<div class="streak-dot ${activeClass}"></div>`;
                }
                container.innerHTML = `<span class="text-sm font-bold text-stone-400 mr-2">STREAK:</span> ${dots}`;
            } else {
                container.classList.add('hidden');
            }
        }

        function renderChunksGrid(data) {
            const area = document.getElementById('study-content-area');
            area.innerHTML = `<div class="chunks-grid shadow-lg">${data.map((item, index) => `
                <div class="chunks-cell chunks-cell-en">${item.en}</div>
                <div class="chunks-cell chunks-cell-pt"><span id="chunk-pt-${index}" class="translation-hidden">${item.pt}</span>
                    <button onclick="toggleChunk(${index})" class="p-1 ml-2"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button>
                </div>`).join('')}</div>`;
        }

        async function renderListeningBoard(items) {
            const area = document.getElementById('study-content-area');
            area.innerHTML = `<div class="listening-grid"></div>`;
            const grid = area.querySelector('.listening-grid');
            items.forEach((item, i) => {
                const btn = document.createElement('button');
                btn.className = 'number-btn';
                btn.innerHTML = `<span class="main-text">${item.n || item}</span><span class="sub-text">${item.w || ''}</span>`;
                btn.onclick = async () => {
                    if (btn.classList.contains('playing')) return;
                    btn.classList.add('playing');
                    const audio = await fetchTTSAudio(item.w || item);
                    if (audio) { 
                        await audio.play(); 
                        btn.classList.remove('playing');
                    } else {
                        btn.classList.remove('playing');
                    }
                };
                grid.appendChild(btn);
            });
        }

        function renderFlashcards() {
            const area = document.getElementById('study-content-area');
            const update = () => {
                const card = currentShuffledCards[currentFlashcardIdx];
                const isText = /[a-zA-Z0-9]/.test(card.front); 
                const frontSize = isText ? 'text-4xl' : 'text-9xl';
                area.innerHTML = `
                    <div class="flashcard-container" onclick="this.querySelector('.flashcard').classList.toggle('flipped')">
                        <div class="flashcard"><div class="flashcard-front"><span class="text-xs absolute top-8 opacity-50 font-bold tracking-widest">PORTUGUESE</span><span class="${frontSize} font-bold mt-4">${card.front}</span></div>
                        <div class="flashcard-back"><span class="text-xs absolute top-8 opacity-50 font-bold tracking-widest">ENGLISH</span><span class="text-3xl font-bold mt-4">${card.back}</span></div></div>
                    </div>
                    <div class="flex items-center justify-between max-w-xs mx-auto mt-4">
                        <button class="secondary-button p-3 rounded-full" onclick="changeFC(-1)"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m15 18-6-6 6-6"/></svg></button>
                        <span class="font-bold text-stone-400">${currentFlashcardIdx + 1} / ${currentShuffledCards.length}</span>
                        <button class="secondary-button p-3 rounded-full" onclick="changeFC(1)"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg></button>
                    </div>`;
            };
            window.changeFC = (dir) => { currentFlashcardIdx = (currentFlashcardIdx + dir + currentShuffledCards.length) % currentShuffledCards.length; update(); };
            update();
        }

        function renderMistake() {
            const area = document.getElementById('study-content-area');
            renderStreakBar();

            if (currentStreak >= STREAK_GOAL) {
                 area.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-10">
                        <div class="text-6xl mb-4">üì∏</div>
                        <h2 class="text-3xl font-bold text-stone-800 mb-2">Miss√£o Cumprida!</h2>
                        <p class="text-stone-500 mb-8">Tire um print e envie para o seu teacher!</p>
                        <button class="action-button px-8" onclick="showDashboard()">Voltar</button>
                        <button class="secondary-button mt-4" onclick="currentStreak=0; currentShuffledData=shuffle([...currentShuffledData]); renderMistake()">Reiniciar</button>
                    </div>`;
                return;
            }

            const item = currentShuffledData[currentIdx];
            const words = item.sentence.split(' ');
            area.innerHTML = `
                <div class="text-2xl font-bold mb-8 leading-loose">
                    ${words.map(w => `<span class="mistake-word" onclick="checkMistakeClick(this, '${w}', '${item.wrong}', '${item.correct}', '${item.rationale}')">${w}</span>`).join(' ')}
                </div>
                <div id="mistake-fb" class="hidden p-4 rounded-xl mb-4 text-left"></div>
                <button class="action-button w-full hidden" id="mistake-next" onclick="window.nextRound(renderMistake)">Pr√≥xima Frase</button>
            `;
        }

        window.checkMistakeClick = function(el, w, wrong, correct, rationale) {
            const clean = w.replace(/[.,]/g, "");
            const fb = document.getElementById('mistake-fb');
            if (clean === wrong) {
                el.classList.add('correct-choice');
                fb.innerHTML = `<p class="font-bold text-green-800">Correct! O erro era "${wrong}". O certo √© "${correct}".</p><p class="text-sm text-green-700 mt-2">${rationale}</p>`;
                fb.className = "p-4 rounded-xl bg-green-100 block mb-4";
                document.getElementById('mistake-next').classList.remove('hidden');
                document.querySelectorAll('.mistake-word').forEach(m => m.onclick = null);
                currentStreak++;
            } else {
                el.classList.add('wrong-choice');
                currentStreak = 0; // Reset on error
            }
            renderStreakBar();
        };

        function renderScramble() {
            const area = document.getElementById('study-content-area');
            renderStreakBar();

            if (currentStreak >= STREAK_GOAL) {
                area.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-10">
                        <div class="text-6xl mb-4">üèÜ</div>
                        <h2 class="text-3xl font-bold text-stone-800 mb-2">Miss√£o Cumprida!</h2>
                        <p class="text-stone-500 mb-8">Tire um print e envie para o seu teacher para mostrar que voc√™ arrasou!</p>
                        <button class="action-button px-8" onclick="showDashboard()">Voltar ao Menu</button>
                        <button class="secondary-button mt-4" onclick="currentStreak=0; currentIdx=0; currentShuffledData=shuffle([...currentShuffledData]); renderScramble()">Jogar Novamente</button>
                    </div>
                `;
                return;
            }

            const item = currentShuffledData[currentIdx % currentShuffledData.length];
            const totalSentences = currentShuffledData.length;
            const currentSentence = (currentIdx % totalSentences) + 1;
            scrambleResult = [];
            const shuffled = shuffle([...item.words]);
            area.innerHTML = `
                <div class="text-center mb-4">
                    <span class="inline-block bg-primary/10 text-primary px-4 py-2 rounded-full font-bold text-sm">
                        Frase ${currentSentence} / ${totalSentences}
                    </span>
                </div>
                <div id="scramble-fb" class="hidden p-4 rounded-xl mb-6 text-center font-bold"></div>
                <div class="scramble-dropzone mb-6" id="scramble-res">Clique nas palavras para formar a frase...</div>
                <div class="flex flex-wrap justify-center gap-3 mb-6">
                    ${shuffled.map(w => `<button class="scramble-word" onclick="pickWord(this, '${w}', '${item.full}')">${w}</button>`).join('')}
                </div>
                <button class="action-button w-full hidden" id="scramble-next" onclick="window.nextRound(renderScramble)">Pr√≥xima Frase</button>
            `;
        }

        window.pickWord = function(btn, w, full) {
            scrambleResult.push(w); document.getElementById('scramble-res').textContent = scrambleResult.join(' '); btn.style.visibility = 'hidden';
            if (scrambleResult.length === full.split(' ').length) {
                const fb = document.getElementById('scramble-fb');
                // Case insensitive check for user convenience but keeping structure
                if (scrambleResult.join(' ').toLowerCase() === full.toLowerCase()) { 
                    currentStreak++; 
                    renderStreakBar(); 
                    fb.textContent = "Perfect! Frase correta.";
                    fb.className = "p-4 rounded-xl bg-green-100 text-green-800 block mb-4";
                    document.getElementById('scramble-next').classList.remove('hidden');
                } else { 
                    currentStreak = 0; 
                    renderStreakBar(); 
                    fb.innerHTML = `Errou! Tente de novo. <button class="underline ml-2" onclick="renderScramble()">Reset</button>`;
                    fb.className = "p-4 rounded-xl bg-red-100 text-red-800 block mb-4";
                }
            }
        };

        function renderDictation() {
            const area = document.getElementById('study-content-area');
            renderStreakBar();

            if (currentStreak >= STREAK_GOAL) {
                 area.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-10">
                        <div class="text-6xl mb-4">üèÜ</div>
                        <h2 class="text-3xl font-bold text-stone-800 mb-2">Excelente!</h2>
                        <p class="text-stone-500 mb-8">Voc√™ completou o streak de 5 ditados.</p>
                        <button class="action-button px-8" onclick="showDashboard()">Voltar</button>
                        <button class="secondary-button mt-4" onclick="currentStreak=0; currentIdx=0; currentShuffledData=shuffle([...currentShuffledData]); renderDictation()">Reiniciar</button>
                    </div>
                `;
                return;
            }

            const item = currentShuffledData[currentIdx % currentShuffledData.length];
            const totalItems = currentShuffledData.length;
            const currentItem = (currentIdx % totalItems) + 1;
            area.innerHTML = `
                <div class="flex flex-col items-center gap-6 mt-4">
                    <div class="text-center mb-2">
                        <span class="inline-block bg-primary/10 text-primary px-4 py-2 rounded-full font-bold text-sm">
                            Palavra ${currentItem} / ${totalItems}
                        </span>
                    </div>
                    <p class="text-stone-500 text-sm mb-2">Clique no bot√£o para ouvir e digite o que voc√™ ouviu</p>
                    <button id="dict-play" class="w-24 h-24 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-full flex items-center justify-center hover:from-indigo-200 hover:to-purple-200 transition-all shadow-lg transform hover:scale-105" onclick="playDictation('${item}')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#8671d1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path><path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path></svg>
                    </button>
                    <input type="text" id="dict-input" class="dictation-input" placeholder="Digite aqui..." autocomplete="off" onkeypress="if(event.key==='Enter')checkDictation('${item}')">
                    <button class="action-button max-w-xs" onclick="checkDictation('${item}')">Verificar</button>
                    <div id="dict-fb" class="hidden p-4 rounded-xl font-bold text-lg"></div>
                    <button class="secondary-button hidden" id="dict-next" onclick="window.nextRound(renderDictation)">Pr√≥xima Palavra</button>
                </div>
            `;
        }

        window.playDictation = async function(text) {
             const btn = document.getElementById('dict-play');
             btn.classList.add('animate-pulse');
             const audio = await fetchTTSAudio(text);
             if (audio) { 
                 await audio.play(); 
                 btn.classList.remove('animate-pulse'); 
             } else {
                 btn.classList.remove('animate-pulse'); 
             }
        }

        window.checkDictation = function(correct) {
            const input = document.getElementById('dict-input');
            const val = input.value.toLowerCase().trim();
            const fb = document.getElementById('dict-fb');

            if (val === correct.toLowerCase()) {
                input.classList.add('correct');
                fb.textContent = "Correto!";
                fb.className = "p-3 rounded-lg font-bold text-lg mt-2 bg-green-100 text-green-700 block";
                document.getElementById('dict-next').classList.remove('hidden');
                currentStreak++;
            } else {
                input.classList.add('wrong');
                fb.innerHTML = `Incorreto. A resposta era <strong>${correct}</strong>`;
                fb.className = "p-3 rounded-lg font-bold text-lg mt-2 bg-red-100 text-red-700 block";
                currentStreak = 0; 
                document.getElementById('dict-next').classList.remove('hidden');
            }
            renderStreakBar();
        }

        window.nextRound = function(cb) {
            currentIdx = (currentIdx + 1) % currentShuffledData.length;
            cb();
        };

        function shuffle(a) { for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; } return a; }
        function scrollToModule(id) { document.getElementById(`module-${id}`).scrollIntoView({ behavior: 'smooth', block: 'center' }); }
        window.scrollToModule = scrollToModule;

        window.onload = function() { 
            // Bypass login for now as requested
            document.getElementById('main-wrapper').classList.remove('hidden'); 
            renderDashboard(); 
        };
    </script>
</body>
</html>
