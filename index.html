<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SLAP | HOMEWORK - STARTER 1</title>
    <!-- SLAP Favicon -->
    <link rel="icon" type="image/png" href="https://res.cloudinary.com/dqfi22uz0/image/upload/v1749543469/SLAP_FAVICON_AMARELO_coilvj.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: DM Sans -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'DM Sans', sans-serif;
            background-color: #f4f7f9;
            min-height: 100vh;
        }
        
        #main-wrapper {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .action-button {
             background-color: #F1D24B; 
             color: #44403c;
             padding: 0.75rem 1.5rem; 
             border-radius: 0.75rem; 
             font-weight: 700; 
             cursor: pointer; 
             transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
             display: inline-flex;
             align-items: center;
             justify-content: center; 
             gap: 0.5rem;
             box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .action-button:hover:not(:disabled) {
            background-color: #eab308;
            transform: translateY(-2px);
        }
        .action-button:disabled {
            background-color: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .secondary-button {
            background-color: #44403c;
            color: white;
            padding: 0.75rem 1.5rem; 
            border-radius: 0.75rem; 
            font-weight: 500; 
            cursor: pointer; 
            transition: background-color 0.2s, transform 0.2s;
            box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .secondary-button:hover:not(:disabled) {
            background-color: #292524;
            transform: translateY(-1px);
        }
        .secondary-button:disabled {
            background-color: #f3f4f6;
            color: #d1d5db;
            cursor: not-allowed;
            box-shadow: none;
        }

        .tertiary-button {
            background-color: #8671d1;
            color: white;
            padding: 0.75rem 1.5rem; 
            border-radius: 0.75rem; 
            font-weight: 500; 
            cursor: pointer; 
            transition: all 0.2s;
            box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .tertiary-button:hover:not(:disabled) {
            background-color: #6d5b9b;
            transform: translateY(-1px);
        }
        
        .option-button {
            background-color: white;
            border: 2px solid #e5e7eb;
            color: #44403c;
            text-align: left;
            padding: 1rem;
            border-radius: 0.75rem;
            width: 100%;
            transition: all 0.2s;
            cursor: pointer;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .option-button:hover:not(:disabled) {
            border-color: #8671d1;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        .option-prefix {
            font-weight: 700;
            color: #8671d1;
            min-width: 1.5rem;
            text-align: center;
        }
        
        .module-tag {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background-color: #8671d1;
            color: white;
            font-size: 0.75rem;
            font-weight: 700;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
            letter-spacing: 0.05em;
        }

        .level-card {
            background-color: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); 
            transition: all 0.2s ease-in-out;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
        }
        .level-card:not(.locked):hover {
            transform: scale(1.02); 
            border-color: #8671d1;
        }
        
        .level-card.locked {
            opacity: 0.6;
            background-color: #f9fafb;
            cursor: not-allowed;
        }

        #login-gate {
            background-color: #44403c;
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 2rem;
        }
        .login-card {
            background-color: white;
            color: #44403c;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            max-width: 450px;
            width: 100%;
        }
        .login-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            margin-top: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 1rem;
        }

        .generator-view-container {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
        }

        .challenge-box {
            background-color: #eef2ff;
            padding: 1.5rem;
            border-radius: 0.75rem;
            border-left: 5px solid #84c7df;
        }

        /* Flashcard Styles */
        .flashcard-container {
            perspective: 1000px;
            width: 100%;
            max-width: 400px;
            height: 250px;
            margin: 1.5rem auto;
            cursor: pointer;
        }

        .flashcard {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .flashcard-front {
            background-color: #8671d1;
            color: white;
        }

        .flashcard-back {
            background-color: #F1D24B;
            color: #44403c;
            transform: rotateY(180deg);
        }

        /* Listening Board Styles */
        .listening-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .number-btn {
            background-color: white;
            border: 2px solid #e5e7eb;
            border-radius: 1rem;
            padding: 1rem 0.5rem;
            font-size: 1.25rem;
            font-weight: 800;
            color: #44403c;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            cursor: pointer;
            position: relative;
        }

        .number-btn:hover {
            border-color: #8671d1;
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(134, 113, 209, 0.2);
        }

        .number-btn.playing {
            border-color: #F1D24B;
            background-color: #fffbeb;
            animation: pulse 1s infinite;
        }

        .number-btn.loading {
            opacity: 0.6;
            cursor: wait;
        }

        .number-label {
            font-size: 0.75rem;
            color: #8671d1;
            text-transform: none;
            letter-spacing: 0.05em;
            font-weight: 700;
            text-align: center;
            line-height: 1.2;
            word-break: break-word;
        }

        .ready-icon {
            position: absolute;
            top: 5px;
            right: 5px;
            color: #8671d1;
            opacity: 0.4;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    
    <!-- LOGIN GATE -->
    <div id="login-gate">
        <div class="login-card text-center">
            <h1 class="text-3xl font-bold mb-4 text-[#8671d1]">SLAP Homework Access</h1>
            <p class="text-lg font-medium mb-6">Digite a senha do n√≠vel Starter 1:</p>
            
            <form id="login-form" onsubmit="checkPassword(event)">
                <label for="password-input" class="block text-left font-semibold text-sm mb-1">
                    Senha (Ariana):
                </label>
                <input type="password" id="password-input" class="login-input" placeholder="ex: ariana" required>
                <button type="submit" class="action-button w-full">Acessar Homeworks</button>
                <p id="login-feedback" class="mt-4 text-red-600 hidden font-bold">Senha incorreta.</p>
            </form>
        </div>
    </div>

    <div id="main-wrapper" class="hidden">
        <header class="py-6 border-b border-stone-200 mb-8">
            <img src="https://res.cloudinary.com/dqfi22uz0/image/upload/v1759294967/SLAP_TIPO_PRETO_2_kismg9.png" alt="SLAP Logo" class="w-32 h-auto mx-auto mb-2">
            <h1 class="text-3xl font-bold text-center text-stone-800 uppercase tracking-tight">HOMEWORK - STARTER 1</h1>
            <p class="text-center text-stone-500 font-medium">Portal de Atividades Pr√°ticas</p>
        </header>

        <!-- DASHBOARD VIEW -->
        <div id="dashboard-view" class="w-full">
            <div id="level-cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Cards renderizados por JS -->
            </div>
        </div>

        <!-- PRACTICE VIEW -->
        <div id="generator-view" class="hidden w-full">
            <button class="secondary-button mb-6" onclick="showDashboard()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                Voltar
            </button>
            <div class="generator-view-container">
                <h2 class="text-2xl font-bold text-stone-800 mb-4 text-center" id="current-hw-display"></h2>
                <div id="feedback-alert" class="hidden p-3 mb-6 rounded-lg text-white font-semibold text-center"></div>
                <div class="challenge-box mb-8">
                    <p id="main-question" class="text-xl font-bold text-indigo-900"></p>
                </div>
                <div id="options-container" class="mt-8 space-y-3"></div>
                <div id="rationale-display" class="hidden mt-6">
                    <div id="rationale-content" class="p-4 bg-amber-50 rounded-lg text-amber-900 mb-4"></div>
                    <button class="action-button w-full" onclick="loadNextQuestion()">Pr√≥ximo Exerc√≠cio</button>
                </div>
            </div>
        </div>

        <!-- STUDY VIEW -->
        <div id="study-view" class="hidden w-full">
             <button class="secondary-button mb-6" onclick="showDashboard()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                Voltar
            </button>
            <div class="generator-view-container text-center">
                 <h2 class="text-2xl font-bold text-stone-800 mb-6" id="study-title"></h2>
                 <p class="text-stone-600 mb-2" id="study-instruction">Revise o conte√∫do desta aula antes de praticar.</p>
                 <div id="preloading-status" class="text-xs text-blue-500 font-bold mb-6 h-4"></div>
                 <div id="study-content-area" class="p-8 bg-slate-50 border-2 border-dashed border-slate-200 rounded-xl">
                     <!-- √Åudio, Flashcards ou Listening Board aqui -->
                 </div>
            </div>
        </div>
    </div>
    
    <script>
        const apiKey = ""; 
        const audioCache = new Map();

        const aulaNames = [
            { id: 1, name: "Open House", hasHomework: false },
            { id: 2, name: "Feelings", hasHomework: true, specialMode: 'flashcards' },
            { id: 3, name: "Names & Greetings", hasHomework: true },
            { id: 4, name: "Numbers pt. 1", hasHomework: true, specialMode: 'listening', items: [
                {n: "1", w: "One"}, {n: "2", w: "Two"}, {n: "3", w: "Three"}, {n: "4", w: "Four"}, {n: "5", w: "Five"},
                {n: "6", w: "Six"}, {n: "7", w: "Seven"}, {n: "8", w: "Eight"}, {n: "9", w: "Nine"}, {n: "10", w: "Ten"},
                {n: "11", w: "Eleven"}, {n: "12", w: "Twelve"}, {n: "13", w: "Thirteen"}, {n: "14", w: "Fourteen"}, {n: "15", w: "Fifteen"},
                {n: "16", w: "Sixteen"}, {n: "17", w: "Seventeen"}, {n: "18", w: "Eighteen"}, {n: "19", w: "Nineteen"}, {n: "20", w: "Twenty"},
                {n: "22", w: "Twenty-two"}, {n: "30", w: "Thirty"}, {n: "35", w: "Thirty-five"}, {n: "40", w: "Forty"}, {n: "48", w: "Forty-eight"},
                {n: "50", w: "Fifty"}, {n: "51", w: "Fifty-one"}, {n: "60", w: "Sixty"}, {n: "64", w: "Sixty-four"}, {n: "70", w: "Seventy"},
                {n: "77", w: "Seventy-seven"}, {n: "80", w: "Eighty"}, {n: "86", w: "Eighty-six"}, {n: "90", w: "Ninety"}, {n: "99", w: "Ninety-nine"}
            ]},
            { id: 5, name: "Numbers pt. 2", hasHomework: true, specialMode: 'listening', items: [
                {n: "100", w: "One hundred"}, {n: "150", w: "One hundred and fifty"}, {n: "200", w: "Two hundred"}, {n: "300", w: "Three hundred"}, {n: "325", w: "Three hundred and twenty-five"},
                {n: "400", w: "Four hundred"}, {n: "500", w: "Five hundred"}, {n: "505", w: "Five hundred and five"}, {n: "600", w: "Six hundred"}, {n: "700", w: "Seven hundred"},
                {n: "800", w: "Eight hundred"}, {n: "900", w: "Nine hundred"}, {n: "1,000", w: "One thousand"}, {n: "1,200", w: "One thousand two hundred"}, {n: "2,000", w: "Two thousand"},
                {n: "4,000", w: "Four thousand"}, {n: "5,500", w: "Five thousand five hundred"}, {n: "10,000", w: "Ten thousand"}, {n: "10,500", w: "Ten thousand five hundred"}, {n: "20,000", w: "Twenty thousand"},
                {n: "30,000", w: "Thirty thousand"}, {n: "40,000", w: "Forty thousand"}, {n: "45,300", w: "Forty-five thousand three hundred"}, {n: "50,000", w: "Fifty thousand"}, {n: "60,000", w: "Sixty thousand"},
                {n: "70,000", w: "Seventy thousand"}, {n: "80,000", w: "Eighty thousand"}, {n: "90,000", w: "Ninety thousand"}
            ]},
            { id: 6, name: "Spelling", hasHomework: true, specialMode: 'listening', items: [
                {n: "A", w: "A", p: "/e…™/"}, {n: "B", w: "B", p: "/biÀê/"}, {n: "C", w: "C", p: "/siÀê/"}, {n: "D", w: "D", p: "/diÀê/"}, {n: "E", w: "E", p: "/iÀê/"},
                {n: "F", w: "F", p: "/…õf/"}, {n: "G", w: "G", p: "/d íiÀê/"}, {n: "H", w: "H", p: "/e…™t É/"}, {n: "I", w: "I", p: "/a…™/"}, {n: "J", w: "J", p: "/d íe…™/"},
                {n: "K", w: "K", p: "/ke…™/"}, {n: "L", w: "L", p: "/…õl/"}, {n: "M", w: "M", p: "/…õm/"}, {n: "N", w: "N", p: "/…õn/"}, {n: "O", w: "O", p: "/o ä/"},
                {n: "P", w: "P", p: "/piÀê/"}, {n: "Q", w: "Q", p: "/kjuÀê/"}, {n: "R", w: "R", p: "/…ëÀêr/"}, {n: "S", w: "S", p: "/…õs/"}, {n: "T", w: "T", p: "/tiÀê/"},
                {n: "U", w: "U", p: "/juÀê/"}, {n: "V", w: "V", p: "/viÀê/"}, {n: "W", w: "W", p: "/Ààd åb…ôljuÀê/"}, {n: "X", w: "X", p: "/…õks/"}, {n: "Y", w: "Y", p: "/wa…™/"}, {n: "Z", w: "Z", p: "/ziÀê/"}
            ]},
            { id: 7, name: "Ordinal Numbers", hasHomework: true, specialMode: 'listening', items: [
                {n: "1st", w: "First"}, {n: "2nd", w: "Second"}, {n: "3rd", w: "Third"}, {n: "4th", w: "Fourth"}, {n: "5th", w: "Fifth"},
                {n: "6th", w: "Sixth"}, {n: "7th", w: "Seventh"}, {n: "8th", w: "Eighth"}, {n: "9th", w: "Ninth"}, {n: "10th", w: "Tenth"},
                {n: "11th", w: "Eleventh"}, {n: "12th", w: "Twelfth"}, {n: "13th", w: "Thirteenth"}, {n: "14th", w: "Fourteenth"}, {n: "15th", w: "Fifteenth"},
                {n: "20th", w: "Twentieth"}, {n: "21st", w: "Twenty-first"}, {n: "22nd", w: "Twenty-second"}, {n: "30th", w: "Thirtieth"}, {n: "31st", w: "Thirty-first"},
                {n: "40th", w: "Fortieth"}, {n: "45th", w: "Forty-fifth"}, {n: "50th", w: "Fiftieth"}, {n: "58th", w: "Fifty-eighth"}, 
                {n: "60th", w: "Sixtieth"}, {n: "63rd", w: "Sixty-third"}, {n: "70th", w: "Seventieth"}, {n: "77th", w: "Seventy-seventh"},
                {n: "80th", w: "Eightieth"}, {n: "89th", w: "Eighty-ninth"}, {n: "90th", w: "Ninetieth"}
            ]},
            { id: 8, name: "Basic Verbs", hasHomework: true },
            { id: 9, name: "Basic Adjectives", hasHomework: true },
            { id: 10, name: "Demonstrative Pronouns", hasHomework: true },
            { id: 11, name: "Verb to be", hasHomework: true },
            { id: 12, name: "Countries and Nationalities", hasHomework: true, specialMode: 'flashcards' },
            { id: 13, name: "Neighborhood", hasHomework: true },
            { id: 14, name: "Family Members", hasHomework: true },
            { id: 15, name: "Midterm Test", hasHomework: false },
            { id: 16, name: "Can e Can't", hasHomework: true },
            { id: 17, name: "Midterm Test Correction", hasHomework: false },
            { id: 18, name: "Simple Present pt. 1", hasHomework: true },
            { id: 19, name: "Simple Present pt. 2", hasHomework: true },
            { id: 20, name: "Object Pronouns", hasHomework: true },
            { id: 21, name: "Likes and Dislikes", hasHomework: true },
            { id: 22, name: "Free Time Activities", hasHomework: true },
            { id: 23, name: "Months and Holidays", hasHomework: true, specialMode: 'listening', thirdBtn: 'flashcards', items: [
                {n: "Jan", w: "January"}, {n: "Feb", w: "February"}, {n: "Mar", w: "March"}, {n: "Apr", w: "April"},
                {n: "May", w: "May"}, {n: "Jun", w: "June"}, {n: "Jul", w: "July"}, {n: "Aug", w: "August"},
                {n: "Sep", w: "September"}, {n: "Oct", w: "October"}, {n: "Nov", w: "November"}, {n: "Dec", w: "December"}
            ]},
            { id: 24, name: "Possessive Adjectives", hasHomework: true },
            { id: 25, name: "Possessive Pronouns", hasHomework: true },
            { id: 26, name: "Foods and Fruits", hasHomework: true, specialMode: 'flashcards' },
            { id: 27, name: "Presentation", hasHomework: false },
            { id: 28, name: "Hours", hasHomework: true, specialMode: 'flashcards' },
            { id: 29, name: "Kahoot Review", hasHomework: false },
            { id: 30, name: "Listening Test", hasHomework: false },
            { id: 31, name: "Grammar Test", hasHomework: false },
            { id: 32, name: "GT e LT Review", hasHomework: false },
            { id: 33, name: "OT Review", hasHomework: false },
            { id: 34, name: "Oral Test Day 1", hasHomework: false },
            { id: 35, name: "Oral Test Day 2", hasHomework: false },
            { id: 36, name: "General Feedback", hasHomework: false }
        ];

        const flashcardsData = {
            2: [
                { front: "Happy", back: "Feliz" }, { front: "Sad", back: "Triste" }, { front: "Angry", back: "Bravo(a)" },
                { front: "Confused", back: "Confuso(a)" }, { front: "Sick", back: "Doente" }, { front: "Surprised", back: "Surpreso(a)" },
                { front: "Anxious", back: "Ansioso(a)" }, { front: "Annoyed", back: "Aborrecido(a)" }, { front: "In love", back: "Apaixonado(a)" },
                { front: "Curious", back: "Curioso(a)" }
            ],
            12: [
                { front: "üáßüá∑", back: "Brazil / Brazilian" }, { front: "üá∫üá∏", back: "USA / American" }, { front: "üá¨üáß", back: "UK / British" },
                { front: "üá®üá¶", back: "Canada / Canadian" }, { front: "üá´üá∑", back: "France / French" }, { front: "üáØüáµ", back: "Japan / Japanese" },
                { front: "üáÆüáπ", back: "Italy / Italian" }, { front: "üáµüáπ", back: "Portugal / Portuguese" }, { front: "üá≤üáΩ", back: "Mexico / Mexican" },
                { front: "üá™üá∏", back: "Spain / Spanish" }, { front: "üá¶üá∑", back: "Argentina / Argentine" }, { front: "üá©üá™", back: "Germany / German" },
                { front: "üá®üá≥", back: "China / Chinese" }, { front: "üá¶üá∫", back: "Australia / Australian" }, { front: "üá∞üá∑", back: "South Korea / Korean" },
                { front: "üá¨üá∑", back: "Greece / Greek" }, { front: "üá∑üá∫", back: "Russia / Russian" }, { front: "üáÆüá≥", back: "India / Indian" },
                { front: "üá™üá¨", back: "Egypt / Egyptian" }, { front: "üáÆüá™", back: "Ireland / Irish" }
            ],
            23: [
                { front: "Ano Novo", back: "New Year's Day" }, 
                { front: "Dia dos Namorados", back: "Valentine's Day" }, 
                { front: "P√°scoa", back: "Easter" },
                { front: "Halloween", back: "Halloween" }, 
                { front: "Natal", back: "Christmas" }, 
                { front: "Anivers√°rio", back: "Birthday" },
                { front: "Dia dos Pais", back: "Father's Day" }, 
                { front: "Dia das M√£es", back: "Mother's Day" }, 
                { front: "Dia de S√£o Patr√≠cio", back: "St. Patrick's Day" },
                { front: "Dia de A√ß√£o de Gra√ßas", back: "Thanksgiving" }
            ],
            26: [
                { front: "üçé", back: "Apple" }, { front: "üçå", back: "Banana" }, { front: "üçì", back: "Strawberry" }, { front: "üçá", back: "Grapes" },
                { front: "üçâ", back: "Watermelon" }, { front: "üçç", back: "Pineapple" }, { front: "üçä", back: "Orange" }, { front: "üçã", back: "Lemon" },
                { front: "ü•¶", back: "Broccoli" }, { front: "ü•ï", back: "Carrot" }, { front: "üåΩ", back: "Corn" }, { front: "üçï", back: "Pizza" },
                { front: "üçî", back: "Hamburger" }, { front: "ü•ö", back: "Egg" }, { front: "üçû", back: "Bread" }, { front: "üßÄ", back: "Cheese" },
                { front: "üçó", back: "Chicken" }, { front: "ü•©", back: "Steak" }, { front: "üçö", back: "Rice" }, { front: "üç¶", back: "Ice cream" }
            ],
            28: [
                { front: "08:00", back: "It's eight o'clock." },
                { front: "08:05", back: "It's five past eight." },
                { front: "08:15", back: "It's (a) quarter past eight." },
                { front: "08:30", back: "It's half past eight." },
                { front: "08:45", back: "It's (a) quarter to nine." },
                { front: "08:50", back: "It's ten to nine." },
                { front: "12:00", back: "It's noon / It's midday." },
                { front: "00:00", back: "It's midnight." },
                { front: "10:10", back: "It's ten past ten." },
                { front: "04:20", back: "It's four twenty." },
                { front: "09:35", back: "It's nine thirty-five." },
                { front: "11:55", back: "It's five to twelve." }
            ]
        };

        const mockQuestions = {
            11: [{ q: "She ___ a student.", options: [{text: "is", isCorrect: true}, {text: "am", isCorrect: false}], rationale: "She usa 'is'." }],
            16: [{ q: "I ___ speak English.", options: [{text: "can", isCorrect: true}, {text: "cans", isCorrect: false}], rationale: "Modal 'can' n√£o muda." }]
        };

        let currentQuestion = null;
        let questionsPool = [];
        let answerSubmitted = false;
        let currentFlashcardIdx = 0;
        let currentShuffledCards = [];

        async function fetchTTSAudio(text) {
            if (audioCache.has(text)) return audioCache.get(text);
            const payload = {
                contents: [{ parts: [{ text: `Say clearly: ${text}` }] }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Aoede" } } }
                },
                model: "gemini-2.5-flash-preview-tts"
            };
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;
            const fetchWithRetry = async (retries = 5, delay = 1000) => {
                try {
                    const response = await fetch(url, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) });
                    if (!response.ok) throw new Error("API limit or error");
                    return await response.json();
                } catch (error) {
                    if (retries > 0) { await new Promise(res => setTimeout(res, delay)); return fetchWithRetry(retries - 1, delay * 2); }
                    throw error;
                }
            };
            try {
                const result = await fetchWithRetry();
                const pcmData = result.candidates[0].content.parts[0].inlineData.data;
                const sampleRate = parseInt(result.candidates[0].content.parts[0].inlineData.mimeType.match(/rate=(\d+)/)?.[1] || 24000);
                const wavBlob = pcmToWav(pcmData, sampleRate);
                const audioUrl = URL.createObjectURL(wavBlob);
                const audio = new Audio(audioUrl);
                audioCache.set(text, audio);
                return audio;
            } catch (error) { console.error("Erro no TTS:", error); return null; }
        }

        function pcmToWav(base64Pcm, sampleRate) {
            const binaryString = atob(base64Pcm);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) bytes[i] = binaryString.charCodeAt(i);
            const buffer = new ArrayBuffer(44 + bytes.length);
            const view = new DataView(buffer);
            const writeString = (offset, string) => { for (let i = 0; i < string.length; i++) view.setUint8(offset + i, string.charCodeAt(i)); };
            writeString(0, 'RIFF');
            view.setUint32(4, 36 + bytes.length, true);
            writeString(8, 'WAVE');
            writeString(12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true); 
            view.setUint16(22, 1, true); 
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true);
            view.setUint16(32, 2, true);
            view.setUint16(34, 16, true);
            writeString(36, 'data');
            view.setUint32(40, bytes.length, true);
            for (let i = 0; i < bytes.length; i++) view.setUint8(44 + i, bytes[i]);
            return new Blob([buffer], { type: 'audio/wav' });
        }

        // --- GLOBAL FUNCTIONS ---
        window.checkPassword = function(e) {
            e.preventDefault();
            const input = document.getElementById('password-input').value.toLowerCase();
            if (input === 'ariana') {
                document.getElementById('login-gate').style.display = 'none';
                document.getElementById('main-wrapper').classList.remove('hidden');
                renderDashboard();
            } else { 
                document.getElementById('login-feedback').classList.remove('hidden'); 
            }
        };

        window.showDashboard = function() {
            document.getElementById('dashboard-view').classList.remove('hidden');
            document.getElementById('generator-view').classList.add('hidden');
            document.getElementById('study-view').classList.add('hidden');
        };

        window.loadNextQuestion = function() {
            const q = questionsPool[Math.floor(Math.random() * questionsPool.length)];
            currentQuestion = q;
            document.getElementById('main-question').textContent = q.q;
            document.getElementById('rationale-display').classList.add('hidden');
            document.getElementById('feedback-alert').classList.add('hidden');
            answerSubmitted = false;
            const container = document.getElementById('options-container');
            container.innerHTML = q.options.map((opt, i) => `
                <button class="option-button" onclick="submitAnswer(${i})">
                    <span class="option-prefix">${String.fromCharCode(65+i)}</span>
                    ${opt.text}
                </button>
            `).join('');
        };

        window.submitAnswer = function(idx) {
            if (answerSubmitted) return;
            answerSubmitted = true;
            const isCorrect = currentQuestion.options[idx].isCorrect;
            const alert = document.getElementById('feedback-alert');
            alert.textContent = isCorrect ? "Muito bem!" : "Tente entender o porqu√™:";
            alert.className = `p-3 mb-6 rounded-lg text-white font-semibold text-center ${isCorrect ? 'bg-green-500' : 'bg-red-500'}`;
            alert.classList.remove('hidden');
            document.getElementById('rationale-content').textContent = currentQuestion.rationale;
            document.getElementById('rationale-display').classList.remove('hidden');
            document.querySelectorAll('.option-button').forEach((btn, i) => {
                btn.disabled = true;
                if (currentQuestion.options[i].isCorrect) btn.classList.add('border-green-500', 'bg-green-50');
                else if (i === idx) btn.classList.add('border-red-500', 'bg-red-50');
            });
        };

        window.changeFlashcard = function(dir) {
            currentFlashcardIdx += dir;
            renderFlashcards();
        };

        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) { randomIndex = Math.floor(Math.random() * currentIndex); currentIndex--; [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]]; }
            return array;
        }

        function renderDashboard() {
            const container = document.getElementById('level-cards-container');
            container.innerHTML = aulaNames.map(aula => {
                let studyButtonLabel = 'REVIS√ÉO';
                if (aula.specialMode === 'flashcards') studyButtonLabel = 'FLASHCARDS';
                if (aula.specialMode === 'listening') studyButtonLabel = 'LISTENING';

                let extraButton = '';
                if (aula.thirdBtn === 'flashcards') {
                    extraButton = `<button class="secondary-button flex-1 text-xs" onclick="openFlashcards(${aula.id})">FLASHCARDS</button>`;
                }

                return `
                <div class="level-card relative ${!aula.hasHomework ? 'locked' : ''}">
                    ${!aula.hasHomework ? '<div class="absolute top-4 right-4 text-stone-400"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></div>' : ''}
                    <div>
                        <img src="https://res.cloudinary.com/dqfi22uz0/image/upload/v1760657894/SLAP_ICON_PRETO_2_2_tv8bmp.png" alt="Icon" class="absolute top-4 right-4 w-8 h-8 opacity-10">
                        <span class="module-tag">STARTER 1 - HW AULA ${String(aula.id).padStart(2, '0')}</span>
                        <h3 class="text-xl font-bold text-stone-800 mb-2 mt-2">${aula.name}</h3>
                        <p class="text-stone-500 text-sm mb-6">${aula.hasHomework ? 'Pratique as estruturas aprendidas em aula.' : 'Esta aula n√£o possui homework dispon√≠vel.'}</p>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button class="secondary-button flex-1 text-xs" ${!aula.hasHomework ? 'disabled' : `onclick="openStudy(${aula.id})"`}>${studyButtonLabel}</button>
                        ${extraButton}
                        <button class="action-button flex-1 text-xs" ${!aula.hasHomework ? 'disabled' : `onclick="openPractice(${aula.id})"`}>PRATICAR</button>
                    </div>
                </div>`
            }).join('');
        }

        window.openPractice = function(id) {
            const aula = aulaNames.find(a => a.id === id);
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('generator-view').classList.remove('hidden');
            document.getElementById('current-hw-display').textContent = `Homework Aula ${id}: ${aula.name}`;
            questionsPool = mockQuestions[id] || [{ q: `Exerc√≠cio de revis√£o: ${aula.name}`, options: [{text: "Op√ß√£o A", isCorrect: true}, {text: "Op√ß√£o B", isCorrect: false}], rationale: "Pratique o conte√∫do deste m√≥dulo." }];
            loadNextQuestion();
        };

        window.openStudy = function(id) {
            const aula = aulaNames.find(a => a.id === id);
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('study-view').classList.remove('hidden');
            document.getElementById('preloading-status').textContent = "";
            const titleArea = document.getElementById('study-title');
            const instrArea = document.getElementById('study-instruction');
            const contentArea = document.getElementById('study-content-area');
            
            if (aula.specialMode === 'flashcards') {
                titleArea.textContent = `Flashcards: ${aula.name}`;
                instrArea.textContent = "Toque na carta para ver a tradu√ß√£o e use as setas para navegar.";
                currentFlashcardIdx = 0; currentShuffledCards = shuffle([...flashcardsData[id]]); renderFlashcards();
            } else if (aula.specialMode === 'listening') {
                titleArea.textContent = `Listening Practice: ${aula.name}`;
                instrArea.textContent = "Toque no item para ouvir a pron√∫ncia correta.";
                renderListeningBoard(aula.items);
            } else {
                titleArea.textContent = `Revis√£o Aula ${id}: ${aula.name}`;
                instrArea.textContent = "Revise o conte√∫do desta aula antes de praticar.";
                contentArea.innerHTML = `<p class="text-slate-400 italic text-sm">O √°udio da aula ${id} est√° sendo processado.</p>`;
            }
        };

        window.openFlashcards = function(id) {
            const aula = aulaNames.find(a => a.id === id);
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('study-view').classList.remove('hidden');
            document.getElementById('preloading-status').textContent = "";
            const titleArea = document.getElementById('study-title');
            const instrArea = document.getElementById('study-instruction');
            
            titleArea.textContent = `Flashcards: Holidays`;
            instrArea.textContent = "Toque na carta para ver a tradu√ß√£o do Portugu√™s para o Ingl√™s.";
            currentFlashcardIdx = 0; 
            currentShuffledCards = shuffle([...flashcardsData[id]]); 
            renderFlashcards();
        }

        async function renderListeningBoard(items) {
            const contentArea = document.getElementById('study-content-area');
            const statusArea = document.getElementById('preloading-status');
            contentArea.innerHTML = `<div class="listening-grid"></div>`;
            const grid = contentArea.querySelector('.listening-grid');
            items.forEach((item, index) => {
                const btn = document.createElement('button');
                btn.id = `btn-listen-${index}`;
                btn.className = 'number-btn';
                btn.innerHTML = `<span>${item.n}</span><span class="number-label">${item.p || item.w}</span>`;
                btn.onclick = async () => {
                    if (btn.classList.contains('playing')) return;
                    if (audioCache.has(item.w)) {
                        const audio = audioCache.get(item.w); btn.classList.add('playing');
                        audio.currentTime = 0; audio.play(); audio.onended = () => btn.classList.remove('playing');
                    } else {
                        btn.classList.add('loading', 'playing'); const audio = await fetchTTSAudio(item.w);
                        btn.classList.remove('loading'); if (audio) { audio.play(); audio.onended = () => btn.classList.remove('playing'); } else { btn.classList.remove('playing'); }
                    }
                };
                grid.appendChild(btn);
            });
            let loadedCount = 0; statusArea.textContent = `Carregando √°udios: 0/${items.length}...`;
            for (const item of items) {
                if (!audioCache.has(item.w)) await fetchTTSAudio(item.w);
                loadedCount++; statusArea.textContent = `Carregando √°udios: ${loadedCount}/${items.length}...`;
                const idx = items.indexOf(item); const btn = document.getElementById(`btn-listen-${idx}`);
                if (btn && !btn.querySelector('.ready-icon')) { btn.insertAdjacentHTML('beforeend', '<div class="ready-icon"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg></div>'); }
            }
            statusArea.textContent = "‚úì Carregado!"; setTimeout(() => statusArea.textContent = "", 3000);
        }

        function renderFlashcards() {
            const cards = currentShuffledCards;
            const contentArea = document.getElementById('study-content-area');
            const updateCard = () => {
                const card = cards[currentFlashcardIdx];
                const isEmoji = /\p{Emoji}/u.test(card.front);
                const frontSize = isEmoji ? 'text-7xl' : 'text-3xl';
                contentArea.innerHTML = `
                    <div class="flashcard-container" onclick="this.querySelector('.flashcard').classList.toggle('flipped')">
                        <div class="flashcard">
                            <div class="flashcard-front">
                                <span class="text-xs uppercase font-bold opacity-60 mb-4 tracking-widest">Question</span>
                                <span class="${frontSize} font-bold">${card.front}</span>
                                <span class="mt-8 text-sm opacity-50">Toque para ver a tradu√ß√£o</span>
                            </div>
                            <div class="flashcard-back">
                                <span class="text-xs uppercase font-bold opacity-60 mb-4 tracking-widest">Answer</span>
                                <span class="text-2xl font-bold">${card.back}</span>
                                <span class="mt-8 text-sm opacity-50">Toque para voltar</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center justify-between max-w-xs mx-auto mt-6">
                        <button class="secondary-button p-3 rounded-full" onclick="changeFlashcard(-1)" ${currentFlashcardIdx === 0 ? 'disabled' : ''}>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                        </button>
                        <span class="font-bold text-stone-500">${currentFlashcardIdx + 1} / ${cards.length}</span>
                        <button class="secondary-button p-3 rounded-full" onclick="changeFlashcard(1)" ${currentFlashcardIdx === cards.length - 1 ? 'disabled' : ''}>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                        </button>
                    </div>`;
            };
            updateCard();
        }

        window.onload = function() {
            document.getElementById('main-wrapper').classList.add('hidden');
            document.getElementById('login-gate').style.display = 'flex';
        };
    </script>
</body>
</html>
