<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SLAP | Maturity Test Online</title>
    <!-- Favicon da SLAP -->
    <link rel="icon" type="image/png" href="https://res.cloudinary.com/dqfi22uz0/image/upload/v1749543469/SLAP_FAVICON_AMARELO_coilvj.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: DM Sans -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* Aplicando a fonte padrão e cores do Hub Pedagógico */
        html, body {
            height: 100%;
        }
        body {
            font-family: 'DM Sans', sans-serif;
            display: flex;
            flex-direction: column;
        }
        #app-container {
            flex: 1 0 auto;
        }
        main {
            flex-shrink: 0;
        }
        
        /* Estilos específicos para Ecrãs de Apresentação Escuros */
        .dark-splash {
            background-color: #1c1917; /* stone-900 */
            color: #f5f5f4; /* stone-100 */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh; 
            text-align: center;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            max-width: 42rem;
        }
        
        /* Estilos do Botão de Ação */
        .action-button {
             background-color: #F1D24B; 
             color: #44403c; /* stone-800 */
             border: none; 
             padding: 0.75rem 1.5rem; 
             border-radius: 9999px; 
             font-weight: 700; 
             cursor: pointer; 
             transition: background-color 0.2s, transform 0.2s;
             display: inline-flex;
             align-items: center;
             justify-content: center; /* Centraliza o conteúdo (texto/ícones) */
             gap: 0.5rem;
             text-decoration: none;
             box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .action-button:hover:not(:disabled) {
            background-color: #eab308; /* Darker yellow */
            transform: translateY(-2px);
        }
        .action-button:disabled {
            background-color: #a8a29e; /* stone-400 */
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .progress-bar-background {
            background-color: #e7e5e4; /* stone-200 */
            border-radius: 9999px;
            height: 1rem;
            width: 100%;
            overflow: hidden;
        }
        .progress-bar-foreground {
            background-color: #F1D24B;
            height: 100%;
            border-radius: 9999px;
            transition: width 0.5s ease-in-out;
        }
        
        /* Estilos para os botões de pontuação (Maturidade Assessment) */
        .score-button {
            padding: 0.5rem 0.75rem; 
            border-radius: 0.5rem;
            font-weight: 700;
            transition: all 0.2s;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-width: 90px;
        }
        .score-button .score-icon {
            width: 24px;
            height: 24px;
            margin-bottom: 4px;
        }

        .score-button.selected {
            border-color: #EAB308;
            color: #1c1917;
        }

        /* Mapeamento de cores para os 3 critérios: ✅ (3) , ⚠️ (2), ❌ (1) */
        .score-button.score-3 { background-color: #a7f3d0; color: #065F46; } /* Green (Recomendado) */
        .score-button.score-2 { background-color: #fde68a; color: #92400E; } /* Yellow (Supervisão) */
        .score-button.score-1 { background-color: #fca5a5; color: #991B1B; } /* Red (Não Recomendado) */

        .score-button.score-3.selected { border-color: #10b981; }
        .score-button.score-2.selected { border-color: #eab308; }
        .score-button.score-1.selected { border-color: #ef4444; }


        .score-button:hover:not(.selected) {
            opacity: 0.8;
        }
        /* Estilo para a caixa de critérios */
        .criteria-box {
            background-color: #f5f5f4; /* stone-100 */
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid #e7e5e4;
        }
        /* Botão de Parar Teste */
        .stop-test-button {
            background-color: #ef4444; /* red-500 */
            color: white; 
            box-shadow: 0 4px 6px -1px rgba(239, 68, 68, 0.4); 
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
        }
        .stop-test-button:hover {
            background-color: #dc2626; /* red-600 */
            transform: translateY(-2px);
        }
        .stop-test-button:disabled {
            background-color: #fca5a5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* Estilo específico para o campo de senha (solicitado pelo usuário) */
        #password-input.login-input {
            background-color: #ffffff !important; /* Fundo branco */
            color: #1c1917 !important; /* Texto escuro */
            border: 1px solid #a8a29e; /* Borda levemente cinza */
            box-shadow: inset 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        #password-input.login-input::placeholder {
            color: #78716c; /* Placeholder escuro */
        }
        
        /* Novo estilo para o ícone de aviso no resultado */
        .warning-icon {
            color: #d97706; /* amber-600 */
            width: 24px;
            height: 24px;
            margin-right: 8px;
            vertical-align: middle;
            display: inline-block;
        }
    </style>
</head>
<body class="bg-stone-200 text-stone-800">

    <main id="app-container" class="flex items-center justify-center p-4 sm:p-6 min-h-screen">
        <div class="w-full max-w-3xl mx-auto">
        
            <!-- SPLASH SCREEN 1: PASSWORD LOGIN -->
            <div id="splash-1-view" class="dark-splash mx-auto bg-stone-900 shadow-none">
                <img src="https://res.cloudinary.com/dqfi22uz0/image/upload/v1749349751/DBB440C2-684E-4DCF-9CD3-B2DDC18F1E53_3_vgocga.jpg" alt="SLAP Logo" class="w-32 h-auto mx-auto mb-6 sm:mb-8 rounded-lg">
                <h1 class="text-4xl sm:text-5xl font-bold text-[#F1D24B] mb-6 sm:mb-8">
                    Maturity Test Online
                </h1>
                <p class="text-lg text-stone-400 mb-4">Acesso Exclusivo para Professores.</p>
                
                <div class="w-full max-w-sm">
                    <!-- Campo de senha com fundo branco -->
                    <input type="password" id="password-input" 
                           class="w-full p-3 rounded-lg login-input placeholder-stone-500 border border-stone-700 focus:outline-none focus:ring-2 focus:ring-[#F1D24B] mb-4" 
                           placeholder="Enter Secret Password" required>
                    <button class="action-button bg-[#F1D24B] text-stone-900 text-xl px-12 py-4 w-full" onclick="checkPassword()">
                        Start Test
                    </button>
                    <p id="password-error" class="text-red-400 mt-3 hidden">Incorrect Password. Try again.</p>
                </div>
            </div>

            <!-- SPLASH SCREEN 2: CONFIRMATION -->
            <div id="splash-2-view" class="dark-splash mx-auto bg-stone-900 hidden shadow-none">
                 <img src="https://res.cloudinary.com/dqfi22uz0/image/upload/v1759294959/SLAP_TIPO_BRANCO_uvynbr.png" alt="SLAP Logo Branco" class="w-32 h-auto mx-auto mb-4 sm:mb-6 opacity-80">
                <h2 class="text-3xl sm:text-4xl font-bold text-white mb-6 sm:mb-8 max-w-lg">
                    Teacher, a criança está pronta para começar a conversa?
                </h2>
                <button class="action-button bg-stone-100 text-stone-900 text-lg px-10 py-3" onclick="startQuiz()">
                    Iniciar Conversa
                </button>
            </div>

            <!-- Quiz View (AVALIAÇÃO DE MATURIDADE) -->
            <div id="quiz-view" class="hidden">
                 <div class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl border border-stone-300 w-full">
                    <!-- Quiz content will be injected here by JS -->
                 </div>
            </div>
            
            <!-- Ficha de Avaliação (REMOVIDA) -->


            <!-- RESULTADO FINAL -->
            <div id="result-view" class="hidden">
                <div class="bg-white p-8 rounded-xl shadow-2xl border border-stone-300 text-center">
                    <img src="https://res.cloudinary.com/dqfi22uz0/image/upload/v1759294967/SLAP_TIPO_PRETO_2_kismg9.png" alt="SLAP Logo Preto" class="w-32 h-auto mx-auto mb-6">
                    <h2 class="text-3xl font-bold mb-4 text-stone-800">Final Result / Recomendação</h2>
                    <p id="result-time" class="text-xl text-stone-600 mb-4 font-semibold"></p>
                    
                    <div class="my-6 p-6 bg-[#F1D24B] rounded-lg">
                        <p class="text-2xl font-bold text-stone-900 mb-2">Recomendação Final</p>
                        <p id="result-recommendation" class="text-4xl font-extrabold text-stone-900 mb-2"></p>
                    </div>
                    
                    <p id="result-message" class="text-stone-700 max-w-md mx-auto"></p>

                    <div class="flex flex-col sm:flex-row justify-center gap-4 mt-8">
                         <button onclick="restartQuiz()" class="action-button text-lg px-8 py-3 bg-stone-800 text-white hover:bg-stone-900">
                             New Test
                         </button>
                    </div>

                </div>
            </div>
        </div>
    </main>
    
    <script>
        // --- CONSTANTES AND DOM ELEMENTS ---
        const CORRECT_PASSWORD = 'Slapkids1*';
        const splash1View = document.getElementById('splash-1-view');
        const splash2View = document.getElementById('splash-2-view');
        const quizView = document.getElementById('quiz-view');
        const resultView = document.getElementById('result-view');
        
        let totalScore = 0; // Total score for the conversation (1 to 3)
        let currentQuestionIndex = 0;
        let studentScores = []; // Stores score for each question
        let timerInterval = null; 
        let startTime = 0; 
        let totalTimeElapsed = 0; 
        
        // Key for the conversational score
        const overallScoreKey = 'overallScore'; 
        
        // --- QUIZ DATA (MATURITY PROMPTS AND CRITERIA) ---
        
        // Score mapping for Conversational Steps: 3 (Excellent) -> 1 (Poor)
        const scoreValues = [
            { 
                value: 1, 
                label: 'Não Interagiu/Foco', 
                icon: '<svg class="score-icon text-red-700" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>', 
                desc: '1 pt - Não demonstrou maturidade/autonomia ou teve foco muito baixo.' 
            }, 
            { 
                value: 2, 
                label: 'Supervisão', 
                icon: '<svg class="score-icon text-yellow-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>',
                desc: '2 pts - Interagiu, mas demonstra dependência ou dispersão. Supervisão inicial necessária.' 
            },
            { 
                value: 3, 
                label: 'Recomendado', 
                icon: '<svg class="score-icon text-green-700" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>',
                desc: '3 pts - Interagiu bem, mostrou foco e autonomia. Recomendado para aulas online.'
            }  
        ];
        
        // Novo conjunto de prompts mais detalhado e com inglês
        const maturityPrompts = [
            // 1. Quebra-gelo & Comunicação Básica (PT/EN)
            { step: 'Quebra-gelo (PT)', prompt: "Oi! Tudo bem? Qual o seu nome?" },
            { step: 'Basic English', prompt: "Hello! What's your name? (Observar reação ao inglês)" },
            { step: 'Personal Info (PT)', prompt: "Quantos anos você tem? Você estuda em qual série?" },
            
            // 2. Foco e Seguimento de Instruções (Atenção)
            { step: 'Attention & Focus 1 (PT)', prompt: "Pega aí um objeto **AMARELO** e me mostra! (Observar tempo de reação e se precisa de repetição)" },
            { step: 'Attention & Focus 2 (PT)', prompt: "Agora, faz uma **carinha feliz**! Bate palmas duas vezes!" },
            { step: 'Basic English (Color)', prompt: "Show me something **BLUE**! (Observar se entende a cor e a instrução)" },
            
            // 3. Autonomia Tecnológica
            { step: 'Tech Autonomy (Hardware)', prompt: "Quem liga o computador/tablet pra você? Você conseguiria ligar o microfone e a câmera sozinho?" },
            { step: 'Tech Autonomy (Software)', prompt: "Se eu te mandar um link para abrir um joguinho, você consegue **clicar e navegar sozinho(a)**?" },
            { step: 'Family Support', prompt: "Você vai ter alguém por perto durante a aula? Se sim, quem será essa pessoa?" },
            
            // 4. Comportamento e Emoção
            { step: 'Behavior (Rules)', prompt: "Se o professor pedir pra **esperar um pouquinho** ou pedir silêncio, você consegue esperar a sua vez?" },
            { step: 'Behavior (Frustration)', prompt: "O que você faz quando **não entende alguma coisa** na aula? Você sabe pedir ajuda?" },
            { step: 'Opinion on Classes', prompt: "Você acha legal a ideia de estudar pelo computador com **outros amigos**?" }
        ];

        // O total de perguntas agora é 12. O cálculo da média se ajustará automaticamente.


        // --- TIMER FUNCTIONS ---
        
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            startTime = Date.now();
            totalTimeElapsed = 0; 
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                totalTimeElapsed = Date.now() - startTime; 
            }
        }

        function formatTime(ms) {
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            
            const pad = (num) => num.toString().padStart(2, '0');
            return `${pad(minutes)}:${pad(remainingSeconds)}`;
        }

        function updateTimerDisplay() {
            const msElapsed = Date.now() - startTime;
            const timerElement = document.getElementById('timer-display');
            if (timerElement) {
                timerElement.textContent = formatTime(msElapsed);
            }
        }

        // --- NAVIGATION AND AUTHENTICATION FUNCTIONS ---

        function hideAllViews() {
            splash1View.classList.add('hidden');
            splash2View.classList.add('hidden');
            quizView.classList.add('hidden');
            resultView.classList.add('hidden');
        }

        function startSplash1() {
            hideAllViews();
            splash1View.classList.remove('hidden');
        }
        
        window.checkPassword = function() {
            const input = document.getElementById('password-input');
            const errorMsg = document.getElementById('password-error');

            if (input.value === CORRECT_PASSWORD) {
                errorMsg.classList.add('hidden');
                goToSplash2();
            } else {
                errorMsg.classList.remove('hidden');
                input.value = ''; 
                input.focus();
            }
        }

        window.goToSplash2 = function() {
            hideAllViews();
            splash2View.classList.remove('hidden');
        }
        
        window.goToResultView = function() {
            hideAllViews();
            resultView.classList.remove('hidden');
        }
        
        // --- QUIZ FUNCTIONS (Conversa) ---

        function startQuiz() {
            hideAllViews();
            quizView.classList.remove('hidden');
            
            currentQuestionIndex = 0;
            totalScore = 0;
            // Initialize score data
            studentScores = maturityPrompts.map(q => ({
                ...q,
                scores: { [overallScoreKey]: null }
            }));
            
            startTimer(); 

            displayQuestion();
        }

        function displayQuestion() {
            const quizContainer = quizView.querySelector('.bg-white');
            const totalQuestions = studentScores.length;
            
            if (currentQuestionIndex >= totalQuestions) {
                showResult();
                return;
            }

            const questionData = studentScores[currentQuestionIndex];
            // O progresso deve ser baseado no índice atual + 1
            const progressPercentage = ((currentQuestionIndex) / totalQuestions) * 100;
            
            const quizLogoUrl = "https://res.cloudinary.com/dqfi22uz0/image/upload/v1759294967/SLAP_TIPO_PRETO_2_kismg9.png"; 
            
            const currentScore = questionData.scores[overallScoreKey];
            
            // Render score buttons (1, 2, 3)
            const scoreButtons = scoreValues.map(score => {
                const isSelected = currentScore === score.value;
                // Classes score-1, score-2, score-3
                const buttonClasses = `score-button score-${score.value} ${isSelected ? 'selected' : ''}`; 
                return `<button class="${buttonClasses}" onclick="setOverallScore(${score.value}, this)">
                            ${score.icon}
                            <span class="text-xs font-medium">${score.label}</span>
                        </button>`;
            }).join('');

            const criteriaHtml = `
                <div class="mb-4">
                    <p class="font-bold text-stone-700 mb-2">Score for this Step</p>
                    <div id="overall-criteria" class="flex flex-wrap gap-2 justify-center sm:justify-start">
                        ${scoreButtons}
                    </div>
                </div>
            `;
            
            
            // Check if overall score was given to enable the next button
            const scored = questionData.scores[overallScoreKey] !== null;
            const nextButtonDisabled = scored ? '' : 'disabled';
            const buttonText = (currentQuestionIndex < totalQuestions - 1) ? "Next Step" : "End Test";
            const nextFunction = (currentQuestionIndex < totalQuestions - 1) ? "nextQuestion()" : "showResult()";
            
            const stopTestButton = `
                <button class="stop-test-button text-lg px-8 py-3" onclick="showResult(true)">
                    End Test and See Summary
                </button>
            `;

            quizContainer.innerHTML = `
                <div id="quiz-content">
                     <div class="flex justify-between items-center mb-6">
                        <img src="${quizLogoUrl}" alt="SLAP Logo Preto" class="w-24 h-auto">
                        <div class="text-3xl font-bold text-stone-800 p-2 border-2 border-stone-800 rounded-lg">
                            <span id="timer-display">00:00</span>
                        </div>
                     </div>
                     <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
                        <div class="w-full sm:w-auto mb-3 sm:mb-0">
                            <p class="text-sm font-semibold text-stone-500 mb-1">Step ${currentQuestionIndex + 1} of ${totalQuestions}</p>
                            <div class="progress-bar-background">
                                <div class="progress-bar-foreground" style="width: ${progressPercentage}%;"></div>
                            </div>
                        </div>
                        <div class="text-center w-full sm:w-auto ml-0 sm:ml-4 p-2 bg-yellow-50 rounded-lg"> 
                            <p class="text-sm font-semibold text-stone-500">Focus of the Step</p>
                            <span class="text-xl font-bold text-stone-900">${questionData.step}</span>
                        </div>
                     </div>
                    
                    <!-- Prompt for the Teacher (text in Portuguese) -->
                    <div class="p-6 bg-indigo-50 rounded-xl mb-6">
                        <p class="text-sm font-semibold text-indigo-600 mb-2">QUESTIONS / SUGGESTED ACTIVITIES:</p>
                        <h3 class="text-xl sm:text-2xl font-bold text-indigo-800">${questionData.prompt}</h3>
                    </div>
                    
                    <!-- Critérios de observação para o professor (agora mais completos, sem emoji e usando <strong>) -->
                    <div class="p-4 bg-stone-100 rounded-lg border border-stone-300 mb-6">
                        <p class="text-sm font-semibold text-stone-600">Critérios de Observação:</p>
                        <ul class="text-sm text-stone-700 list-disc list-inside mt-1 space-y-2">
                            ${getObservationForStep(questionData.step)}
                        </ul>
                    </div>

                    <!-- Scoring Section -->
                    <div class="criteria-box">
                        <h4 class="text-xl font-bold text-stone-800 mb-4 border-b pb-2">Avaliação da Resposta (Geral)</h4>
                        ${criteriaHtml}
                    </div>
                    
                    <div id="quiz-nav" class="mt-8 flex flex-col sm:flex-row items-center justify-between gap-4">
                        ${stopTestButton}
                        <button class="action-button text-lg px-8 py-3" onclick="${nextFunction}" ${nextButtonDisabled}>
                            ${buttonText} 
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                        </button>
                    </div>
                </div>`;
            
            // Update progress bar after HTML injection
            setTimeout(() => {
                quizContainer.querySelector('.progress-bar-foreground').style.width = `${((currentQuestionIndex + 1) / totalQuestions) * 100}%`;
            }, 100);
            
            updateTimerDisplay();
        }

        // Função para pegar as observações mais completas e usando <strong>
        function getObservationForStep(step) {
            switch(step) {
                case 'Quebra-gelo (PT)':
                    return `
                        <li><strong>Comunicação:</strong> Observar se o aluno responde de forma natural, clara e se demonstra à vontade.</li>
                        <li><strong>Disposição:</strong> Avaliar se demonstra simpatia ou empolgação inicial para o teste.</li>
                    `;
                case 'Basic English':
                    return `
                        <li><strong>Reação ao Idioma:</strong> Observar a expressão do aluno ao ouvir inglês. Ele reage, tenta responder ou se fecha?</li>
                        <li><strong>Entendimento Mínimo:</strong> Se consegue identificar o pedido básico ('name').</li>
                    `;
                case 'Personal Info (PT)':
                    return `
                        <li><strong>Entendimento:</strong> Analisar se compreende as perguntas básicas sobre informações pessoais e série.</li>
                        <li><strong>Foco:</strong> Se consegue manter a atenção no professor ao responder.</li>
                    `;
                case 'Attention & Focus 1 (PT)':
                    return `
                        <li><strong>Seguimento de Instruções:</strong> Verificar a <strong>velocidade</strong> e <strong>precisão</strong> ao cumprir o comando (pegar objeto).</li>
                        <li><strong>Necessidade de Repetição:</strong> Se precisa de repetição ou de dicas para cumprir a tarefa.</li>
                    `;
                case 'Attention & Focus 2 (PT)':
                    return `
                        <li><strong>Foco e Mudança de Tarefa:</strong> Observar a transição rápida entre comandos diferentes (expressão facial e movimento).</li>
                        <li><strong>Engajamento:</strong> Se ri, se diverte, mas consegue retornar ao foco do comando.</li>
                    `;
                case 'Basic English (Color)':
                    return `
                        <li><strong>Compreensão de Comando:</strong> Se entende a instrução e a cor solicitada em inglês (comando não-verbal).</li>
                        <li><strong>Reação:</strong> Se há hesitação ou se a resposta é imediata.</li>
                    `;
                case 'Tech Autonomy (Hardware)':
                    return `
                        <li><strong>Independência:</strong> Avaliar se o aluno fala com convicção que pode ligar o próprio dispositivo e operar microfone/câmera.</li>
                        <li><strong>Dependência:</strong> Se depende totalmente de um adulto para as funções básicas de áudio e vídeo.</li>
                    `;
                case 'Tech Autonomy (Software)':
                    return `
                        <li><strong>Habilidade de Navegação:</strong> Avaliar se ele consegue seguir a instrução de <strong>clicar em um link</strong> ou em uma janela pop-up.</li>
                        <li><strong>Consciência do Ambiente Online:</strong> Se demonstra familiaridade com o ambiente de navegação.</li>
                    `;
                case 'Family Support':
                    return `
                        <li><strong>Suporte Garantido:</strong> Confirmar quem será o responsável por perto durante a aula online.</li>
                        <li><strong>Consistência:</strong> Se o suporte é consistente ou se o aluno fica sozinho em boa parte do tempo.</li>
                    `;
                case 'Behavior (Rules)':
                    return `
                        <li><strong>Paciência:</strong> Observar a reação do aluno à ideia de ter que <strong>esperar a sua vez</strong> ou o pedido de silêncio (pode ser uma reação verbal ou expressão facial).</li>
                        <li><strong>Respeito:</strong> Se entende a dinâmica de revezamento de fala em grupo.</li>
                    `;
                case 'Behavior (Frustration)':
                    return `
                        <li><strong>Resiliência:</strong> Avaliar a reação quando <strong>não entende algo</strong> ou comete um erro.</li>
                        <li><strong>Busca por Ajuda:</strong> Se sabe pedir ajuda ativamente (demonstrando iniciativa) ou se fecha/desiste.</li>
                    `;
                case 'Opinion on Classes':
                    return `
                        <li><strong>Motivação:</strong> Avaliar a <strong>empolgação</strong> e a percepção geral sobre o formato online com outros alunos.</li>
                        <li><strong>Expectativa:</strong> Se tem uma expectativa realista sobre o que é uma aula online.</li>
                    `;
                case 'Encerramento':
                    return `
                        <li><strong>Fechamento:</strong> Avaliar a impressão final e o desejo de voltar.</li>
                        <li><strong>Consciência Tecnológica:</strong> Se o aluno tem consciência de como <strong>encerrar a reunião</strong> (simulando o fim da aula e desligando o dispositivo).</li>
                    `;
                default:
                    return '<li>Observação geral do comportamento e interação do aluno.</li>';
            }
        }

        window.setOverallScore = function(scoreValue, clickedButton) {
            const questionData = studentScores[currentQuestionIndex];
            
            questionData.scores[overallScoreKey] = scoreValue;
            
            const criteriaDiv = document.getElementById('overall-criteria');
            criteriaDiv.querySelectorAll('.score-button').forEach(button => {
                button.classList.remove('selected');
            });
            clickedButton.classList.add('selected');
            
            const nextButton = document.querySelector('#quiz-nav .action-button:not(.stop-test-button)'); 
            if (nextButton) {
                nextButton.disabled = false;
            }
        }

        window.nextQuestion = function() {
            currentQuestionIndex++;
            displayQuestion();
        }
        
        // --- RESULT AND LEVEL CALCULATION FUNCTIONS (Conversa) ---

        function calculateConversationRecommendation(quickFinish = false) {
            totalScore = 0;
            
            let scoredQuestions = studentScores.slice(0, currentQuestionIndex);
            
            if (!quickFinish && currentQuestionIndex < studentScores.length) {
                const lastQuestion = studentScores[currentQuestionIndex];
                if (lastQuestion.scores[overallScoreKey] !== null) {
                    scoredQuestions = studentScores.slice(0, currentQuestionIndex + 1);
                }
            }
            
            const questionsAnswered = scoredQuestions.length;
            
            scoredQuestions.forEach(q => {
                const questionScore = q.scores[overallScoreKey] || 0;
                totalScore += questionScore; 
            });

            const maxScoreForAnswered = questionsAnswered * 3; // Max score per step is 3
            const totalPossibleQuestions = maturityPrompts.length; // 12 steps
            
            let recommendation = 'Aguardando Avaliação';
            let message = 'Por favor, complete a conversa ou use o botão "Encerrar Teste".';
            
            if (questionsAnswered > 0) {
                 const averageScore = totalScore / questionsAnswered;
                 
                 // SVG para o ícone de aviso: Triângulo
                 const warningIcon = `<svg class="warning-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L1 21h22L12 2zm0 14l-2-4h4l-2 4z"/></svg>`;

                 // Map Average Score (1 to 3)
                 if (averageScore < 1.7) { 
                    recommendation = 'Não Recomendado neste momento';
                    message = 'O aluno teve dificuldade em manter o foco e seguir as instruções da conversa (média de pontuação abaixo de 1.7/3). É indicado <strong>aguardar amadurecimento</strong> ou tentar o formato presencial.'; 
                 }
                 else if (averageScore < 2.3) { 
                    recommendation = 'Recomendado com supervisão inicial';
                    message = 'O aluno interagiu, mas demonstrou momentos de dispersão ou dependência (média entre 1.7 e 2.3/3). A <strong>supervisão de um adulto é crucial</strong> nas primeiras aulas para garantir o acompanhamento.'; 
                 }
                 else { 
                    recommendation = 'Recomendado para aulas online';
                    message = 'O aluno demonstrou excelente maturidade, foco e autonomia na conversa (média acima de 2.3/3). A <strong>adaptação ao formato online deve ser tranquila</strong> e sem necessidade de supervisão intensa.'; 
                 }

                 if (quickFinish && questionsAnswered < totalPossibleQuestions) {
                    // Substitui o emoji ⚠️ pelo SVG no início da mensagem
                    message = `${warningIcon} Teste interrompido após ${questionsAnswered} de ${totalPossibleQuestions} etapas. A recomendação foi baseada nas etapas concluídas. ${message}`;
                 }
            }


            return { 
                recommendation, 
                message, 
                answeredCount: questionsAnswered,
                totalPossible: totalPossibleQuestions,
                score: totalScore,
                maxScore: maxScoreForAnswered
            };
        }

        window.showResult = function(quickFinish = false) {
            stopTimer(); // Stop the timer
            
            // Ensures the last question score is saved if it was scored before finishing
            if (!quickFinish && currentQuestionIndex < studentScores.length && studentScores[currentQuestionIndex].scores[overallScoreKey] === null) {
                studentScores[currentQuestionIndex].scores[overallScoreKey] = 1; // Default to lowest score if skipped
            }

            const resultData = calculateConversationRecommendation(quickFinish);
            
            hideAllViews();
            resultView.classList.remove('hidden');

            const timeDisplay = formatTime(totalTimeElapsed);
            document.getElementById('result-time').textContent = `Duração Total da Conversa: ${timeDisplay}`;
            
            document.getElementById('result-recommendation').textContent = resultData.recommendation;
            document.getElementById('result-message').innerHTML = resultData.message; // Usando innerHTML para permitir o bold e o SVG
        }

        window.restartQuiz = function() {
            startSplash1();
            totalScore = 0;
            currentQuestionIndex = 0;
            studentScores = [];
            stopTimer();
            totalTimeElapsed = 0;
            startTime = 0;
        }

        // --- START FLOW ---
        window.onload = startSplash1;
    </script>
</body>
</html>
